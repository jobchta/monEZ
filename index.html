<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#667eea">
  <script>
    window.onerror = function (msg, url, line, col, error) {
      const div = document.createElement('div');
      div.style.cssText = 'position:fixed;top:0;left:0;right:0;background:red;color:white;padding:20px;z-index:99999;font-size:12px;white-space:pre-wrap;';
      div.textContent = '‚ùå ERROR: ' + msg + '\n' + url + ':' + line + ':' + col;
      document.body.appendChild(div);
      return false;
    };
  </script>
  <meta name="description" content="monEZ - Split expenses, not friendships">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23846941'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>üí∞</text></svg>">
  <title>monEZ - Split expenses, not friendships</title>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://royqgwcrwzqeehrebdrp.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJveXFnd2Nyd3pxZWVocmViZHJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MDY4MDcsImV4cCI6MjA3ODA4MjgwN30.MU3klD6uC91mXpY2AKXIMzxWIUswEo3F2vXjB4SRcDc';

    // Initialize Supabase client (will be done after DOM loads)
    let supabaseClient = null;
  </script>

  <style>
    /* monEZ Luxury Banking Design System */
    :root {
      /* Luxury Banking Colors */
      --background: #FAFAFA;
      --surface: #FFFFFF;
      --primary-text: #232325;
      --secondary-text: #828288;
      --borders: #ECECEC;
      --primary-accent: #667eea;
      --steel-blue: #3B6270;
      --success: #32775E;
      --error: #C44A44;
      --glass: rgba(255, 255, 255, 0.95);

      /* Luxury Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;

      /* Sophisticated Typography */
      --font-family: 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', system-ui, sans-serif;
      --text-xs: 11px;
      --text-sm: 13px;
      --text-base: 16px;
      --text-lg: 18px;
      --text-xl: 22px;
      --text-2xl: 24px;
      --text-3xl: 32px;
      --weight-normal: 400;
      --weight-medium: 500;
      --weight-semibold: 600;
      --letter-spacing: -0.01em;

      /* Luxury Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-full: 9999px;

      /* Subtle Shadows */
      --shadow-sm: 0 2px 8px rgba(150, 150, 150, 0.06);
      --shadow-md: 0 4px 12px rgba(150, 150, 150, 0.08);
      --shadow-lg: 0 8px 24px rgba(150, 150, 150, 0.10);
      --shadow-floating: 0 12px 40px rgba(132, 105, 65, 0.15);


    }

    /* Luxury Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-family);
      font-size: var(--text-base);
      line-height: 1.5;
      color: var(--primary-text);
      background: var(--background);
      letter-spacing: var(--letter-spacing);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    /* Luxury App Container */
    .app {
      max-width: 400px;
      margin: 0 auto;
      min-height: 100vh;
      background: var(--background);
      position: relative;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.08);
    }

    /* Luxury Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, var(--primary-accent) 0%, var(--steel-blue) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: white;
    }

    .loading-content {
      text-align: center;
    }

    .logo-large {
      font-size: var(--text-3xl);
      font-weight: var(--weight-semibold);
      margin-bottom: var(--space-sm);
      letter-spacing: var(--letter-spacing);
    }

    .accent {
      color: #F59E0B;
    }

    .tagline {
      font-size: var(--text-lg);
      opacity: 0.9;
      margin-bottom: var(--space-xl);
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto var(--space-md);
    }

    .loading-text {
      font-size: var(--text-sm);
      opacity: 0.8;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* PWA Prompt */
    .pwa-prompt {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--border);
      padding: var(--space-md);
      z-index: 1000;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      box-shadow: var(--shadow-lg);
    }

    .pwa-prompt:not(.hidden) {
      transform: translateY(0);
    }

    .pwa-content {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .pwa-icon {
      font-size: var(--text-2xl);
    }

    .pwa-text {
      flex: 1;
    }

    .pwa-text h3 {
      margin: 0 0 var(--space-xs) 0;
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
    }

    .pwa-text p {
      margin: 0;
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }

    .pwa-actions {
      display: flex;
      gap: var(--space-sm);
    }

    /* Luxury App Header */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-lg) var(--space-md);
      background: var(--surface);
      border-bottom: 0.5px solid var(--borders);
      backdrop-filter: blur(20px);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .logo {
      font-size: var(--text-xl);
      font-weight: var(--weight-semibold);
      color: var(--primary-text);
    }

    .balance-summary {
      display: flex;
      flex-direction: column;
    }

    .balance-label {
      font-size: var(--text-xs);
      color: var(--text-secondary);
      margin-bottom: var(--space-xs);
    }

    .balance-amount {
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      color: var(--primary-accent);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: var(--space-sm);
      border-radius: var(--radius-sm);
      position: relative;
      transition: background 0.2s ease;
    }

    .icon-btn:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .icon {
      font-size: var(--text-lg);
    }

    .badge {
      position: absolute;
      top: var(--space-xs);
      right: var(--space-xs);
      background: var(--error);
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: var(--radius-full);
      min-width: 16px;
      text-align: center;
    }

    .avatar {
      width: 32px;
      height: 32px;
      background: var(--primary);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: var(--text-sm);
      font-weight: var(--weight-semibold);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 0 var(--space-md) 100px;
    }

    /* View Management */
    .view {
      display: none;
      padding-top: var(--space-md);
      animation: fadeIn 0.3s ease;
    }

    .view.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .view-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-lg);
    }

    .view-header h2 {
      font-size: var(--text-2xl);
      font-weight: var(--weight-bold);
      color: var(--text);
    }

    .back-btn,
    .voice-btn,
    .filter-btn,
    .settle-all-btn,
    .create-group-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: var(--space-sm);
      cursor: pointer;
      font-size: var(--text-base);
      transition: all 0.2s ease;
    }

    .back-btn:hover,
    .voice-btn:hover,
    .filter-btn:hover {
      background: var(--primary);
      color: white;
      transform: scale(1.05);
    }

    /* Luxury Quick Stats */
    .quick-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .stat-card {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      transition: all 0.25s ease;
      box-shadow: var(--shadow-sm);
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-card.positive {
      border-left: 3px solid var(--success);
    }

    .stat-card.negative {
      border-left: 3px solid var(--error);
    }

    .stat-icon {
      font-size: var(--text-xl);
    }

    .stat-content {
      flex: 1;
    }

    .stat-label {
      font-size: var(--text-xs);
      color: var(--text-secondary);
      margin-bottom: var(--space-xs);
    }

    .stat-value {
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      color: var(--primary-text);
    }

    /* Luxury Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
      margin-bottom: var(--space-2xl);
    }

    .action-card {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm);
      position: relative;
      min-height: 100px;
      justify-content: center;
    }

    .action-card:hover {
      transform: translateY(-1px) scale(0.98);
      box-shadow: var(--shadow-md);
    }

    .action-card:active {
      transform: scale(0.98);
    }

    .action-card.primary {
      background: var(--primary-accent);
      color: white;
      border-color: var(--primary-accent);
    }

    .action-card.premium {
      background: var(--steel-blue);
      color: white;
      border-color: var(--steel-blue);
    }

    .action-icon {
      font-size: var(--text-xl);
    }

    .action-label {
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      text-align: center;
    }

    .premium-badge {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #B8860B;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: var(--radius-full);
      font-weight: var(--weight-semibold);
    }

    /* Section Headers */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-md);
    }

    .section-header h3 {
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      color: var(--text);
    }

    .view-all {
      background: none;
      border: none;
      color: var(--primary-accent);
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      cursor: pointer;
      text-decoration: none;
    }

    .group-limit {
      font-size: var(--text-xs);
      color: var(--secondary-text);
      background: var(--surface);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      border: 0.5px solid var(--borders);
    }

    /* Luxury Activity List */
    .activity-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .activity-item {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      transition: all 0.25s ease;
      cursor: pointer;
    }

    .activity-item:hover {
      background: var(--glass);
      transform: translateY(-1px) scale(0.98);
    }

    .activity-icon {
      font-size: var(--text-xl);
      width: 44px;
      height: 44px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary-accent) 0%, #764ba2 100%);
      color: white;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      margin-bottom: var(--space-xs);
      color: var(--primary-text);
    }

    .activity-meta {
      font-size: var(--text-sm);
      color: var(--secondary-text);
    }

    .activity-amount {
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      color: var(--primary-text);
      text-align: right;
    }

    /* Luxury Groups Preview */

    /* Category Analytics Chart */
    .chart-container {
      margin-top: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .chart-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chart-label {
      width: 100px;
      font-size: 13px;
      color: var(--text-secondary);
      text-align: right;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chart-bar-bg {
      flex: 1;
      height: 8px;
      background: var(--surface-elevated);
      border-radius: 4px;
      overflow: hidden;
    }

    .chart-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .chart-value {
      width: 60px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
    }



    .group-card {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      min-width: 220px;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .group-card:hover {
      transform: translateY(-1px) scale(0.98);
      box-shadow: var(--shadow-md);
    }

    .group-header {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
    }

    .group-icon {
      font-size: var(--text-xl);
    }

    .group-name {
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      color: var(--primary-text);
    }

    .group-members {
      font-size: var(--text-xs);
      color: var(--secondary-text);
      margin-bottom: var(--space-sm);
    }

    .group-balance {
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      color: var(--primary-accent);
    }

    /* Luxury Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      max-width: 400px;
      margin: 0 auto;
      background: var(--surface);
      border-top: 0.5px solid var(--borders);
      display: flex;
      z-index: 9999;
      backdrop-filter: blur(20px);
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--space-md) var(--space-xs);
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.25s ease;
      color: var(--secondary-text);
      position: relative;
    }

    .nav-item.active {
      color: var(--primary-accent);
    }

    .nav-item:hover {
      background: rgba(132, 105, 65, 0.08);
    }

    .nav-icon {
      font-size: var(--text-lg);
      margin-bottom: var(--space-xs);
    }

    .nav-label {
      font-size: 10px;
      font-weight: var(--weight-medium);
    }

    .group-count,
    .premium-indicator {

      /* Floating Action Button */
      .fab {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        box-shadow: 0 4px 12px rgba(132, 105, 65, 0.4);
        cursor: pointer;
        z-index: 9998;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .fab:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(132, 105, 65, 0.5);
      }

      .fab:active {
        transform: scale(0.95);
      }

      .fab-icon {
        font-size: 24px;

        /* Settings Item */
        .settings-item {
          width: 100%;
          padding: 16px;
          background: none;
          border: none;
          border-bottom: 1px solid var(--borders);
          display: flex;
          align-items: center;
          gap: 12px;
          cursor: pointer;
          color: var(--text);
          font-size: 14px;
          transition: background 0.2s;
        }

        .settings-item:last-child {
          border-bottom: none;
        }

        .settings-item:hover {
          background: var(--surface-elevated);
        }

        .settings-item span:first-child {
          font-size: 20px;
        }

        color: white;
      }

      /* Balance Cards */
      .balance-card-large {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 24px;
        color: white;
        box-shadow: 0 4px 12px rgba(132, 105, 65, 0.3);
      }

      .balance-card-small {
        background: var(--surface);
        border-radius: 12px;
        padding: 16px;
        border: 2px solid var(--borders);
      }

      .balance-card-negative {
        border-color: #FEE2E2;
        background: linear-gradient(135deg, #FEF2F2 0%, #FFFFFF 100%);
        color: #DC2626;
      }

      .balance-card-positive {
        border-color: #D1FAE5;
        background: linear-gradient(135deg, #ECFDF5 0%, #FFFFFF 100%);
        color: #059669;
      }

      /* Quick Action Buttons */
      .quick-action-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 12px;
        padding: 20px;
        color: white;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(132, 105, 65, 0.2);
      }

      .quick-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(132, 105, 65, 0.3);
      }

      .quick-action-btn:active {
        transform: translateY(0);
      }

      /* Activity Item */
      .activity-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--surface);
        border-radius: 12px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .activity-item:hover {
        background: var(--surface-elevated);
      }

      .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--surface-elevated);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .activity-details {
        flex: 1;
      }

      .activity-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 2px;
      }

      .activity-subtitle {
        font-size: 12px;
        color: var(--secondary-text);
      }

      .activity-amount {
        font-size: 16px;
        font-weight: 600;
        color: var(--text);
      }

      /* Group Card */
      .group-card-mini {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--surface);
        border-radius: 12px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .group-card-mini:hover {
        background: var(--surface-elevated);
      }

      .group-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      @keyframes enter {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-enter {
        animation: enter 0.4s ease forwards;
      }

      /* Chart Styles */
      /* Empty State */
      .empty-state {
        opacity: 0.6;
      }

      /* Hide FAB on desktop */
      @media (min-width: 768px) {
        .fab {
          display: none;
        }
      }

      position: absolute;
      top: var(--space-xs);
      right: var(--space-sm);
      background: var(--primary-accent);
      color: white;
      font-size: 8px;
      padding: 2px 4px;
      border-radius: var(--radius-full);
      min-width: 14px;
      text-align: center;
    }

    .premium-indicator {
      background: var(--steel-blue);
    }



    /* Luxury Floating Add Button */
    .fab {
      position: fixed;
      bottom: 100px;
      right: var(--space-md);
      width: 56px;
      height: 56px;
      background: var(--primary-accent);
      border: none;
      border-radius: var(--radius-full);
      color: white;
      font-size: var(--text-xl);
      cursor: pointer;
      box-shadow: var(--shadow-floating);
      transition: all 0.25s ease;
      z-index: 1000;
    }

    .fab:hover {
      transform: scale(0.98) translateY(-1px);
      box-shadow: 0 8px 25px rgba(132, 105, 65, 0.4);
    }

    .fab:active {
      transform: scale(0.95);
    }

    .fab-icon {
      font-weight: var(--weight-bold);
    }

    /* Luxury Form Styles */
    .expense-form {
      display: flex;
      flex-direction: column;
      gap: var(--space-xl);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .form-label {
      font-size: var(--text-sm);
      font-weight: var(--weight-semibold);
      color: var(--primary-text);
    }

    .amount-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .currency-symbol {
      position: absolute;
      left: var(--space-md);
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      color: var(--secondary-text);
      z-index: 1;
    }

    .form-input {
      width: 100%;
      padding: var(--space-md);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-md);
      font-size: var(--text-base);
      background: var(--surface);
      transition: all 0.25s ease;
      font-family: var(--font-family);
    }

    .amount-field {
      padding-left: var(--space-xl);
      padding-right: 50px;
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-accent);
      box-shadow: 0 0 0 3px rgba(132, 105, 65, 0.15);
    }

    .ai-suggest-btn {
      position: absolute;
      right: var(--space-sm);
      top: 50%;
      transform: translateY(-50%);
      background: var(--primary-accent);
      border: none;
      border-radius: var(--radius-sm);
      padding: var(--space-sm);
      cursor: pointer;
      transition: all 0.25s ease;
      color: white;
    }

    .ai-suggest-btn:hover {
      background: #73553A;
      transform: translateY(-50%) scale(0.98);
    }

    .ai-icon {
      font-size: var(--text-sm);
    }

    /* Luxury Category Selector */
    .category-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-sm);
    }

    .category-btn {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      cursor: pointer;
      font-size: var(--text-sm);
      transition: all 0.25s ease;
      font-weight: var(--weight-medium);
    }

    .category-btn:hover,
    .category-btn.active {
      background: var(--primary-accent);
      color: white;
      border-color: var(--primary-accent);
    }

    /* Luxury People Selector */
    .people-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-md);
    }

    .person-card {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm);
    }

    .person-card:hover {
      background: var(--glass);
      transform: translateY(-1px) scale(0.98);
    }

    .person-card.selected {
      background: var(--primary-accent);
      color: white;
      border-color: var(--primary-accent);
    }

    .person-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: var(--primary-accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-sm);
      font-weight: var(--weight-semibold);
    }

    .person-card.selected .person-avatar {
      background: white;
      color: var(--primary-accent);
    }

    .person-name {
      font-size: var(--text-xs);
      font-weight: var(--weight-semibold);
      text-align: center;
    }

    /* Luxury Split Options */
    .split-options {
      margin-top: var(--space-lg);
    }

    .split-type {
      display: flex;
      gap: var(--space-md);
    }

    .split-btn {
      flex: 1;
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      cursor: pointer;
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      transition: all 0.25s ease;
      position: relative;
    }

    .split-btn:hover,
    .split-btn.active {
      background: var(--primary-accent);
      color: white;
      border-color: var(--primary-accent);
    }

    .split-btn.premium {
      background: var(--steel-blue);
      color: white;
      border-color: var(--steel-blue);
    }

    .pro-tag {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #B8860B;
      color: white;
      font-size: 8px;
      padding: 2px 4px;
      border-radius: var(--radius-full);
      font-weight: var(--weight-semibold);
    }

    /* Luxury Form Actions */
    .form-actions {
      display: flex;
      gap: var(--space-lg);
      margin-top: var(--space-2xl);
    }

    .btn-primary,
    .btn-secondary {
      flex: 1;
      padding: var(--space-lg);
      border-radius: var(--radius-md);
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      min-height: 52px;
    }

    .btn-primary {
      background: var(--primary-accent);
      color: white;
      border: none;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      transform: scale(0.98) translateY(-1px);
      box-shadow: var(--shadow-lg);
      background: #73553A;
    }

    .btn-primary:active {
      transform: scale(0.95);
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--primary-text);
      border: 0.5px solid var(--borders);
    }

    .btn-secondary:hover {
      background: var(--glass);
      transform: scale(0.98);
    }

    .btn-icon {
      font-size: var(--text-sm);
    }

    /* Luxury Expenses Stats */
    .expenses-stats {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      margin-bottom: var(--space-2xl);
    }

    .stat-summary {
      display: flex;
      justify-content: space-around;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      display: block;
      font-size: var(--text-xl);
      font-weight: var(--weight-semibold);
      color: var(--primary-accent);
      margin-bottom: var(--space-xs);
    }

    .stat-label {
      font-size: var(--text-xs);
      color: var(--secondary-text);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Luxury Balance Summary */
    .balance-summary {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-lg);
      margin-bottom: var(--space-2xl);
    }

    .summary-card {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      text-align: center;
    }

    .summary-card.positive {
      border-left: 3px solid var(--success);
    }

    .summary-card.negative {
      border-left: 3px solid var(--error);
    }

    .summary-amount {
      font-size: var(--text-xl);
      font-weight: var(--weight-semibold);
      margin-bottom: var(--space-xs);
    }

    .summary-card.positive .summary-amount {
      color: var(--success);
    }

    .summary-card.negative .summary-amount {
      color: var(--error);
    }

    .summary-label {
      font-size: var(--text-sm);
      color: var(--secondary-text);
    }

    /* Luxury Balances List */
    .balances-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .balance-item {
      background: var(--surface);
      border: 0.5px solid var(--borders);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-lg);
      transition: all 0.25s ease;
    }

    .balance-item:hover {
      background: var(--glass);
      transform: translateY(-1px) scale(0.98);
    }

    .balance-avatar {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-full);
      background: var(--primary-accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
    }

    .balance-content {
      flex: 1;
    }

    .balance-name {
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      margin-bottom: var(--space-xs);
      color: var(--primary-text);
    }

    .balance-status {
      font-size: var(--text-sm);
      color: var(--secondary-text);
    }

    .balance-amount-container {
      text-align: right;
    }

    .balance-amount {
      font-size: var(--text-lg);
      font-weight: var(--weight-semibold);
      margin-bottom: var(--space-xs);
    }

    .balance-amount.positive {
      color: var(--success);
    }

    .balance-amount.negative {
      color: var(--error);
    }

    .settle-btn-small {
      background: var(--primary-accent);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      padding: var(--space-xs) var(--space-sm);
      font-size: var(--text-xs);
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .settle-btn-small:hover {
      background: #73553A;
      transform: scale(0.98);
    }

    /* Groups Grid */
    .groups-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-md);
    }

    .group-card-full {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .group-card-full:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* Premium Features */
    .premium-hero {
      background: linear-gradient(135deg, var(--accent), #7C3AED);
      color: white;
      border-radius: var(--radius-md);
      padding: var(--space-xl);
      text-align: center;
      margin-bottom: var(--space-lg);
    }

    .hero-icon {
      font-size: 48px;
      margin-bottom: var(--space-md);
    }

    .premium-hero h3 {
      font-size: var(--text-2xl);
      font-weight: var(--weight-bold);
      margin-bottom: var(--space-sm);
    }

    .premium-hero p {
      font-size: var(--text-base);
      opacity: 0.9;
      margin-bottom: var(--space-lg);
    }

    .pricing-highlight {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
    }

    .price-original {
      font-size: var(--text-lg);
      text-decoration: line-through;
      opacity: 0.7;
    }

    .price-offer {
      font-size: var(--text-2xl);
      font-weight: var(--weight-bold);
      color: var(--secondary);
    }

    .discount-badge {
      background: var(--secondary);
      color: var(--text);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: var(--weight-bold);
    }

    .premium-status {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: var(--space-xs) var(--space-sm);
      font-size: var(--text-xs);
      font-weight: var(--weight-bold);
      color: var(--text-secondary);
    }

    /* Settings */
    .settings-sections {
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }

    .settings-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .settings-section h3 {
      background: var(--glass);
      padding: var(--space-md);
      margin: 0;
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      color: var(--text);
      border-bottom: 1px solid var(--border);
    }

    .setting-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      cursor: pointer;
      transition: background 0.2s ease;
      border-bottom: 1px solid var(--border);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-item:hover {
      background: var(--glass);
    }

    .setting-item.premium {
      background: linear-gradient(135deg, var(--accent), #7C3AED);
      color: white;
    }

    .setting-icon {
      font-size: var(--text-xl);
    }

    .setting-content {
      flex: 1;
    }

    .setting-title {
      font-size: var(--text-base);
      font-weight: var(--weight-medium);
      margin-bottom: var(--space-xs);
    }

    .setting-desc {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .setting-item.premium .setting-desc {
      color: rgba(255, 255, 255, 0.8);
    }

    .setting-arrow {
      font-size: var(--text-lg);
      color: var(--text-secondary);
    }

    .upgrade-badge {
      background: var(--secondary);
      color: var(--text);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: var(--weight-bold);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: 0.3s;
      border-radius: var(--radius-full);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: var(--primary);
    }

    input:checked+.slider:before {
      transform: translateX(20px);
    }

    /* Modals */
    .modal {
      position: fixed;

    }

    @media (min-width: 768px) {
      .quick-actions {
        grid-template-columns: repeat(2, 1fr);
      }

      .people-selector {
        grid-template-columns: repeat(2, 1fr);
      }

      .category-selector {
        grid-template-columns: repeat(2, 1fr);
      }
    }



    /* View Header */

    /* Premium UI Enhancements */
    .segmented-control {
      background: var(--surface-elevated);
      padding: 4px;
      border-radius: 12px;
      display: flex;
      position: relative;
      border: 1px solid var(--borders);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
    }

    .segment-btn {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      color: var(--secondary-text);
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      z-index: 1;
      transition: all 0.3s;
      border-radius: 8px;
    }

    .segment-btn.active {
      background: white;
      color: var(--primary-accent);
      /* Updated from --primary */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      font-weight: 600;
    }

    .spending-bar-container {
      margin: 20px 0;
      background: var(--surface);
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--borders);
    }

    .spending-bar-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--secondary-text);
    }

    .spending-progress {
      height: 12px;
      background: var(--surface-elevated);
      border-radius: 6px;
      overflow: hidden;
    }

    .spending-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      /* Animated via JS */
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <!-- Loading Overlay -->
  <div id="loading-overlay"
    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10001; align-items: center; justify-content: center;">
    <div
      style="width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;">
    </div>
  </div>

  <div class="app">

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
      <div class="loading-content">
        <div class="logo-large">mon<span class="accent">EZ</span></div>
        <div class="tagline">Split expenses, not friendships</div>
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading your financial companion...</div>
      </div>
    </div>

    <!-- PWA Install Prompt -->
    <div id="pwa-prompt" class="pwa-prompt hidden">
      <div class="pwa-content">
        <div class="pwa-icon">üì±</div>
        <div class="pwa-text">
          <h3 data-i18n="install_app">Install monEZ</h3>
          <p data-i18n="install_desc">Get the full app experience on your home screen</p>
        </div>
        <div class="pwa-actions">
          <button class="btn-secondary" onclick="dismissPWAPrompt()" data-i18n="maybe_later">Maybe later</button>
          <button class="btn-primary" onclick="installPWA()" data-i18n="install">Install</button>
        </div>
      </div>
    </div>

    <!-- Main App -->
    <div id="main-app" style="display: none;">
      <!-- App Header -->
      <header class="app-header">
        <div class="header-left">
          <div class="logo">mon<span class="accent">EZ</span></div>
          <div class="balance-summary">
            <div class="balance-label" data-i18n="your_balance">Your balance</div>
            <div class="balance-label" data-i18n="your_balance">Your balance</div>
            <div class="balance-amount" id="balance-hero"></div>
          </div>
        </div>
        <div class="header-right">
          <button class="icon-btn" onclick="showNotifications()">
            <span class="icon">üîî</span>
            <span class="badge">3</span>
          </button>
          <button class="icon-btn" onclick="showSettings()" title="Settings & Account">
            <div class="avatar">‚öôÔ∏è</div>
          </button>
        </div>
      </header>

      <!-- Views Container -->
      <main class="main-content">
        <!-- Home View -->
        <div id="home-view" class="view active">
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="stat-card positive">
              <div class="stat-icon">üíö</div>
              <div class="stat-content">
                <div class="stat-label" data-i18n="you_are_owed">You're owed</div>
                <div class="stat-value" id="quick-owe-display"></div>
              </div>
            </div>
            <div class="stat-card negative">
              <div class="stat-icon">üí∏</div>
              <div class="stat-content">
                <div class="stat-label" data-i18n="you_owe">You owe</div>
                <div class="stat-value" id="quick-owed-display"></div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <button class="action-card primary" onclick="showAddExpense()">
              <div class="action-icon">‚ûï</div>
              <div class="action-label" data-i18n="add_expense">Add Expense</div>
            </button>
            <button class="action-card" onclick="showSplitBill()">
              <div class="action-icon">üßÆ</div>
              <div class="action-label" data-i18n="split_bill">Split Bill</div>
            </button>
            <button class="action-card" onclick="showSettle()">
              <div class="action-icon">üí≥</div>
              <div class="action-label" data-i18n="settle_up">Settle Up</div>
            </button>
          </div>

          <!-- Recent Activity -->
          <section class="activity-section">
            <div class="section-header">
              <h3 data-i18n="recent_activity">Recent Activity</h3>
              <button class="view-all" onclick="showExpenses()" data-i18n="view_all">View all</button>
            </div>
            <div id="recent-expenses" class="activity-list">
              <!-- Dynamic content -->
            </div>
          </section>

          <!-- Groups Preview -->
          <section class="groups-section">
            <div class="section-header">
              <h3 data-i18n="your_groups">Your Groups</h3>
              <div class="group-limit">2/3 groups</div>
              <button class="view-all" onclick="showGroups()" data-i18n="view_all">View all</button>
            </div>
            <div class="groups-preview" id="groups-preview">
              <!-- Dynamic content -->
            </div>
          </section>
        </div>

        <!-- Add Expense View -->
        <div id="add-expense-view" class="view">
          <div class="view-header">
            <button class="back-btn" onclick="showHome()">‚Üê</button>
            <h2 data-i18n="add_new_expense">Add Expense</h2>

          </div>

          <form id="expense-form" class="expense-form">
            <div class="form-group">
              <label class="form-label" data-i18n="amount">Amount</label>
              <div class="amount-input-container">
                <span class="currency-symbol" id="add-expense-currency-symbol"></span>
                <input type="number" id="amount" class="form-input amount-field" placeholder="0.00" step="0.01"
                  required>
                <button type="button" class="ai-suggest-btn" disabled title="AI features removed" title="AI Suggestion">
                  <span class="ai-icon">ü§ñ</span>
                </button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" data-i18n="description">Description</label>
              <div class="input-container">
                <input type="text" id="description" class="form-input" placeholder="What was this for?"
                  data-i18n-placeholder="description" required>
                <div class="smart-suggestions" id="smart-suggestions">
                  <!-- AI suggestions appear here -->
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" data-i18n="category">Category</label>
              <div class="category-selector">
                <button type="button" class="category-btn" data-category="üçΩÔ∏è"><span class="cat-icon">üçΩÔ∏è</span> <span
                    data-i18n="cat_food">Food</span></button>
                <button type="button" class="category-btn" data-category="üöó"><span class="cat-icon">üöó</span> <span
                    data-i18n="cat_transport">Transport</span></button>
                <button type="button" class="category-btn" data-category="üé¨"><span class="cat-icon">üé¨</span> <span
                    data-i18n="cat_entertainment">Entertainment</span></button>
                <button type="button" class="category-btn" data-category="üõçÔ∏è"><span class="cat-icon">üõçÔ∏è</span> <span
                    data-i18n="cat_shopping">Shopping</span></button>
                <button type="button" class="category-btn" data-category="üí°"><span class="cat-icon">üí°</span> <span
                    data-i18n="cat_bills">Bills</span></button>
                <button type="button" class="category-btn" data-category="‚úàÔ∏è"><span class="cat-icon">‚úàÔ∏è</span> <span
                    data-i18n="cat_travel">Travel</span></button>
              </div>
            </div>

            <!-- Expense Type Toggle - Premium Segmented Control -->
            <div class="form-group animate-enter" style="animation-delay: 0.1s;">
              <label class="form-label" style="margin-bottom: 12px;">Expense Type</label>
              <div class="segmented-control"
                style="background: var(--surface-elevated); padding: 4px; border-radius: 12px; display: flex; position: relative; border: 1px solid var(--borders); box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);">
                <button type="button" id="personal-toggle" onclick="setExpenseType('personal')"
                  style="flex: 1; padding: 12px; border: none; background: transparent; color: var(--primary); font-weight: 600; font-size: 14px; cursor: pointer; z-index: 1; transition: all 0.3s; border-radius: 8px;"
                  class="active">
                  üë§ Personal
                </button>
                <button type="button" id="split-toggle" onclick="setExpenseType('split')"
                  style="flex: 1; padding: 12px; border: none; background: transparent; color: var(--secondary-text); font-weight: 500; font-size: 14px; cursor: pointer; z-index: 1; transition: all 0.3s; border-radius: 8px;">
                  üë• Split
                </button>
              </div>
            </div>

            <div class="form-group" id="split-section" style="display: none;">
              <label class="form-label" data-i18n="split_with">Split with</label>
              <div class="people-selector" id="people-selector">
                <!-- People cards will be loaded here -->
              </div>
            </div>

            <div class="split-options">
              <div class="split-type">
                <button type="button" class="split-btn active" data-type="equal" data-i18n="equal_split">Equal
                  Split</button>
                <button type="button" class="split-btn" data-type="percentage" data-i18n="by_percentage">By
                  Percentage</button>
                <button type="button" class="split-btn" data-type="custom" data-i18n="custom_split">Custom
                  Split</button>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" onclick="showHome()" data-i18n="cancel">Cancel</button>
              <button type="submit" class="btn-primary">
                <span class="btn-text" data-i18n="save_expense">Save Expense</span>
                <span class="btn-icon">üíæ</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Expenses View -->
        <div id="expenses-view" class="view">
          <div class="view-header">
            <button class="back-btn" onclick="showHome()">‚Üê</button>
            <h2 data-i18n="expenses">All Expenses</h2>
            <button class="filter-btn" onclick="showFilters()">üîç</button>
          </div>

          <!-- Search Bar -->
          <div class="search-container">
            <input type="text" id="expense-search" class="search-input" placeholder="üîç Search expenses..."
              data-i18n-placeholder="search_expenses" oninput="searchExpenses(this.value)">
          </div>

          <div class="expenses-stats">
            <div class="stat-summary">
              <div class="stat-item">
                <span class="stat-number" id="total-expenses"></span>
                <span class="stat-label" data-i18n="total_spent">Total Spent</span>
              </div>
              <div class="stat-item">
                <span class="stat-number" id="this-month"></span>
                <span class="stat-label" data-i18n="this_month">This Month</span>
              </div>
            </div>
          </div>

          <!-- Category Analytics Chart -->
          <div class="animate-enter"
            style="animation-delay: 0.2s; background: var(--surface); border-radius: var(--radius-lg); padding: var(--space-lg); border: 0.5px solid var(--borders); box-shadow: var(--shadow-sm);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <h4 style="margin: 0;">Spending Breakdown</h4>
              <span style="font-size: 12px; color: var(--secondary-text);">Top Categories</span>
            </div>
            <div id="category-chart" class="chart-container">
              <!-- Bars injected here -->
            </div>
          </div>

          <div class="expenses-list" id="all-expenses-list">
            <!-- All expenses will be loaded here -->
          </div>
        </div>

        <!-- Balances View -->
        <div id="balances-view" class="view">
          <div class="view-header">
            <button class="back-btn" onclick="showHome()">‚Üê</button>
            <h2 data-i18n="balances">Balances</h2>
            <button class="settle-all-btn" onclick="settleAll()" data-i18n="settle_all">Settle All</button>
          </div>

          <div class="balance-summary">
            <div class="summary-card positive">
              <div class="summary-amount" id="you-are-owed-display"></div>
              <div class="summary-label" data-i18n="you_are_owed">You're owed</div>
            </div>
            <div class="summary-card negative">
              <div class="summary-amount" id="you-owe-display"></div>
              <div class="summary-label" data-i18n="you_owe">You owe</div>
            </div>
          </div>

          <div class="balances-list" id="balances-list">
            <!-- Balances will be loaded here -->
          </div>
        </div>

        <!-- Groups View -->
        <div id="groups-view" class="view">
          <div class="view-header">
            <button class="back-btn" onclick="showHome()">‚Üê</button>
            <h2 data-i18n="groups">Groups</h2>
            <button class="create-group-btn" onclick="showCreateGroup()">+</button>
          </div>

          <div class="groups-grid" id="groups-grid">
            <!-- Groups will be loaded here -->
          </div>
        </div>

        <!-- Premium Features View -->
        <div id="premium-view" class="view">
          <div class="view-header">
            <button class="back-btn" onclick="showHome()">‚Üê</button>
            <h2 data-i18n="premium_features">Premium Features</h2>
            <div class="premium-status" data-i18n="free_tier">FREE TIER</div>
          </div>

          <div class="premium-hero">
            <div class="hero-icon">‚ú®</div>
            <h3 data-i18n="unlock_premium">Unlock Premium Features</h3>
            <p data-i18n="unlock_premium_desc">Get AI-powered insights, unlimited groups, and advanced analytics</p>
            <div class="pricing-highlight">
              <span class="price-original">‚Çπ299</span>
              <span class="price-offer">‚Çπ119/month</span>
              <span class="discount-badge">60% OFF</span>
            </div>
          </div>

          <div class="premium-features">
            <!-- Premium features list -->
          </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="view">
          <div class="view-header">
            <button class="back-btn" onclick="showHome()">‚Üê</button>
            <h2 data-i18n="settings">Settings</h2>
          </div>

          <div class="settings-sections">
            <!-- Account Section -->
            <div class="settings-section">
              <h3>üë§ Account</h3>
              <div id="account-section">
                <!-- Not logged in state -->
                <div id="account-logged-out" class="setting-item" style="cursor: pointer;" onclick="showAuthModal()">
                  <div class="setting-icon">üîí</div>
                  <div class="setting-content">
                    <div class="setting-title" data-i18n="signin_to_sync">Sign In to Sync</div>
                    <div class="setting-desc" data-i18n="access_data">Access your data from any device</div>
                  </div>
                  <div class="setting-action">‚Üí</div>
                </div>

                <!-- Logged in state (hidden by default) -->
                <div id="account-logged-in" style="display: none;">
                  <div class="setting-item">
                    <div class="setting-icon"
                      style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                      ‚úì</div>
                    <div class="setting-content">
                      <div class="setting-title" id="account-email">user@email.com</div>
                      <div class="setting-desc" id="sync-status">‚úÖ Synced</div>
                    </div>
                  </div>
                  <div style="display: flex; gap: 12px; margin-top: 12px;">
                    <button onclick="syncNow()" class="btn btn-secondary" style="flex: 1;" data-i18n="sync_now">üîÑ
                      Sync
                      Now</button>
                    <button onclick="signOut()" class="btn" style="flex: 1; background: #EF4444; color: white;"
                      data-i18n="sign_out">Sign
                      Out</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Localization Section -->
            <div class="settings-section">
              <h3 data-i18n="localization">üåç Localization</h3>
              <div class="setting-item">
                <div class="setting-icon">üó£Ô∏è</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="language">Language</div>
                  <div class="setting-desc" id="current-language-display">English</div>
                </div>
                <select id="language-selector" class="setting-select" onchange="changeLanguage(this.value)">
                  <option value="en">English</option>
                  <option value="es">Espa√±ol</option>
                  <option value="fr">Fran√ßais</option>
                  <option value="de">Deutsch</option>
                  <option value="pt">Portugu√™s</option>
                  <option value="it">Italiano</option>
                  <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                  <option value="zh">‰∏≠Êñá</option>
                  <option value="ja">Êó•Êú¨Ë™û</option>
                  <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                  <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                  <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                  <option value="tr">T√ºrk√ße</option>
                  <option value="nl">Nederlands</option>
                  <option value="pl">Polski</option>
                  <option value="vi">Ti·∫øng Vi·ªát</option>
                  <option value="th">‡πÑ‡∏ó‡∏¢</option>
                  <option value="id">Bahasa Indonesia</option>
                  <option value="he">◊¢◊ë◊®◊ô◊™</option>
                  <option value="fa">ŸÅÿßÿ±ÿ≥€å</option>
                  <option value="ur">ÿßÿ±ÿØŸà</option>
                </select>
              </div>
              <div class="setting-item">
                <div class="setting-icon">üí∞</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="currency">Currency</div>
                  <div class="setting-desc" id="current-currency-display"></div>
                </div>
                <select id="currency-selector" class="setting-select" onchange="changeCurrency(this.value)">
                  <optgroup label="Asia">
                    <option value="INR">‚Çπ INR - Indian Rupee</option>
                    <option value="JPY">¬• JPY - Japanese Yen</option>
                    <option value="CNY">¬• CNY - Chinese Yuan</option>
                    <option value="KRW">‚Ç© KRW - Korean Won</option>
                    <option value="SGD">S$ SGD - Singapore Dollar</option>
                    <option value="HKD">HK$ HKD - Hong Kong Dollar</option>
                    <option value="THB">‡∏ø THB - Thai Baht</option>
                    <option value="MYR">RM MYR - Malaysian Ringgit</option>
                    <option value="IDR">Rp IDR - Indonesian Rupiah</option>
                    <option value="PHP">‚Ç± PHP - Philippine Peso</option>
                    <option value="VND">‚Ç´ VND - Vietnamese Dong</option>
                    <option value="PKR">‚Ç® PKR - Pakistani Rupee</option>
                    <option value="BDT">‡ß≥ BDT - Bangladeshi Taka</option>
                  </optgroup>
                  <optgroup label="Middle East">
                    <option value="AED">ÿØ.ÿ• AED - UAE Dirham</option>
                    <option value="SAR">Ô∑º SAR - Saudi Riyal</option>
                    <option value="QAR">ÿ±.ŸÇ QAR - Qatari Riyal</option>
                    <option value="KWD">ÿØ.ŸÉ KWD - Kuwaiti Dinar</option>
                    <option value="ILS">‚Ç™ ILS - Israeli Shekel</option>
                    <option value="TRY">‚Ç∫ TRY - Turkish Lira</option>
                  </optgroup>
                  <optgroup label="Europe">
                    <option value="EUR">‚Ç¨ EUR - Euro</option>
                    <option value="GBP">¬£ GBP - British Pound</option>
                    <option value="CHF">Fr CHF - Swiss Franc</option>
                    <option value="SEK">kr SEK - Swedish Krona</option>
                    <option value="NOK">kr NOK - Norwegian Krone</option>
                    <option value="DKK">kr DKK - Danish Krone</option>
                    <option value="PLN">z≈Ç PLN - Polish Zloty</option>
                    <option value="RUB">‚ÇΩ RUB - Russian Ruble</option>
                    <option value="UAH">‚Ç¥ UAH - Ukrainian Hryvnia</option>
                  </optgroup>
                  <optgroup label="Americas">
                    <option value="USD">$ USD - US Dollar</option>
                    <option value="CAD">C$ CAD - Canadian Dollar</option>
                    <option value="MXN">$ MXN - Mexican Peso</option>
                    <option value="BRL">R$ BRL - Brazilian Real</option>
                    <option value="ARS">$ ARS - Argentine Peso</option>
                    <option value="CLP">$ CLP - Chilean Peso</option>
                    <option value="COP">$ COP - Colombian Peso</option>
                  </optgroup>
                  <optgroup label="Africa">
                    <option value="ZAR">R ZAR - South African Rand</option>
                    <option value="NGN">‚Ç¶ NGN - Nigerian Naira</option>
                    <option value="EGP">E¬£ EGP - Egyptian Pound</option>
                    <option value="KES">KSh KES - Kenyan Shilling</option>
                    <option value="GHS">GH‚Çµ GHS - Ghanaian Cedi</option>
                    <option value="MAD">ÿØ.ŸÖ MAD - Moroccan Dirham</option>
                  </optgroup>
                  <optgroup label="Oceania">
                    <option value="AUD">A$ AUD - Australian Dollar</option>
                    <option value="NZD">NZ$ NZD - New Zealand Dollar</option>
                    <option value="FJD">FJ$ FJD - Fijian Dollar</option>
                  </optgroup>
                </select>
              </div>
            </div>

            <!-- Account Section -->
            <div class="settings-section">
              <h3 data-i18n="account_section">Account</h3>
              <div class="setting-item" onclick="showProfile()">
                <div class="setting-icon">üë§</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="profile">Profile</div>
                  <div class="setting-desc" data-i18n="profile_desc">Manage your account details</div>
                </div>
                <div class="setting-arrow">‚Ä∫</div>
              </div>
              <div class="setting-item" onclick="showPaymentMethods()">
                <div class="setting-icon">üí≥</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="payment_methods">Payment Methods</div>
                  <div class="setting-desc" data-i18n="payment_methods_desc">UPI, Cards, Bank accounts</div>
                </div>
                <div class="setting-arrow">‚Ä∫</div>
              </div>
            </div>

            <!-- App Section -->
            <div class="settings-section">
              <h3 data-i18n="app_section">App</h3>
              <div class="setting-item">
                <div class="setting-icon">üîî</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="notifications">Notifications</div>
                  <div class="setting-desc" data-i18n="notifications_desc">Push notifications, reminders</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" checked>
                  <span class="slider"></span>
                </label>
              </div>
              <div class="setting-item">
                <div class="setting-icon">üåô</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="dark_mode">Dark Mode</div>
                  <div class="setting-desc" data-i18n="dark_mode_desc">Switch to dark theme</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <!-- Data Section -->
            <div class="settings-section">
              <h3 data-i18n="data_management">üìä Data Management</h3>
              <div class="setting-item" onclick="exportDataJSON()">
                <div class="setting-icon">üìÅ</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="export_data">Export as JSON</div>
                  <div class="setting-desc" data-i18n="export_data_desc">Download all your data</div>
                </div>
                <div class="setting-arrow">‚Üì</div>
              </div>
              <div class="setting-item" onclick="exportDataCSV()">
                <div class="setting-icon">üìÑ</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="export_csv">Export as CSV</div>
                  <div class="setting-desc" data-i18n="export_csv_desc">Spreadsheet-friendly format</div>
                </div>
                <div class="setting-arrow">‚Üì</div>
              </div>
              <div class="setting-item" onclick="importData()">
                <div class="setting-icon">üì•</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="import_data">Import Data</div>
                  <div class="setting-desc" data-i18n="import_data_desc">Restore from backup</div>

                  <!-- Profile View -->
                  <div id="profile-view" class="view" style="display: none;">
                    <div class="view-header">
                      <h2 data-i18n="profile">Profile</h2>
                    </div>
                    <div class="view-content">

                      <!-- Account Section -->
                      <div style="padding: 24px; background: var(--surface); border-radius: 12px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                          <div
                            style="width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 32px;">
                            üë§
                          </div>
                          <div>
                            <div id="profile-display-name"
                              style="font-size: 20px; font-weight: 600; color: var(--text);">User</div>
                            <div style="font-size: 14px; color: var(--secondary-text);">user@example.com</div>
                          </div>
                        </div>
                        <button onclick="editProfile()"
                          style="width: 100%; padding: 12px; background: var(--surface-elevated); border: 1px solid var(--borders); border-radius: 8px; color: var(--text); font-size: 14px; cursor: pointer;">
                          Edit Profile
                        </button>
                      </div>

                      <!-- Premium Section -->
                      <div
                        style="padding: 24px; background: linear-gradient(135deg, #FFF9E6 0%, #FFE4B3 100%); border-radius: 12px; margin-bottom: 16px; border: 2px solid #667eea;">
                        <div style="font-size: 24px; margin-bottom: 8px;">‚ú®</div>
                        <div style="font-size: 18px; font-weight: 600; color: #667eea; margin-bottom: 8px;">Upgrade to
                          Premium</div>
                        <div style="font-size: 14px; color: #6B5835; margin-bottom: 16px;">Unlock AI insights,
                          unlimited
                          groups, and advanced analytics</div>
                        <button onclick="showPremium()"
                          style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; font-size: 14px; font-weight: 600; cursor: pointer;">
                          Learn More
                        </button>
                      </div>

                      <!-- Settings Menu -->
                      <div
                        style="background: var(--surface); border-radius: 12px; overflow: hidden; margin-bottom: 16px;">
                        <div style="padding: 16px; border-bottom: 1px solid var(--borders);">
                          <div style="font-size: 16px; font-weight: 600; color: var(--text);">‚öôÔ∏è Settings</div>
                        </div>

                        <button onclick="showLanguageSettings()" class="settings-item">
                          <span>üåç</span>
                          <span>Language & Region</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">‚Üí</span>
                        </button>

                        <button onclick="showNotificationSettings()" class="settings-item">
                          <span>üîî</span>
                          <span>Notifications</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">‚Üí</span>
                        </button>

                        <button onclick="showAppearanceSettings()" class="settings-item">
                          <span>üé®</span>
                          <span>Appearance</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">‚Üí</span>
                        </button>

                        <button onclick="showDataSettings()" class="settings-item">
                          <span>üìä</span>
                          <span>Data & Privacy</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">‚Üí</span>
                        </button>
                      </div>

                      <!-- About Section -->
                      <div
                        style="background: var(--surface); border-radius: 12px; overflow: hidden; margin-bottom: 16px;">
                        <div style="padding: 16px; border-bottom: 1px solid var(--borders);">
                          <div style="font-size: 16px; font-weight: 600; color: var(--text);">‚ÑπÔ∏è About</div>
                        </div>

                        <button onclick="showHelp()" class="settings-item">
                          <span>‚ùì</span>
                          <span>Help & Support</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">‚Üí</span>
                        </button>

                        <button onclick="showPrivacy()" class="settings-item">
                          <span>üîí</span>
                          <span>Terms & Privacy</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">‚Üí</span>
                        </button>

                        <div class="settings-item" style="cursor: default;">
                          <span>üì±</span>
                          <span>App Version</span>
                          <span style="margin-left: auto; color: var(--secondary-text);">2.0</span>
                        </div>
                      </div>

                      <!-- Sign Out -->
                      <button onclick="signOut()"
                        style="width: 100%; padding: 12px; background: var(--surface); border: 1px solid #EF4444; border-radius: 8px; color: #EF4444; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 80px;">
                        Sign Out
                      </button>

                    </div>
                  </div>
                </div>
                <div class="setting-arrow">‚Üë</div>
              </div>
            </div>

            <!-- About Section -->
            <div class="settings-section">
              <h3 data-i18n="about">About</h3>
              <div class="setting-item">
                <div class="setting-icon">‚ÑπÔ∏è</div>
                <div class="setting-content">
                  <div class="setting-title" data-i18n="global_edition">monEZ Global Edition</div>
                  <div class="setting-desc" data-i18n="version_info">v2.0 ‚Ä¢ 55 currencies ‚Ä¢ 25 languages</div>
                </div>
              </div>
            </div>
          </div>
        </div>


        <!-- Country View -->
        <div id="country-view" class="view">
          <header class="app-header">
            <h2><span data-i18n="country">Country</span></h2>
          </header>
          <div class="content-container">
            <!-- Search Bar -->
            <div style="padding: 16px; padding-bottom: 0;">
              <input type="text" id="country-search" class="search-input" placeholder="Search countries..."
                data-i18n-placeholder="search_countries"
                style="width: 100%; padding: 12px; border: 1px solid #E2E8F0; border-radius: 8px; font-size: 14px;"
                oninput="filterCountries(this.value)" />
            </div>
            <!-- Countries Grid -->
            <div id="countries-grid"
              style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 16px;">
              <!-- Countries will be rendered here -->
            </div>
          </div>
        </div>
      </main>

      <!-- Bottom Navigation - Strategic 4-Tab Design -->
      <nav class="bottom-nav">
        <button class="nav-item active" data-view="home" onclick="showHome()">
          <span class="nav-icon">üè†</span>
          <span class="nav-label" data-i18n="home">Home</span>
        </button>
        <button class="nav-item" data-view="expenses" onclick="showExpenses()">
          <span class="nav-icon">üí∏</span>
          <span class="nav-label" data-i18n="expenses">Expenses</span>
        </button>
        <button class="nav-item" data-view="groups" onclick="showGroups()">
          <span class="nav-icon">üë•</span>
          <span class="nav-label" data-i18n="groups">Groups</span>
          <span class="group-count">2</span>
        </button>
        <button class="nav-item" data-view="profile" onclick="showProfile()">
          <span class="nav-icon">üë§</span>
          <span class="nav-label" data-i18n="profile">Profile</span>
        </button>
      </nav>

      <!-- Floating Action Button -->
      <button class="fab" onclick="showAddExpense()" aria-label="Add Expense">
        <span class="fab-icon">‚ûï</span>
      </button>
    </div>

    <!-- Floating Add Button -->
    <button class="fab" onclick="showAddExpense()">
      <span class="fab-icon">+</span>
    </button>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal hidden">
      <div class="modal-overlay" onclick="closeAuthModal()"></div>
      <div class="modal-content" style="max-width: 400px; padding: 32px;">
        <div style="text-align: center; margin-bottom: 24px;">
          <div style="font-size: 48px; margin-bottom: 8px;">üîê</div>
          <h2 style="color: var(--primary-accent); margin-bottom: 4px;" data-i18n="signin_to_sync">Sign In to Sync</h2>
          <p style="color: var(--secondary-text); font-size: 14px;" data-i18n="access_data">Access your expenses from
            any device</p>
        </div>

        <div id="auth-form">
          <!-- Email Login -->
          <div style="margin-bottom: 16px;">
            <input type="email" id="auth-email" placeholder="Email address" data-i18n-placeholder="email_placeholder"
              style="width: 100%; padding: 14px; border: 1px solid var(--borders); border-radius: 12px; font-size: 16px; background: var(--surface);">
          </div>
          <div style="margin-bottom: 16px;">
            <input type="password" id="auth-password" placeholder="Password"
              data-i18n-placeholder="password_placeholder"
              style="width: 100%; padding: 14px; border: 1px solid var(--borders); border-radius: 12px; font-size: 16px; background: var(--surface);">
          </div>

          <button onclick="handleEmailAuth()" class="btn btn-primary"
            style="width: 100%; padding: 14px; margin-bottom: 16px;">
            <span data-i18n="sign_in">Sign In / Sign Up</span>
          </button>

          <div style="text-align: center; color: var(--secondary-text); margin-bottom: 16px;"
            data-i18n="or_continue_with">or continue with</div>

          <!-- Social Login -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px;">
            <button onclick="handleGoogleAuth()"
              style="flex: 1; padding: 12px; border: 1px solid var(--borders); border-radius: 12px; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <span style="font-size: 20px;">üîµ</span> Google
            </button>
            <button onclick="showPhoneAuth()"
              style="flex: 1; padding: 12px; border: 1px solid var(--borders); border-radius: 12px; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <span style="font-size: 20px;">üì±</span> Phone OTP
            </button>
          </div>

          <button onclick="skipAuth()"
            style="width: 100%; padding: 12px; background: transparent; border: none; color: var(--secondary-text); cursor: pointer; font-size: 14px;">
            <span data-i18n="continue_offline">Continue without account (offline only)</span>
          </button>
        </div>

        <!-- Phone OTP Form (hidden by default) -->
        <div id="phone-auth-form" style="display: none;">
          <div style="margin-bottom: 16px;">
            <input type="tel" id="auth-phone" placeholder="+91 Phone number" data-i18n-placeholder="phone_placeholder"
              style="width: 100%; padding: 14px; border: 1px solid var(--borders); border-radius: 12px; font-size: 16px; background: var(--surface);">
          </div>
          <div id="otp-input" style="display: none; margin-bottom: 16px;">
            <input type="text" id="auth-otp" placeholder="Enter 6-digit OTP" data-i18n-placeholder="otp_placeholder"
              style="width: 100%; padding: 14px; border: 1px solid var(--borders); border-radius: 12px; font-size: 16px; background: var(--surface); text-align: center; letter-spacing: 8px;">
          </div>
          <button onclick="handlePhoneAuth()" class="btn btn-primary"
            style="width: 100%; padding: 14px; margin-bottom: 16px;">
            <span data-i18n="send_otp">Send OTP</span>
          </button>
          <button onclick="showEmailAuth()"
            style="width: 100%; padding: 12px; background: transparent; border: none; color: var(--secondary-text); cursor: pointer;">
            <span data-i18n="back_to_email">‚Üê Back to email login</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div id="premium-modal" class="modal hidden">
      <div class="modal-overlay" onclick="closePremiumModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="premium_features">‚ú® Premium Features</h3>
          <button class="modal-close" onclick="closePremiumModal()">√ó</button>
        </div>
        <div class="premium-features-list">
          <!-- Premium features content -->
        </div>
      </div>
    </div>

  </div>

  <script>
    // monEZ - Premium Expense Splitting App
    // Global Edition with ACID Storage & Multi-Language/Currency Support

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ACID-COMPLIANT STORAGE MANAGER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    class StorageManager {
      constructor() {
        this.VERSION = 2;
        this.PREFIX = 'monez_';
        this._locked = false;
        this._transactionBackup = null;
      }

      // ATOMICITY: All-or-nothing transactions
      async transaction(operations) {
        if (this._locked) {
          throw new Error('Storage is locked. Transaction in progress.');
        }

        this.lock();
        this._transactionBackup = this.backup();

        try {
          for (const op of operations) {
            await op();
          }
          this.verify();
          this._transactionBackup = null;
          return true;
        } catch (e) {
          console.error('Transaction failed, rolling back:', e);
          this.restore(this._transactionBackup);
          throw new Error('Transaction failed: ' + e.message);
        } finally {
          this.unlock();
        }
      }

      // CONSISTENCY: Validate data before write
      validate(key, data) {
        const schemas = {
          expenses: (d) => Array.isArray(d) && d.every(e =>
            typeof e.id !== 'undefined' &&
            typeof e.amount === 'number' &&
            typeof e.description === 'string'
          ),
          friends: (d) => Array.isArray(d) && d.every(f =>
            typeof f.name === 'string'
          ),
          groups: (d) => Array.isArray(d) && d.every(g =>
            typeof g.id !== 'undefined' &&
            typeof g.name === 'string'
          ),
          settings: (d) => typeof d === 'object' && d !== null
        };

        const validator = schemas[key];
        if (validator && !validator(data)) {
          throw new Error(`Consistency check failed for ${key}`);
        }
        return true;
      }

      // ISOLATION: Lock during operations
      lock() { this._locked = true; }
      unlock() { this._locked = false; }
      isLocked() { return this._locked; }

      // DURABILITY: Save with verification
      save(key, data) {
        this.validate(key, data);
        const fullKey = this.PREFIX + key;
        const json = JSON.stringify(data);

        localStorage.setItem(fullKey, json);

        // Durability check: verify write
        const verify = localStorage.getItem(fullKey);
        if (json !== verify) {
          throw new Error('Durability check failed: write verification mismatch');
        }

        // Save version info
        localStorage.setItem(this.PREFIX + 'version', this.VERSION.toString());
        localStorage.setItem(this.PREFIX + 'lastSave', new Date().toISOString());

        return true;
      }

      load(key, defaultValue = null) {
        try {
          const data = localStorage.getItem(this.PREFIX + key);
          return data ? safeJSONParse(data, defaultValue) : defaultValue;
        } catch (e) {
          console.error('Load error:', e);
          return defaultValue;
        }
      }

      backup() {
        const backup = {};
        const keys = ['expenses', 'friends', 'groups', 'settings'];
        keys.forEach(key => {
          backup[key] = localStorage.getItem(this.PREFIX + key);
        });
        backup._timestamp = Date.now();
        return backup;
      }

      restore(backup) {
        if (!backup) return;
        Object.keys(backup).forEach(key => {
          if (key !== '_timestamp') {
            if (backup[key] !== null) {
              localStorage.setItem(this.PREFIX + key, backup[key]);
            } else {
              localStorage.removeItem(this.PREFIX + key);
            }
          }
        });
      }

      verify() {
        const keys = ['expenses', 'friends', 'groups'];
        for (const key of keys) {
          const data = this.load(key, []);
          this.validate(key, data);
        }
        return true;
      }

      // Export all data as JSON
      exportData() {
        return {
          version: this.VERSION,
          exportDate: new Date().toISOString(),
          expenses: this.load('expenses', []),
          friends: this.load('friends', []),
          groups: this.load('groups', []),
          settings: this.load('settings', {})
        };
      }

      // Export as CSV
      exportCSV() {
        const expenses = this.load('expenses', []);
        const headers = ['ID', 'Description', 'Amount', 'Date', 'Category', 'Paid By', 'Split With', 'Status'];
        const rows = expenses.map(e => [
          e.id,
          `"${e.description}"`,
          e.amount,
          e.date,
          e.category || '',
          e.paidBy || '',
          (e.splitWith || []).join('; '),
          e.status || ''
        ]);
        return [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
      }
    }

    // Global storage instance
    const storage = new StorageManager();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // COMPREHENSIVE CURRENCY DATA (50+ currencies - All 7 Continents)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const CURRENCIES = {
      // ‚îÄ‚îÄ‚îÄ ASIA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      INR: { symbol: '‚Çπ', name: 'Indian Rupee', locale: 'en-IN', decimals: 2 },
      JPY: { symbol: '¬•', name: 'Japanese Yen', locale: 'ja-JP', decimals: 0 },
      CNY: { symbol: '¬•', name: 'Chinese Yuan', locale: 'zh-CN', decimals: 2 },
      KRW: { symbol: '‚Ç©', name: 'South Korean Won', locale: 'ko-KR', decimals: 0 },
      SGD: { symbol: 'S$', name: 'Singapore Dollar', locale: 'en-SG', decimals: 2 },
      HKD: { symbol: 'HK$', name: 'Hong Kong Dollar', locale: 'zh-HK', decimals: 2 },
      TWD: { symbol: 'NT$', name: 'Taiwan Dollar', locale: 'zh-TW', decimals: 0 },
      THB: { symbol: '‡∏ø', name: 'Thai Baht', locale: 'th-TH', decimals: 2 },
      MYR: { symbol: 'RM', name: 'Malaysian Ringgit', locale: 'ms-MY', decimals: 2 },
      IDR: { symbol: 'Rp', name: 'Indonesian Rupiah', locale: 'id-ID', decimals: 0 },
      PHP: { symbol: '‚Ç±', name: 'Philippine Peso', locale: 'en-PH', decimals: 2 },
      VND: { symbol: '‚Ç´', name: 'Vietnamese Dong', locale: 'vi-VN', decimals: 0 },
      PKR: { symbol: '‚Ç®', name: 'Pakistani Rupee', locale: 'ur-PK', decimals: 2 },
      BDT: { symbol: '‡ß≥', name: 'Bangladeshi Taka', locale: 'bn-BD', decimals: 2 },
      LKR: { symbol: 'Rs', name: 'Sri Lankan Rupee', locale: 'si-LK', decimals: 2 },
      NPR: { symbol: '‡§∞‡•Ç', name: 'Nepalese Rupee', locale: 'ne-NP', decimals: 2 },

      // ‚îÄ‚îÄ‚îÄ MIDDLE EAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      AED: { symbol: 'ÿØ.ÿ•', name: 'UAE Dirham', locale: 'ar-AE', decimals: 2 },
      SAR: { symbol: 'Ô∑º', name: 'Saudi Riyal', locale: 'ar-SA', decimals: 2 },
      QAR: { symbol: 'ÿ±.ŸÇ', name: 'Qatari Riyal', locale: 'ar-QA', decimals: 2 },
      KWD: { symbol: 'ÿØ.ŸÉ', name: 'Kuwaiti Dinar', locale: 'ar-KW', decimals: 3 },
      BHD: { symbol: 'ÿ®.ÿØ', name: 'Bahraini Dinar', locale: 'ar-BH', decimals: 3 },
      OMR: { symbol: 'ÿ±.ÿπ', name: 'Omani Rial', locale: 'ar-OM', decimals: 3 },
      ILS: { symbol: '‚Ç™', name: 'Israeli Shekel', locale: 'he-IL', decimals: 2 },
      TRY: { symbol: '‚Ç∫', name: 'Turkish Lira', locale: 'tr-TR', decimals: 2 },

      // ‚îÄ‚îÄ‚îÄ EUROPE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      EUR: { symbol: '‚Ç¨', name: 'Euro', locale: 'de-DE', decimals: 2 },
      GBP: { symbol: '¬£', name: 'British Pound', locale: 'en-GB', decimals: 2 },
      CHF: { symbol: 'Fr', name: 'Swiss Franc', locale: 'de-CH', decimals: 2 },
      SEK: { symbol: 'kr', name: 'Swedish Krona', locale: 'sv-SE', decimals: 2 },
      NOK: { symbol: 'kr', name: 'Norwegian Krone', locale: 'nb-NO', decimals: 2 },
      DKK: { symbol: 'kr', name: 'Danish Krone', locale: 'da-DK', decimals: 2 },
      PLN: { symbol: 'z≈Ç', name: 'Polish Zloty', locale: 'pl-PL', decimals: 2 },
      CZK: { symbol: 'Kƒç', name: 'Czech Koruna', locale: 'cs-CZ', decimals: 2 },
      HUF: { symbol: 'Ft', name: 'Hungarian Forint', locale: 'hu-HU', decimals: 0 },
      RUB: { symbol: '‚ÇΩ', name: 'Russian Ruble', locale: 'ru-RU', decimals: 2 },
      UAH: { symbol: '‚Ç¥', name: 'Ukrainian Hryvnia', locale: 'uk-UA', decimals: 2 },
      RON: { symbol: 'lei', name: 'Romanian Leu', locale: 'ro-RO', decimals: 2 },

      // ‚îÄ‚îÄ‚îÄ AMERICAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      USD: { symbol: '$', name: 'US Dollar', locale: 'en-US', decimals: 2 },
      CAD: { symbol: 'C$', name: 'Canadian Dollar', locale: 'en-CA', decimals: 2 },
      MXN: { symbol: '$', name: 'Mexican Peso', locale: 'es-MX', decimals: 2 },
      BRL: { symbol: 'R$', name: 'Brazilian Real', locale: 'pt-BR', decimals: 2 },
      ARS: { symbol: '$', name: 'Argentine Peso', locale: 'es-AR', decimals: 2 },
      CLP: { symbol: '$', name: 'Chilean Peso', locale: 'es-CL', decimals: 0 },
      COP: { symbol: '$', name: 'Colombian Peso', locale: 'es-CO', decimals: 0 },
      PEN: { symbol: 'S/', name: 'Peruvian Sol', locale: 'es-PE', decimals: 2 },

      // ‚îÄ‚îÄ‚îÄ AFRICA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      ZAR: { symbol: 'R', name: 'South African Rand', locale: 'en-ZA', decimals: 2 },
      NGN: { symbol: '‚Ç¶', name: 'Nigerian Naira', locale: 'en-NG', decimals: 2 },
      EGP: { symbol: 'E¬£', name: 'Egyptian Pound', locale: 'ar-EG', decimals: 2 },
      KES: { symbol: 'KSh', name: 'Kenyan Shilling', locale: 'sw-KE', decimals: 2 },
      GHS: { symbol: 'GH‚Çµ', name: 'Ghanaian Cedi', locale: 'en-GH', decimals: 2 },
      MAD: { symbol: 'ÿØ.ŸÖ', name: 'Moroccan Dirham', locale: 'ar-MA', decimals: 2 },
      TZS: { symbol: 'TSh', name: 'Tanzanian Shilling', locale: 'sw-TZ', decimals: 0 },
      UGX: { symbol: 'USh', name: 'Ugandan Shilling', locale: 'en-UG', decimals: 0 },

      // ‚îÄ‚îÄ‚îÄ OCEANIA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      AUD: { symbol: 'A$', name: 'Australian Dollar', locale: 'en-AU', decimals: 2 },
      NZD: { symbol: 'NZ$', name: 'New Zealand Dollar', locale: 'en-NZ', decimals: 2 },
      FJD: { symbol: 'FJ$', name: 'Fijian Dollar', locale: 'en-FJ', decimals: 2 },
    };


    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // COUNTRIES - Country-first data model with multi-currency support
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EXPANDED COUNTRIES - 100+ countries with comprehensive coverage
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const COUNTRIES = {
      // Americas (20 countries)
      US: { name: 'United States', flag: 'üá∫üá∏', currencies: ['USD'], languages: ['en', 'es'] },
      CA: { name: 'Canada', flag: 'üá®üá¶', currencies: ['CAD'], languages: ['en', 'fr'] },
      MX: { name: 'Mexico', flag: 'üá≤üáΩ', currencies: ['MXN'], languages: ['es', 'en'] },
      BR: { name: 'Brazil', flag: 'üáßüá∑', currencies: ['BRL'], languages: ['pt', 'en'] },
      AR: { name: 'Argentina', flag: 'üá¶üá∑', currencies: ['ARS'], languages: ['es', 'en'] },
      CL: { name: 'Chile', flag: 'üá®üá±', currencies: ['CLP'], languages: ['es', 'en'] },
      CO: { name: 'Colombia', flag: 'üá®üá¥', currencies: ['COP'], languages: ['es', 'en'] },
      PE: { name: 'Peru', flag: 'üáµüá™', currencies: ['PEN'], languages: ['es', 'en'] },
      VE: { name: 'Venezuela', flag: 'üáªüá™', currencies: ['VES'], languages: ['es', 'en'] },
      EC: { name: 'Ecuador', flag: 'üá™üá®', currencies: ['USD'], languages: ['es', 'en'] },
      BO: { name: 'Bolivia', flag: 'üáßüá¥', currencies: ['BOB'], languages: ['es', 'en'] },
      PY: { name: 'Paraguay', flag: 'üáµüáæ', currencies: ['PYG'], languages: ['es', 'en'] },
      UY: { name: 'Uruguay', flag: 'üá∫üáæ', currencies: ['UYU'], languages: ['es', 'en'] },
      CR: { name: 'Costa Rica', flag: 'üá®üá∑', currencies: ['CRC'], languages: ['es', 'en'] },
      PA: { name: 'Panama', flag: 'üáµüá¶', currencies: ['PAB', 'USD'], languages: ['es', 'en'] },
      GT: { name: 'Guatemala', flag: 'üá¨üáπ', currencies: ['GTQ'], languages: ['es', 'en'] },
      CU: { name: 'Cuba', flag: 'üá®üá∫', currencies: ['CUP'], languages: ['es', 'en'] },
      DO: { name: 'Dominican Republic', flag: 'üá©üá¥', currencies: ['DOP'], languages: ['es', 'en'] },
      HN: { name: 'Honduras', flag: 'üá≠üá≥', currencies: ['HNL'], languages: ['es', 'en'] },
      JM: { name: 'Jamaica', flag: 'üáØüá≤', currencies: ['JMD'], languages: ['en'] },

      // Europe (30 countries)
      GB: { name: 'United Kingdom', flag: 'üá¨üáß', currencies: ['GBP'], languages: ['en'] },
      DE: { name: 'Germany', flag: 'üá©üá™', currencies: ['EUR'], languages: ['de', 'en'] },
      FR: { name: 'France', flag: 'üá´üá∑', currencies: ['EUR'], languages: ['fr', 'en'] },
      IT: { name: 'Italy', flag: 'üáÆüáπ', currencies: ['EUR'], languages: ['it', 'en'] },
      ES: { name: 'Spain', flag: 'üá™üá∏', currencies: ['EUR'], languages: ['es', 'en'] },
      NL: { name: 'Netherlands', flag: 'üá≥üá±', currencies: ['EUR'], languages: ['nl', 'en'] },
      BE: { name: 'Belgium', flag: 'üáßüá™', currencies: ['EUR'], languages: ['nl', 'fr', 'de', 'en'] },
      CH: { name: 'Switzerland', flag: 'üá®üá≠', currencies: ['CHF', 'EUR'], languages: ['de', 'fr', 'it', 'en'] },
      AT: { name: 'Austria', flag: 'üá¶üáπ', currencies: ['EUR'], languages: ['de', 'en'] },
      PL: { name: 'Poland', flag: 'üáµüá±', currencies: ['PLN'], languages: ['pl', 'en'] },
      SE: { name: 'Sweden', flag: 'üá∏üá™', currencies: ['SEK'], languages: ['sv', 'en'] },
      NO: { name: 'Norway', flag: 'üá≥üá¥', currencies: ['NOK'], languages: ['no', 'en'] },
      DK: { name: 'Denmark', flag: 'üá©üá∞', currencies: ['DKK'], languages: ['da', 'en'] },
      FI: { name: 'Finland', flag: 'üá´üáÆ', currencies: ['EUR'], languages: ['fi', 'sv', 'en'] },
      IE: { name: 'Ireland', flag: 'üáÆüá™', currencies: ['EUR'], languages: ['en', 'ga'] },
      PT: { name: 'Portugal', flag: 'üáµüáπ', currencies: ['EUR'], languages: ['pt', 'en'] },
      GR: { name: 'Greece', flag: 'üá¨üá∑', currencies: ['EUR'], languages: ['el', 'en'] },
      CZ: { name: 'Czech Republic', flag: 'üá®üáø', currencies: ['CZK'], languages: ['cs', 'en'] },
      RO: { name: 'Romania', flag: 'üá∑üá¥', currencies: ['RON'], languages: ['ro', 'en'] },
      HU: { name: 'Hungary', flag: 'üá≠üá∫', currencies: ['HUF'], languages: ['hu', 'en'] },
      BG: { name: 'Bulgaria', flag: 'üáßüá¨', currencies: ['BGN'], languages: ['bg', 'en'] },
      SK: { name: 'Slovakia', flag: 'üá∏üá∞', currencies: ['EUR'], languages: ['sk', 'en'] },
      HR: { name: 'Croatia', flag: 'üá≠üá∑', currencies: ['EUR'], languages: ['hr', 'en'] },
      SI: { name: 'Slovenia', flag: 'üá∏üáÆ', currencies: ['EUR'], languages: ['sl', 'en'] },
      LT: { name: 'Lithuania', flag: 'üá±üáπ', currencies: ['EUR'], languages: ['lt', 'en'] },
      LV: { name: 'Latvia', flag: 'üá±üáª', currencies: ['EUR'], languages: ['lv', 'en'] },
      EE: { name: 'Estonia', flag: 'üá™üá™', currencies: ['EUR'], languages: ['et', 'en'] },
      IS: { name: 'Iceland', flag: 'üáÆüá∏', currencies: ['ISK'], languages: ['is', 'en'] },
      LU: { name: 'Luxembourg', flag: 'üá±üá∫', currencies: ['EUR'], languages: ['lb', 'fr', 'de', 'en'] },
      MT: { name: 'Malta', flag: 'üá≤üáπ', currencies: ['EUR'], languages: ['mt', 'en'] },

      // Asia (25 countries)
      CN: { name: 'China', flag: 'üá®üá≥', currencies: ['CNY'], languages: ['zh', 'en'] },
      IN: { name: 'India', flag: 'üáÆüá≥', currencies: ['INR'], languages: ['hi', 'en', 'ta', 'te', 'bn', 'mr'] },
      JP: { name: 'Japan', flag: 'üáØüáµ', currencies: ['JPY'], languages: ['ja', 'en'] },
      KR: { name: 'South Korea', flag: 'üá∞üá∑', currencies: ['KRW'], languages: ['ko', 'en'] },
      ID: { name: 'Indonesia', flag: 'üáÆüá©', currencies: ['IDR'], languages: ['id', 'en'] },
      TH: { name: 'Thailand', flag: 'üáπüá≠', currencies: ['THB'], languages: ['th', 'en'] },
      VN: { name: 'Vietnam', flag: 'üáªüá≥', currencies: ['VND'], languages: ['vi', 'en'] },
      PH: { name: 'Philippines', flag: 'üáµüá≠', currencies: ['PHP'], languages: ['tl', 'en'] },
      MY: { name: 'Malaysia', flag: 'üá≤üáæ', currencies: ['MYR'], languages: ['ms', 'en', 'zh'] },
      SG: { name: 'Singapore', flag: 'üá∏üá¨', currencies: ['SGD'], languages: ['en', 'zh', 'ms', 'ta'] },
      PK: { name: 'Pakistan', flag: 'üáµüá∞', currencies: ['PKR'], languages: ['ur', 'en'] },
      BD: { name: 'Bangladesh', flag: 'üáßüá©', currencies: ['BDT'], languages: ['bn', 'en'] },
      LK: { name: 'Sri Lanka', flag: 'üá±üá∞', currencies: ['LKR'], languages: ['si', 'ta', 'en'] },
      MM: { name: 'Myanmar', flag: 'üá≤üá≤', currencies: ['MMK'], languages: ['my', 'en'] },
      KH: { name: 'Cambodia', flag: 'üá∞üá≠', currencies: ['KHR'], languages: ['km', 'en'] },
      LA: { name: 'Laos', flag: 'üá±üá¶', currencies: ['LAK'], languages: ['lo', 'en'] },
      NP: { name: 'Nepal', flag: 'üá≥üáµ', currencies: ['NPR'], languages: ['ne', 'en'] },
      AF: { name: 'Afghanistan', flag: 'üá¶üá´', currencies: ['AFN'], languages: ['fa', 'ps', 'en'] },
      KZ: { name: 'Kazakhstan', flag: 'üá∞üáø', currencies: ['KZT'], languages: ['kk', 'ru', 'en'] },
      UZ: { name: 'Uzbekistan', flag: 'üá∫üáø', currencies: ['UZS'], languages: ['uz', 'ru', 'en'] },
      MN: { name: 'Mongolia', flag: 'üá≤üá≥', currencies: ['MNT'], languages: ['mn', 'en'] },
      TW: { name: 'Taiwan', flag: 'üáπüáº', currencies: ['TWD'], languages: ['zh', 'en'] },
      HK: { name: 'Hong Kong', flag: 'üá≠üá∞', currencies: ['HKD'], languages: ['zh', 'en'] },
      MO: { name: 'Macau', flag: 'üá≤üá¥', currencies: ['MOP'], languages: ['zh', 'pt', 'en'] },
      BN: { name: 'Brunei', flag: 'üáßüá≥', currencies: ['BND'], languages: ['ms', 'en'] },

      // Middle East (15 countries)
      SA: { name: 'Saudi Arabia', flag: 'üá∏üá¶', currencies: ['SAR'], languages: ['ar', 'en'] },
      AE: { name: 'UAE', flag: 'üá¶üá™', currencies: ['AED'], languages: ['ar', 'en'] },
      TR: { name: 'Turkey', flag: 'üáπüá∑', currencies: ['TRY'], languages: ['tr', 'en'] },
      IL: { name: 'Israel', flag: 'üáÆüá±', currencies: ['ILS'], languages: ['he', 'ar', 'en'] },
      IR: { name: 'Iran', flag: 'üáÆüá∑', currencies: ['IRR'], languages: ['fa', 'en'] },
      IQ: { name: 'Iraq', flag: 'üáÆüá∂', currencies: ['IQD'], languages: ['ar', 'ku', 'en'] },
      EG: { name: 'Egypt', flag: 'üá™üá¨', currencies: ['EGP'], languages: ['ar', 'en'] },
      JO: { name: 'Jordan', flag: 'üáØüá¥', currencies: ['JOD'], languages: ['ar', 'en'] },
      LB: { name: 'Lebanon', flag: 'üá±üáß', currencies: ['LBP'], languages: ['ar', 'fr', 'en'] },
      SY: { name: 'Syria', flag: 'üá∏üáæ', currencies: ['SYP'], languages: ['ar', 'en'] },
      YE: { name: 'Yemen', flag: 'üáæüá™', currencies: ['YER'], languages: ['ar', 'en'] },
      OM: { name: 'Oman', flag: 'üá¥üá≤', currencies: ['OMR'], languages: ['ar', 'en'] },
      KW: { name: 'Kuwait', flag: 'üá∞üáº', currencies: ['KWD'], languages: ['ar', 'en'] },
      QA: { name: 'Qatar', flag: 'üá∂üá¶', currencies: ['QAR'], languages: ['ar', 'en'] },
      BH: { name: 'Bahrain', flag: 'üáßüá≠', currencies: ['BHD'], languages: ['ar', 'en'] },

      // Africa (15 countries)
      ZA: { name: 'South Africa', flag: 'üáøüá¶', currencies: ['ZAR'], languages: ['af', 'en', 'zu', 'xh'] },
      NG: { name: 'Nigeria', flag: 'üá≥üá¨', currencies: ['NGN'], languages: ['en', 'ha', 'yo', 'ig'] },
      KE: { name: 'Kenya', flag: 'üá∞üá™', currencies: ['KES'], languages: ['sw', 'en'] },
      ET: { name: 'Ethiopia', flag: 'üá™üáπ', currencies: ['ETB'], languages: ['am', 'en'] },
      GH: { name: 'Ghana', flag: 'üá¨üá≠', currencies: ['GHS'], languages: ['en'] },
      TZ: { name: 'Tanzania', flag: 'üáπüáø', currencies: ['TZS'], languages: ['sw', 'en'] },
      UG: { name: 'Uganda', flag: 'üá∫üá¨', currencies: ['UGX'], languages: ['en', 'sw'] },
      DZ: { name: 'Algeria', flag: 'üá©üáø', currencies: ['DZD'], languages: ['ar', 'fr', 'en'] },
      MA: { name: 'Morocco', flag: 'üá≤üá¶', currencies: ['MAD'], languages: ['ar', 'fr', 'en'] },
      TN: { name: 'Tunisia', flag: 'üáπüá≥', currencies: ['TND'], languages: ['ar', 'fr', 'en'] },
      ZW: { name: 'Zimbabwe', flag: 'üáøüáº', currencies: ['USD', 'ZAR', 'BWP'], languages: ['en', 'sn', 'nd'] },
      ZM: { name: 'Zambia', flag: 'üáøüá≤', currencies: ['ZMW'], languages: ['en'] },
      SN: { name: 'Senegal', flag: 'üá∏üá≥', currencies: ['XOF'], languages: ['fr', 'wo', 'en'] },
      CI: { name: 'Ivory Coast', flag: 'üá®üáÆ', currencies: ['XOF'], languages: ['fr', 'en'] },
      CM: { name: 'Cameroon', flag: 'üá®üá≤', currencies: ['XAF'], languages: ['fr', 'en'] },

      // Oceania (5 countries)
      AU: { name: 'Australia', flag: 'üá¶üá∫', currencies: ['AUD'], languages: ['en'] },
      NZ: { name: 'New Zealand', flag: 'üá≥üáø', currencies: ['NZD'], languages: ['en', 'mi'] },
      FJ: { name: 'Fiji', flag: 'üá´üáØ', currencies: ['FJD'], languages: ['en', 'fj', 'hi'] },
      PG: { name: 'Papua New Guinea', flag: 'üáµüá¨', currencies: ['PGK'], languages: ['en'] },
      NC: { name: 'New Caledonia', flag: 'üá≥üá®', currencies: ['XPF'], languages: ['fr', 'en'] },

      // Eastern Europe & Russia (5 countries)
      RU: { name: 'Russia', flag: 'üá∑üá∫', currencies: ['RUB'], languages: ['ru', 'en'] },
      UA: { name: 'Ukraine', flag: 'üá∫üá¶', currencies: ['UAH'], languages: ['uk', 'ru', 'en'] },
      BY: { name: 'Belarus', flag: 'üáßüáæ', currencies: ['BYN'], languages: ['be', 'ru', 'en'] },
      MD: { name: 'Moldova', flag: 'üá≤üá©', currencies: ['MDL'], languages: ['ro', 'ru', 'en'] },
      GE: { name: 'Georgia', flag: 'üá¨üá™', currencies: ['GEL'], languages: ['ka', 'en'] },
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MULTI-LANGUAGE SYSTEM (20+ Languages with RTL Support)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EXPANDED LANGUAGES - 50+ languages with native names and RTL support
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const LANGUAGES = {
      // Western European Languages
      en: { name: 'English', nativeName: 'English', dir: 'ltr', defaultCurrency: 'USD' },
      es: { name: 'Spanish', nativeName: 'Espa√±ol', dir: 'ltr', defaultCurrency: 'EUR' },
      pt: { name: 'Portuguese', nativeName: 'Portugu√™s', dir: 'ltr', defaultCurrency: 'BRL' },
      fr: { name: 'French', nativeName: 'Fran√ßais', dir: 'ltr', defaultCurrency: 'EUR' },
      de: { name: 'German', nativeName: 'Deutsch', dir: 'ltr', defaultCurrency: 'EUR' },
      it: { name: 'Italian', nativeName: 'Italiano', dir: 'ltr', defaultCurrency: 'EUR' },
      nl: { name: 'Dutch', nativeName: 'Nederlands', dir: 'ltr', defaultCurrency: 'EUR' },
      pl: { name: 'Polish', nativeName: 'Polski', dir: 'ltr', defaultCurrency: 'PLN' },

      // Nordic Languages
      sv: { name: 'Swedish', nativeName: 'Svenska', dir: 'ltr', defaultCurrency: 'SEK' },
      no: { name: 'Norwegian', nativeName: 'Norsk', dir: 'ltr', defaultCurrency: 'NOK' },
      da: { name: 'Danish', nativeName: 'Dansk', dir: 'ltr', defaultCurrency: 'DKK' },
      fi: { name: 'Finnish', nativeName: 'Suomi', dir: 'ltr', defaultCurrency: 'EUR' },
      is: { name: 'Icelandic', nativeName: '√çslenska', dir: 'ltr', defaultCurrency: 'ISK' },

      // Eastern European Languages
      ru: { name: 'Russian', nativeName: '–†—É—Å—Å–∫–∏–π', dir: 'ltr', defaultCurrency: 'RUB' },
      uk: { name: 'Ukrainian', nativeName: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞', dir: 'ltr', defaultCurrency: 'UAH' },
      be: { name: 'Belarusian', nativeName: '–ë–µ–ª–∞—Ä—É—Å–∫–∞—è', dir: 'ltr', defaultCurrency: 'BYN' },
      cs: { name: 'Czech', nativeName: 'ƒåe≈°tina', dir: 'ltr', defaultCurrency: 'CZK' },
      sk: { name: 'Slovak', nativeName: 'Slovenƒçina', dir: 'ltr', defaultCurrency: 'EUR' },
      ro: { name: 'Romanian', nativeName: 'Rom√¢nƒÉ', dir: 'ltr', defaultCurrency: 'RON' },
      hu: { name: 'Hungarian', nativeName: 'Magyar', dir: 'ltr', defaultCurrency: 'HUF' },
      bg: { name: 'Bulgarian', nativeName: '–ë—ä–ª–≥–∞—Ä—Å–∫–∏', dir: 'ltr', defaultCurrency: 'BGN' },
      hr: { name: 'Croatian', nativeName: 'Hrvatski', dir: 'ltr', defaultCurrency: 'EUR' },
      sl: { name: 'Slovenian', nativeName: 'Sloven≈°ƒçina', dir: 'ltr', defaultCurrency: 'EUR' },
      lt: { name: 'Lithuanian', nativeName: 'Lietuvi≈≥', dir: 'ltr', defaultCurrency: 'EUR' },
      lv: { name: 'Latvian', nativeName: 'Latvie≈°u', dir: 'ltr', defaultCurrency: 'EUR' },
      et: { name: 'Estonian', nativeName: 'Eesti', dir: 'ltr', defaultCurrency: 'EUR' },

      // Other European Languages
      tr: { name: 'Turkish', nativeName: 'T√ºrk√ße', dir: 'ltr', defaultCurrency: 'TRY' },
      el: { name: 'Greek', nativeName: 'ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨', dir: 'ltr', defaultCurrency: 'EUR' },
      ga: { name: 'Irish', nativeName: 'Gaeilge', dir: 'ltr', defaultCurrency: 'EUR' },
      mt: { name: 'Maltese', nativeName: 'Malti', dir: 'ltr', defaultCurrency: 'EUR' },
      lb: { name: 'Luxembourgish', nativeName: 'L√´tzebuergesch', dir: 'ltr', defaultCurrency: 'EUR' },
      ka: { name: 'Georgian', nativeName: '·É•·Éê·É†·Éó·É£·Éö·Éò', dir: 'ltr', defaultCurrency: 'GEL' },

      // Asian Languages
      zh: { name: 'Chinese', nativeName: '‰∏≠Êñá', dir: 'ltr', defaultCurrency: 'CNY' },
      ja: { name: 'Japanese', nativeName: 'Êó•Êú¨Ë™û', dir: 'ltr', defaultCurrency: 'JPY' },
      ko: { name: 'Korean', nativeName: 'ÌïúÍµ≠Ïñ¥', dir: 'ltr', defaultCurrency: 'KRW' },
      hi: { name: 'Hindi', nativeName: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', dir: 'ltr', defaultCurrency: 'INR' },
      bn: { name: 'Bengali', nativeName: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ', dir: 'ltr', defaultCurrency: 'BDT' },
      ta: { name: 'Tamil', nativeName: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç', dir: 'ltr', defaultCurrency: 'INR' },
      te: { name: 'Telugu', nativeName: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å', dir: 'ltr', defaultCurrency: 'INR' },
      mr: { name: 'Marathi', nativeName: '‡§Æ‡§∞‡§æ‡§†‡•Ä', dir: 'ltr', defaultCurrency: 'INR' },
      th: { name: 'Thai', nativeName: '‡πÑ‡∏ó‡∏¢', dir: 'ltr', defaultCurrency: 'THB' },
      vi: { name: 'Vietnamese', nativeName: 'Ti·∫øng Vi·ªát', dir: 'ltr', defaultCurrency: 'VND' },
      id: { name: 'Indonesian', nativeName: 'Bahasa Indonesia', dir: 'ltr', defaultCurrency: 'IDR' },
      ms: { name: 'Malay', nativeName: 'Bahasa Melayu', dir: 'ltr', defaultCurrency: 'MYR' },
      tl: { name: 'Tagalog', nativeName: 'Tagalog', dir: 'ltr', defaultCurrency: 'PHP' },
      my: { name: 'Burmese', nativeName: '·Äô·Äº·Äî·Ä∫·Äô·Ä¨·Äò·Ä¨·Äû·Ä¨', dir: 'ltr', defaultCurrency: 'MMK' },
      km: { name: 'Khmer', nativeName: '·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö', dir: 'ltr', defaultCurrency: 'KHR' },
      lo: { name: 'Lao', nativeName: '‡∫•‡∫≤‡∫ß', dir: 'ltr', defaultCurrency: 'LAK' },
      ne: { name: 'Nepali', nativeName: '‡§®‡•á‡§™‡§æ‡§≤‡•Ä', dir: 'ltr', defaultCurrency: 'NPR' },
      si: { name: 'Sinhala', nativeName: '‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω', dir: 'ltr', defaultCurrency: 'LKR' },
      mn: { name: 'Mongolian', nativeName: '–ú–æ–Ω–≥–æ–ª', dir: 'ltr', defaultCurrency: 'MNT' },
      kk: { name: 'Kazakh', nativeName: '“ö–∞–∑–∞“õ—à–∞', dir: 'ltr', defaultCurrency: 'KZT' },
      uz: { name: 'Uzbek', nativeName: 'O ªzbekcha', dir: 'ltr', defaultCurrency: 'UZS' },

      // RTL Languages (Middle East)
      ar: { name: 'Arabic', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', dir: 'rtl', defaultCurrency: 'AED' },
      he: { name: 'Hebrew', nativeName: '◊¢◊ë◊®◊ô◊™', dir: 'rtl', defaultCurrency: 'ILS' },
      fa: { name: 'Persian', nativeName: 'ŸÅÿßÿ±ÿ≥€å', dir: 'rtl', defaultCurrency: 'IRR' },
      ur: { name: 'Urdu', nativeName: 'ÿßÿ±ÿØŸà', dir: 'rtl', defaultCurrency: 'PKR' },
      ps: { name: 'Pashto', nativeName: 'Ÿæ⁄öÿ™Ÿà', dir: 'rtl', defaultCurrency: 'AFN' },
      ku: { name: 'Kurdish', nativeName: '⁄©Ÿàÿ±ÿØ€å', dir: 'rtl', defaultCurrency: 'IQD' },

      // African Languages
      sw: { name: 'Swahili', nativeName: 'Kiswahili', dir: 'ltr', defaultCurrency: 'KES' },
      am: { name: 'Amharic', nativeName: '·ä†·àõ·à≠·äõ', dir: 'ltr', defaultCurrency: 'ETB' },
      ha: { name: 'Hausa', nativeName: 'Hausa', dir: 'ltr', defaultCurrency: 'NGN' },
      yo: { name: 'Yoruba', nativeName: 'Yor√πb√°', dir: 'ltr', defaultCurrency: 'NGN' },
      ig: { name: 'Igbo', nativeName: 'Igbo', dir: 'ltr', defaultCurrency: 'NGN' },
      zu: { name: 'Zulu', nativeName: 'isiZulu', dir: 'ltr', defaultCurrency: 'ZAR' },
      xh: { name: 'Xhosa', nativeName: 'isiXhosa', dir: 'ltr', defaultCurrency: 'ZAR' },
      af: { name: 'Afrikaans', nativeName: 'Afrikaans', dir: 'ltr', defaultCurrency: 'ZAR' },
      sn: { name: 'Shona', nativeName: 'chiShona', dir: 'ltr', defaultCurrency: 'USD' },
      nd: { name: 'Ndebele', nativeName: 'isiNdebele', dir: 'ltr', defaultCurrency: 'ZAR' },
      wo: { name: 'Wolof', nativeName: 'Wolof', dir: 'ltr', defaultCurrency: 'XOF' },

      // Pacific Languages
      mi: { name: 'Maori', nativeName: 'Te Reo MƒÅori', dir: 'ltr', defaultCurrency: 'NZD' },
      fj: { name: 'Fijian', nativeName: 'Vosa Vakaviti', dir: 'ltr', defaultCurrency: 'FJD' },
    };

    // Translation strings for all languages
    const TRANSLATIONS = {
      en: {
        app_name: 'monEZ',
        tagline: 'Split expenses, not friendships',
        home: 'Home',
        expenses: 'Expenses',
        balances: 'Balances',
        groups: 'Groups',
        settings: 'Settings',
        premium: 'Features',
        add_expense: 'Add Expense',
        split_bill: 'Split Bill',
        settle_up: 'Settle Up',
        ai_insights: 'AI Insights',
        you_owe: 'You owe',
        you_are_owed: "You're owed",
        your_balance: 'Your balance',
        recent_activity: 'Recent Activity',
        view_all: 'View all',
        your_groups: 'Your Groups',
        amount: 'Amount',
        description: 'Description',
        category: 'Category',
        split_with: 'Split with',
        save_expense: 'Save Expense',
        cancel: 'Cancel',
        equal_split: 'Equal Split',
        by_percentage: 'By Percentage',
        custom_split: 'Custom Split',
        search_expenses: 'Search expenses...',
        no_expenses: 'No expenses yet',
        all_settled: 'All settled up!',
        export_data: 'Export Data',
        import_data: 'Import Data',
        language: 'Language',
        country: 'Country',
        currency: 'Currency',
        notifications: 'Notifications',
        dark_mode: 'Dark Mode',
        profile: 'Profile',
        payment_methods: 'Payment Methods',
        owes_you: 'owes you',
        remind: 'Remind',
        pay_now: 'Pay Now',
        settle_all: 'Settle All',
        create_group: 'Create Group',
        food: 'Food',
        transport: 'Transport',
        entertainment: 'Entertainment',
        shopping: 'Shopping',
        bills: 'Bills',
        travel: 'Travel',
        welcome: 'Welcome to monEZ!',
        expense_added: 'Expense added successfully!',
        loading: 'Loading...',
        total_spent: 'Total Spent',
        this_month: 'This Month',
        filter_expenses: 'Filter Expenses',
        add_new_expense: 'Add New Expense',
        what_for: 'What was this for?',
        install_app: 'Install monEZ',
        install_desc: 'Get the full app experience on your home screen',
        maybe_later: 'Maybe later',
        install: 'Install',
        signin_to_sync: 'Sign In to Sync',
        access_data: 'Access your data from any device',
        synced: 'Synced',
        sync_now: 'Sync Now',
        sign_out: 'Sign Out',
        localization: 'Localization',
        data_management: 'Data Management',
        export_json: 'Export as JSON',
        export_csv: 'Export as CSV',
        about: 'About',
        version_info: 'v2.0 ‚Ä¢ 55 currencies ‚Ä¢ 25 languages',
        global_edition: 'monEZ Global Edition',
        you: 'You',
        add_first_expense: 'Tap + to add your first expense',
        unknown_location: 'Unknown location',
        no_matches: 'No expenses match filters',
        showing_filtered: 'Showing {count} filtered expense(s)',
        filters_cleared: 'Filters cleared',
        no_outstanding: 'No outstanding balances',
        last_activity: 'Last activity: {time}',
        add_friends_first: 'Add Friends First',
        tap_to_add_friends: 'Tap to add people to split with',
        create_first_group: 'Create Your First Group',
        tap_to_create_group: 'Tap to create a group',
        members: '{count} members',
        premium_features: 'Advanced Features',
        unlock_potential: 'Unlock the full potential of monEZ',
        free_trial: 'Start Free Trial',
        ai_receipt: 'AI Receipt Scanning',
        ai_receipt_desc: 'Scan receipts with 98.5% accuracy',
        try: 'TRY',
        ai_voice: 'Voice Commands',
        ai_voice_desc: 'Add expenses in 22 languages',
        ai_analytics: 'Advanced Analytics',
        ai_analytics_desc: 'AI-powered spending insights',
        multi_currency: 'Multi-Currency Support',
        multi_currency_desc: '150+ currencies with real-time rates',
        free: 'FREE',
        welcome_modal_title: "Welcome to monEZ!",
        welcome_modal_desc: "The best free expense splitting app with UPI payments, 55 currencies, and 25 languages.",
        start_fresh_q: "Would you like to start with a <strong>fresh empty account</strong> or explore with <strong>sample data</strong>?",
        start_fresh: "Start Fresh",
        explore_demo: "Explore with Demo",
        started_fresh_msg: "üÜï Started with a fresh account! Tap + to add your first expense.",
        demo_msg: "üìä Explore the demo data - add your own expenses anytime!",
        signed_out: "üëã Signed out",
        syncing: "üîÑ Syncing...",
        synced_msg: "‚úÖ All data synced!",
        synced_just_now: "‚úÖ Synced just now",
        signed_in_success: "‚úÖ Signed in! Syncing your data...",
        phone_verified: "‚úÖ Phone verified! Syncing...",
        otp_sent: "üì± OTP sent to your phone!",
        saved: "‚úÖ Saved!",
        apply_filters: "Apply Filters",
        clear: "Clear",
        group_name_placeholder: "Group name (e.g., Trip to Goa)",
        group_icon_placeholder: "Emoji icon (e.g., ‚úàÔ∏è)",
        group_created: "‚úÖ Group \"{name}\" created!",
        share_invite: "Share Invite",
        join_monEZ: "Join me on monEZ",
        copied: "‚úÖ Copied!",
        copy: "üìã Copy",
        friend_added: "‚úÖ {name} added as friend!",
        friend_exists: "‚ö†Ô∏è Friend already exists",
        enter_name: "‚ùå Please enter a name",
        enter_amount: "Please enter a valid amount",
        enter_desc: "Please enter a description",
        select_friend: "Please select at least one friend",
        delete_confirm: "Delete this expense?",
        expense_deleted: "üóëÔ∏è Expense deleted",
        settle_confirm: "Settle all {count} balance(s) totaling {amount}?",
        opening_payments: "üí≥ Opening payments for {count} balance(s)...",
        reminder_sent: "üîî Reminder sent to {name}",
        reminder_shared: "üì§ Reminder shared to {name}!",
        ai_suggestion: "ü§ñ AI suggested: {amount} based on your spending patterns",
        voice_input_example: "üé§ Voice input: \"Add 500 rupee dinner split equally with Raj and Priya\"",
        voice_input_success: "‚úÖ Voice input processed successfully!",
        premium_trial_started: "üöÄ Premium trial started! All features unlocked for 7 days.",
        premium_unlock_msg: "üéâ All premium features are now FREE! Enjoy charts, analytics & more!",
        payment_methods_msg: "üí≥ Payment methods: UPI, Cards, Bank Transfer coming soon!",
        dark_mode_on: "üåô Dark mode enabled",
        light_mode_on: "‚òÄÔ∏è Light mode enabled",
        export_success: "üìÅ Data exported as JSON successfully!",
        export_csv_success: "üìÑ Expenses exported as CSV successfully!",
        import_success: "üì• Data imported successfully!",
        import_fail: "‚ùå Import failed: {error}",
        invalid_file: "‚ùå Invalid JSON file",
        enter_email_pass: "‚ùå Please enter email and password",
        enter_phone: "‚ùå Please enter phone number",
        offline_mode: "üì¥ Running in offline mode. Data stays on this device only.",
        language_changed: "Language changed to",
        currency_changed: "Currency changed to",
        payment_methods: "Payment Methods",
        payment_methods_desc: "UPI, Cards, Bank accounts",
        app_section: "App",
        notifications_desc: "Push notifications, reminders",
        dark_mode_desc: "Switch to dark theme",
        export_data_desc: "Download all your data",
        export_csv: "Export as CSV",
        export_csv_desc: "Spreadsheet-friendly format",
        import_data_desc: "Restore from backup",
        profile: "Profile",
        profile_desc: "Manage your account details",
        account_section: "Account",
        free_tier: "FREE TIER",
        unlock_premium: "Unlock Premium Features",
        unlock_premium_desc: "Get AI-powered insights, unlimited groups, and advanced analytics",
        send_otp: "Send OTP",
        back_to_email: "‚Üê Back to email login",
        enter_otp: "Enter 6-digit OTP",
        sign_in: "Sign In",
        or_continue_with: "or continue with",
        continue_offline: "Continue without account (offline only)",
        create_group: "Create Group",
        group_name_placeholder: "Group name (e.g., Trip to Goa)",
        group_icon_placeholder: "Emoji icon (e.g., ‚úàÔ∏è üè† üéì)",
        add_members_later: "You can add members after creating the group.",
        cat_food: "Food",
        cat_transport: "Transport",
        cat_entertainment: "Entertainment",
        cat_shopping: "Shopping",
        cat_bills: "Bills",
        cat_travel: "Travel",
        pay_via: "Pay via:",
        mark_as_paid: "‚úÖ Mark as Paid",
        close: "Close",
        saving: "‚è≥ Saving...",
        payment_to: "Payment to",
        filter_expenses: "Filter Expenses",
        all_categories: "All Categories",
        category: "Category",
        premium: "Features",
        upi_payment_title: "üí≥ UPI Payment",
        enter_upi_id: "Enter {name}'s UPI ID to pay <strong>{amount}</strong>",
        save_for_future: "Save for future payments",
        cancel: "Cancel",
        pay_now_btn: "Pay Now üí≥",
        enter_valid_upi: "‚ùå Please enter a valid UPI ID (e.g. name@upi)",
        pro_tip_voice: "üí° Pro tip: Use voice input for faster entry!",
        select_balance_settle: "üí≥ Select a balance to settle up",
        confirm_delete_expense: "Delete this expense?",
        confirm_settle_all: "Settle all {count} balance(s) totaling {amount}?",
        email_placeholder: "Email address",
        password_placeholder: "Password",
        phone_placeholder: "+91 Phone number",
        otp_placeholder: "Enter 6-digit OTP",
        friend_name_placeholder: "Friend's name",
        upi_placeholder: "example@upi or phone@paytm"
      },
      pt: {
        app_name: 'monEZ',
        tagline: 'Divida despesas, n√£o amizades',
        home: 'In√≠cio',
        expenses: 'Despesas',
        balances: 'Saldos',
        groups: 'Grupos',
        settings: 'Configura√ß√µes',
        premium: 'Premium',
        add_expense: 'Adicionar Despesa',
        split_bill: 'Dividir Conta',
        settle_up: 'Quitar',
        ai_insights: 'Insights de IA',
        you_owe: 'Voc√™ deve',
        you_are_owed: "Te devem",
        your_balance: 'Seu saldo',
        recent_activity: 'Atividade Recente',
        view_all: 'Ver tudo',
        your_groups: 'Seus Grupos',
        amount: 'Valor',
        description: 'Descri√ß√£o',
        category: 'Categoria',
        split_with: 'Dividir com',
        save_expense: 'Salvar Despesa',
        cancel: 'Cancelar',
        equal_split: 'Divis√£o Igual',
        by_percentage: 'Por Porcentagem',
        custom_split: 'Divis√£o Personalizada',
        search_expenses: 'Buscar despesas...',
        no_expenses: 'Nenhuma despesa ainda',
        all_settled: 'Tudo quitado!',
        export_data: 'Exportar Dados',
        import_data: 'Importar Dados',
        language: 'Idioma',
        currency: 'Moeda',
        notifications: 'Notifica√ß√µes',
        dark_mode: 'Modo Escuro',
        profile: 'Perfil',
        payment_methods: 'M√©todos de Pagamento',
        owes_you: 'te deve',
        remind: 'Lembrar',
        pay_now: 'Pagar Agora',
        settle_all: 'Quitar Tudo',
        create_group: 'Criar Grupo',
        food: 'Comida',
        transport: 'Transporte',
        entertainment: 'Lazer',
        shopping: 'Compras',
        bills: 'Contas',
        travel: 'Viagem',
        welcome: 'Bem-vindo ao monEZ!',
        expense_added: 'Despesa adicionada com sucesso!',
        loading: 'Carregando...',
        total_spent: 'Total Gasto',
        this_month: 'Este M√™s',
        filter_expenses: 'Filtrar Despesas',
        add_new_expense: 'Nova Despesa',
        what_for: 'Para que foi isso?',
        install_app: 'Instalar monEZ',
        install_desc: 'Tenha a experi√™ncia completa do app na sua tela inicial',
        maybe_later: 'Talvez depois',
        install: 'Instalar',
        signin_to_sync: 'Entrar para Sincronizar',
        access_data: 'Acesse seus dados de qualquer dispositivo',
        synced: 'Sincronizado',
        sync_now: 'Sincronizar Agora',
        sign_out: 'Sair',
        localization: 'Localiza√ß√£o',
        data_management: 'Gerenciamento de Dados',
        export_json: 'Exportar como JSON',
        export_csv: 'Exportar como CSV',
        about: 'Sobre',
        version_info: 'v2.0 ‚Ä¢ 55 moedas ‚Ä¢ 25 idiomas',
        global_edition: 'monEZ Edi√ß√£o Global',
        you: 'Voc√™',
        add_first_expense: 'Toque em + para adicionar sua primeira despesa',
        unknown_location: 'Localiza√ß√£o desconhecida',
        no_matches: 'Nenhuma despesa corresponde aos filtros',
        showing_filtered: 'Mostrando {count} despesa(s) filtrada(s)',
        filters_cleared: 'Filtros limpos',
        no_outstanding: 'Nenhum saldo pendente',
        last_activity: '√öltima atividade: {time}',
        add_friends_first: 'Adicione Amigos Primeiro',
        tap_to_add_friends: 'Toque para adicionar pessoas para dividir',
        create_first_group: 'Crie Seu Primeiro Grupo',
        tap_to_create_group: 'Toque para criar um grupo',
        members: '{count} membros',
        premium_features: 'Recursos Avan√ßados',
        unlock_potential: 'Desbloqueie todo o potencial do monEZ',
        free_trial: 'Iniciar Teste Gratuito',
        ai_receipt: 'Escaneamento de Recibos com IA',
        ai_receipt_desc: 'Escaneie recibos com 98,5% de precis√£o',
        try: 'TESTAR',
        ai_voice: 'Comandos de Voz',
        ai_voice_desc: 'Adicione despesas em 22 idiomas',
        ai_analytics: 'An√°lises Avan√ßadas',
        ai_analytics_desc: 'Insights de gastos com IA',
        multi_currency: 'Suporte Multi-Moedas',
        multi_currency_desc: '150+ moedas com taxas em tempo real',
        free: 'GR√ÅTIS',
        welcome_modal_title: "Bem-vindo ao monEZ!",
        welcome_modal_desc: "O melhor app gratuito de divis√£o de despesas com pagamentos UPI, 55 moedas e 25 idiomas.",
        start_fresh_q: "Gostaria de come√ßar com uma <strong>conta nova vazia</strong> ou explorar com <strong>dados de demonstra√ß√£o</strong>?",
        start_fresh: "Bcome√ßar do Zero",
        explore_demo: "Explorar Demonstra√ß√£o",
        started_fresh_msg: "üÜï Come√ßou com uma conta nova! Toque em + para adicionar sua primeira despesa.",
        demo_msg: "üìä Explore os dados de demonstra√ß√£o - adicione suas pr√≥prias despesas a qualquer momento!",
        signed_out: "üëã Voc√™ saiu",
        syncing: "üîÑ Sincronizando...",
        synced_msg: "‚úÖ Todos os dados sincronizados!",
        synced_just_now: "‚úÖ Sincronizado agora mesmo",
        signed_in_success: "‚úÖ Login realizado! Sincronizando seus dados...",
        phone_verified: "‚úÖ Telefone verificado! Sincronizando...",
        otp_sent: "üì± OTP enviado para seu telefone!",
        saved: "‚úÖ Salvo!",
        apply_filters: "Aplicar Filtros",
        clear: "Limpar",
        group_name_placeholder: "Nome do grupo (ex: Viagem para Rio)",
        group_icon_placeholder: "√çcone emoji (ex: ‚úàÔ∏è üè† üéì)",
        add_members_later: "Voc√™ pode adicionar membros ap√≥s criar o grupo.",
        cat_food: "Comida",
        cat_transport: "Transporte",
        cat_entertainment: "Lazer",
        cat_shopping: "Compras",
        cat_bills: "Contas",
        cat_travel: "Viagem",
        pay_via: "Pagar via:",
        mark_as_paid: "‚úÖ Marcar como Pago",
        close: "Fechar",
        saving: "‚è≥ Salvando...",
        payment_to: "Pagamento para",
        filter_expenses: "Filtrar Despesas",
        all_categories: "Todas as Categorias",
        category: "Categoria",
        premium: "Funcionalidades",
        upi_payment_title: "üí≥ Pagamento PIX/UPI",
        enter_upi_id: "Digite a chave PIX/UPI de {name} para pagar <strong>{amount}</strong>",
        save_for_future: "Salvar para pagamentos futuros",
        cancel: "Cancelar",
        pay_now_btn: "Pagar Agora üí≥",
        enter_valid_upi: "‚ùå Por favor, insira uma chave PIX/UPI v√°lida",
        pro_tip_voice: "üí° Dica: Use entrada de voz para lan√ßar mais r√°pido!",
        select_balance_settle: "üí≥ Selecione um saldo para quitar",
        confirm_delete_expense: "Excluir esta despesa?",
        confirm_settle_all: "Quitar todos os {count} saldo(s) totalizando {amount}?",
        email_placeholder: "Endere√ßo de e-mail",
        password_placeholder: "Senha",
        phone_placeholder: "+55 N√∫mero de telefone",
        otp_placeholder: "Digite o c√≥digo de 6 d√≠gitos",
        friend_name_placeholder: "Nome do amigo",
        upi_placeholder: "exemplo@pix ou chave@banco"
      },
      es: {
        app_name: 'monEZ',
        tagline: 'Divide gastos, no amistades',
        home: 'Inicio',
        expenses: 'Gastos',
        balances: 'Saldos',
        groups: 'Grupos',
        settings: 'Ajustes',
        premium: 'Funciones',
        add_expense: 'A√±adir Gasto',
        split_bill: 'Dividir Cuenta',
        settle_up: 'Liquidar',
        ai_insights: 'Insights de IA',
        recent_activity: 'Actividad Reciente',
        view_all: 'Ver todo',
        your_groups: 'Tus Grupos',
        amount: 'Cantidad',
        description: 'Descripci√≥n',
        save_expense: 'Guardar Gasto',
        cancel: 'Cancelar',
        you_owe: 'Debes',
        you_are_owed: 'Te deben',
        your_balance: 'Tu saldo',
        no_expenses: 'Sin gastos a√∫n',
        add_first_expense: 'Toca + para a√±adir tu primer gasto',
        total_spent: 'Total gastado',
        this_month: 'Este mes',
        filter_expenses: 'Filtrar gastos',
        add_new_expense: 'Nuevo Gasto',
        what_for: '¬øPara qu√©?',
        install_app: 'Instalar monEZ',
        install_desc: 'Acceso r√°pido desde inicio',
        maybe_later: 'Quiz√°s luego',
        install: 'Instalar',
        signin_to_sync: 'Inicia sesi√≥n para sincronizar',
        access_data: 'Accede a tus datos desde cualquier lugar',
        synced: 'Sincronizado',
        sync_now: 'Sincronizar ahora',
        sign_out: 'Cerrar sesi√≥n',
        localization: 'Localizaci√≥n',
        data_management: 'Gesti√≥n de Datos',
        export_json: 'Exportar JSON',
        export_csv: 'Exportar CSV',
        import_data: 'Importar Datos',
        about: 'Acerca de',
        version_info: 'v2.0 ‚Ä¢ 55 monedas ‚Ä¢ 25 idiomas',
        global_edition: 'monEZ Edici√≥n Global',
        you: 'T√∫',
        unknown_location: 'Ubicaci√≥n desconocida',
        no_matches: 'No hay coincidencias',
        showing_filtered: 'Mostrando {count} gasto(s)',
        filters_cleared: 'Filtros borrados',
        all_settled: '¬°Todo saldado!',
        no_outstanding: 'Sin saldos pendientes',
        owes_you: 'te debe',
        pay_now: 'Pagar',
        remind: 'Recordar',
        last_activity: '√öltima actividad: {time}',
        add_friends_first: 'A√±ade amigos primero',
        tap_to_add_friends: 'Toca para a√±adir gente',
        create_first_group: 'Crea tu primer grupo',
        tap_to_create_group: 'Toca para crear grupo',
        members: '{count} miembros',
        premium_features: 'Funciones Avanzadas',
        unlock_potential: 'Desbloquea todo el potencial',
        free_trial: 'Prueba Gratis',
        ai_receipt: 'Escaneo de Recibos IA',
        ai_receipt_desc: 'Escanea con 98.5% precisi√≥n',
        ai_voice: 'Comandos de Voz',
        ai_voice_desc: 'A√±ade gastos en 22 idiomas',
        ai_analytics: 'Anal√≠tica Avanzada',
        ai_analytics_desc: 'Insights de IA',
        multi_currency: 'Multimoneda',
        multi_currency_desc: '150+ monedas en tiempo real',
        try: 'PROBAR',
        free: 'GRATIS',
        welcome_modal_title: "¬°Bienvenido a monEZ!",
        welcome_modal_desc: "La mejor app gratuita para dividir gastos con pagos UPI, 55 monedas y 25 idiomas.",
        start_fresh_q: "¬øTe gustar√≠a empezar con una <strong>cuenta vac√≠a</strong> o explorar con <strong>datos de ejemplo</strong>?",
        start_fresh: "Empezar de Cero",
        explore_demo: "Explorar Demo",
        started_fresh_msg: "üÜï ¬°Cuenta nueva creada! Toca + para a√±adir tu primer gasto.",
        demo_msg: "üìä Explora los datos de demo - ¬°a√±ade tus propios gastos cuando quieras!",
        signed_out: "üëã Sesi√≥n cerrada",
        syncing: "üîÑ Sincronizando...",
        synced_msg: "‚úÖ ¬°Todos los datos sincronizados!",
        signed_in_success: "‚úÖ ¬°Sesi√≥n iniciada! Sincronizando datos...",
        phone_verified: "‚úÖ ¬°Tel√©fono verificado! Sincronizando...",
        otp_sent: "üì± ¬°OTP enviado a tu tel√©fono!",
        expense_added: "¬°Gasto a√±adido con √©xito! üéâ",
        saved: "‚úÖ ¬°Guardado!",
        apply_filters: "Aplicar Filtros",
        clear: "Limpiar",
        group_created: "‚úÖ ¬°Grupo \"{name}\" creado!",
        share_invite: "Compartir Invitaci√≥n",
        copied: "‚úÖ ¬°Copiado!",
        copy: "üìã Copiar",
        friend_added: "‚úÖ ¬°{name} a√±adido como amigo!",
        friend_exists: "‚ö†Ô∏è El amigo ya existe",
        enter_name: "‚ùå Por favor ingresa un nombre",
        enter_amount: "Por favor ingresa una cantidad v√°lida",
        enter_desc: "Por favor ingresa una descripci√≥n",
        select_friend: "Por favor selecciona al menos un amigo",
        delete_confirm: "¬øEliminar este gasto?",
        expense_deleted: "üóëÔ∏è Gasto eliminado",
        premium_unlock_msg: "üéâ ¬°Todas las funciones premium ahora son GRATIS!",
        dark_mode_on: "üåô Modo oscuro activado",
        light_mode_on: "‚òÄÔ∏è Modo claro activado",
        export_success: "üìÅ ¬°Datos exportados como JSON!",
        import_success: "üì• ¬°Datos importados con √©xito!",
        offline_mode: "üì¥ Modo sin conexi√≥n. Los datos solo se guardan en este dispositivo.",
        language_changed: "Idioma cambiado a",
        currency_changed: "Moneda cambiada a"
      },
      hi: {
        app_name: 'monEZ',
        tagline: '‡§ñ‡§∞‡•ç‡§ö ‡§¨‡§æ‡§Ç‡§ü‡•á‡§Ç, ‡§¶‡•ã‡§∏‡•ç‡§§‡•Ä ‡§®‡§π‡•Ä‡§Ç',
        home: '‡§π‡•ã‡§Æ',
        expenses: '‡§ñ‡§∞‡•ç‡§ö',
        balances: '‡§¨‡•à‡§≤‡•á‡§Ç‡§∏',
        groups: '‡§∏‡§Æ‡•Ç‡§π',
        settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
        premium: '‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏',
        add_expense: '‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        split_bill: '‡§¨‡§ø‡§≤ ‡§¨‡§æ‡§Ç‡§ü‡•á',
        settle_up: '‡§π‡§ø‡§∏‡§æ‡§¨ ‡§ö‡•Å‡§ï‡§§‡§æ ‡§ï‡§∞‡•á‡§Ç',
        ai_insights: 'AI ‡§á‡§®‡§∏‡§æ‡§á‡§ü‡•ç‡§∏',
        recent_activity: '‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø',
        view_all: '‡§∏‡§≠‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç',
        your_groups: '‡§Ü‡§™‡§ï‡•á ‡§∏‡§Æ‡•Ç‡§π',
        amount: '‡§∞‡§æ‡§∂‡§ø',
        description: '‡§µ‡§ø‡§µ‡§∞‡§£',
        save_expense: '‡§ñ‡§∞‡•ç‡§ö ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç',
        cancel: '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
        you_owe: '‡§Ü‡§™ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç',
        you_are_owed: '‡§Ü‡§™‡§ï‡•ã ‡§Æ‡§ø‡§≤‡§®‡§æ ‡§π‡•à',
        your_balance: '‡§Ü‡§™‡§ï‡§æ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏',
        no_expenses: '‡§ï‡•ã‡§à ‡§ñ‡§∞‡•ç‡§ö ‡§®‡§π‡•Ä‡§Ç',
        add_first_expense: '+ ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§Ö‡§™‡§®‡§æ ‡§™‡§π‡§≤‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        total_spent: '‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö',
        this_month: '‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á',
        filter_expenses: '‡§ñ‡§∞‡•ç‡§ö ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç',
        add_new_expense: '‡§®‡§Ø‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        what_for: '‡§ï‡§ø‡§∏ ‡§≤‡§ø‡§è?',
        install_app: 'monEZ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç',
        install_desc: '‡§§‡•á‡§ú‡§º ‡§™‡§π‡•Å‡§Ç‡§ö ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•ã‡§Æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        maybe_later: '‡§∂‡§æ‡§Ø‡§¶ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç',
        install: '‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤',
        signin_to_sync: '‡§∏‡§ø‡§Ç‡§ï ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§á‡§® ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç',
        access_data: '‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§∏‡•á ‡§Ö‡§™‡§®‡§æ ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞‡•á‡§Ç',
        synced: '‡§∏‡§ø‡§Ç‡§ï ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
        sync_now: '‡§∏‡§ø‡§Ç‡§ï ‡§ï‡§∞‡•á‡§Ç',
        sign_out: '‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü',
        localization: '‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø‡§ï‡§∞‡§£',
        data_management: '‡§°‡•á‡§ü‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®',
        export_json: 'JSON ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç',
        export_csv: 'CSV ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç',
        import_data: '‡§°‡•á‡§ü‡§æ ‡§Ü‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç',
        about: '‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
        version_info: 'v2.0 ‚Ä¢ 55 ‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ‡§è‡§Ç ‚Ä¢ 25 ‡§≠‡§æ‡§∑‡§æ‡§è‡§Ç',
        global_edition: 'monEZ ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§è‡§°‡§ø‡§∂‡§®',
        you: '‡§Ü‡§™',
        unknown_location: '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡•ç‡§•‡§æ‡§®',
        no_matches: '‡§ï‡•ã‡§à ‡§ñ‡§∞‡•ç‡§ö ‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡§æ‡§§‡§æ',
        showing_filtered: '{count} ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§ñ‡§∞‡•ç‡§ö ‡§¶‡§ø‡§ñ‡§æ ‡§∞‡§π‡§æ ‡§π‡•à',
        filters_cleared: '‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§π‡§ü‡§æ ‡§¶‡§ø‡§è ‡§ó‡§è',
        all_settled: '‡§∏‡§¨ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§¨‡§∞‡§æ‡§¨‡§∞!',
        no_outstanding: '‡§ï‡•ã‡§à ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§®‡§π‡•Ä‡§Ç',
        owes_you: '‡§Ü‡§™‡§ï‡•ã ‡§¶‡•á‡§§‡§æ ‡§π‡•à',
        pay_now: '‡§Ö‡§≠‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç',
        remind: '‡§Ø‡§æ‡§¶ ‡§¶‡§ø‡§≤‡§æ‡§è‡§Ç',
        last_activity: '‡§™‡§ø‡§õ‡§≤‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø: {time}',
        add_friends_first: '‡§™‡§π‡§≤‡•á ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        tap_to_add_friends: '‡§¨‡§æ‡§Ç‡§ü‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        create_first_group: '‡§Ö‡§™‡§®‡§æ ‡§™‡§π‡§≤‡§æ ‡§∏‡§Æ‡•Ç‡§π ‡§¨‡§®‡§æ‡§è‡§Ç',
        tap_to_create_group: '‡§∏‡§Æ‡•Ç‡§π ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç',
        members: '{count} ‡§∏‡§¶‡§∏‡•ç‡§Ø',
        premium_features: '‡§è‡§°‡§µ‡§æ‡§Ç‡§∏‡•ç‡§° ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏',
        unlock_potential: 'monEZ ‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§Ö‡§®‡§≤‡•â‡§ï ‡§ï‡§∞‡•á‡§Ç',
        free_trial: '‡§Æ‡•Å‡§´‡•ç‡§§ ‡§ü‡•ç‡§∞‡§æ‡§Ø‡§≤ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
        ai_receipt: 'AI ‡§∞‡§∏‡•Ä‡§¶ ‡§∏‡•ç‡§ï‡•à‡§®‡§ø‡§Ç‡§ó',
        ai_receipt_desc: '98.5% ‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∞‡§∏‡•Ä‡§¶ ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç',
        ai_voice: '‡§µ‡•â‡§Ø‡§∏ ‡§ï‡§Æ‡§æ‡§Ç‡§°',
        ai_voice_desc: '22 ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
        ai_analytics: '‡§è‡§°‡§µ‡§æ‡§Ç‡§∏‡•ç‡§° ‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏',
        ai_analytics_desc: 'AI-‡§™‡§æ‡§µ‡§∞‡•ç‡§° ‡§ñ‡§∞‡•ç‡§ö ‡§á‡§®‡§∏‡§æ‡§á‡§ü‡•ç‡§∏',
        multi_currency: '‡§Æ‡§≤‡•ç‡§ü‡•Ä-‡§ï‡§∞‡•á‡§Ç‡§∏‡•Ä ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü',
        multi_currency_desc: '150+ ‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§•',
        try: 'TRY',
        free: '‡§Æ‡•Å‡§´‡•ç‡§§',
        welcome_modal_title: "‡§Æ‡§®‡•Ä‡§ú‡§º‡•Ä ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!",
        welcome_modal_desc: "UPI ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü, 55 ‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ‡§ì‡§Ç ‡§î‡§∞ 25 ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Æ‡•Å‡§´‡•ç‡§§ ‡§ñ‡§∞‡•ç‡§ö ‡§¨‡§æ‡§Ç‡§ü‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§ê‡§™‡•§",
        start_fresh_q: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ <strong>‡§®‡§è ‡§ñ‡§æ‡§≤‡•Ä ‡§ñ‡§æ‡§§‡•á</strong> ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á ‡§Ø‡§æ <strong>‡§∏‡•à‡§Ç‡§™‡§≤ ‡§°‡•á‡§ü‡§æ</strong> ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¶‡•á‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?",
        start_fresh: "‡§®‡§à ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§",
        explore_demo: "‡§°‡•á‡§Æ‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç",
        started_fresh_msg: "üÜï ‡§®‡§è ‡§ñ‡§æ‡§§‡•á ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§! ‡§Ö‡§™‡§®‡§æ ‡§™‡§π‡§≤‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§",
        demo_msg: "üìä ‡§°‡•á‡§Æ‡•ã ‡§°‡•á‡§ü‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç - ‡§Ö‡§™‡§®‡•á ‡§ñ‡§∞‡•ç‡§ö‡•á ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç!",
        signed_out: "üëã ‡§∏‡§æ‡§á‡§® ‡§Ü‡§â‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ",
        syncing: "üîÑ ‡§∏‡§ø‡§Ç‡§ï ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
        synced_msg: "‚úÖ ‡§∏‡§æ‡§∞‡§æ ‡§°‡•á‡§ü‡§æ ‡§∏‡§ø‡§Ç‡§ï ‡§π‡•ã ‡§ó‡§Ø‡§æ!",
        synced_just_now: "‚úÖ ‡§Ö‡§≠‡•Ä ‡§∏‡§ø‡§Ç‡§ï ‡§π‡•Å‡§Ü",
        signed_in_success: "‚úÖ ‡§∏‡§æ‡§á‡§® ‡§á‡§® ‡§∏‡§´‡§≤! ‡§°‡•á‡§ü‡§æ ‡§∏‡§ø‡§Ç‡§ï ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
        phone_verified: "‚úÖ ‡§´‡•ã‡§® ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§! ‡§∏‡§ø‡§Ç‡§ï ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
        otp_sent: "üì± OTP ‡§Ü‡§™‡§ï‡•á ‡§´‡•ã‡§® ‡§™‡§∞ ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!",
        expense_added: "‡§ñ‡§∞‡•ç‡§ö ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ! üéâ",
        saved: "‚úÖ ‡§∏‡•á‡§µ ‡§π‡•Å‡§Ü!",
        apply_filters: "‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç",
        clear: "‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç",
        group_name_placeholder: "‡§ó‡•ç‡§∞‡•Å‡§™ ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§ú‡•à‡§∏‡•á: ‡§ó‡•ã‡§µ‡§æ ‡§ü‡•ç‡§∞‡§ø‡§™)",
        group_icon_placeholder: "‡§á‡§Æ‡•ã‡§ú‡•Ä ‡§Ü‡§á‡§ï‡§® (‡§ú‡•à‡§∏‡•á: ‚úàÔ∏è)",
        group_created: "‚úÖ ‡§ó‡•ç‡§∞‡•Å‡§™ \"{name}\" ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        share_invite: "‡§Ü‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç",
        join_monEZ: "‡§Æ‡§®‡•Ä‡§ú‡§º‡•Ä ‡§™‡§∞ ‡§Æ‡•Å‡§ù‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á‡§Ç",
        copied: "‚úÖ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        copy: "üìã ‡§ï‡•â‡§™‡•Ä",
        friend_added: "‚úÖ {name} ‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á ‡§ó‡§è!",
        friend_exists: "‚ö†Ô∏è ‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à",
        enter_name: "‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        enter_amount: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        enter_desc: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        select_friend: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç",
        delete_confirm: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
        expense_deleted: "üóëÔ∏è ‡§ñ‡§∞‡•ç‡§ö ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ",
        settle_confirm: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ {amount} ‡§ï‡•á {count} ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ï‡§æ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
        opening_payments: "üí≥ {count} ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ñ‡•ã‡§≤ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
        reminder_sent: "üîî {name} ‡§ï‡•ã ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ",
        reminder_shared: "üì§ {name} ‡§ï‡•ã ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        ai_suggestion: "ü§ñ AI ‡§∏‡•Å‡§ù‡§æ‡§µ: ‡§Ü‡§™‡§ï‡•á ‡§ñ‡§∞‡•ç‡§ö ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ {amount}",
        voice_input_example: "üé§ ‡§µ‡•â‡§Ø‡§∏ ‡§á‡§®‡§™‡•Å‡§ü: \"‡§∞‡§æ‡§ú ‡§î‡§∞ ‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• 500 ‡§∞‡•Å‡§™‡§Ø‡•á ‡§ï‡§æ ‡§°‡§ø‡§®‡§∞ ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§¨‡§æ‡§Ç‡§ü‡•á‡§Ç\"",
        voice_input_success: "‚úÖ ‡§µ‡•â‡§Ø‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§π‡•Å‡§Ü!",
        premium_trial_started: "üöÄ ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§ü‡•ç‡§∞‡§æ‡§Ø‡§≤ ‡§∂‡•Å‡§∞‡•Ç! 7 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§Ö‡§®‡§≤‡•â‡§ï‡•§",
        premium_unlock_msg: "üéâ ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§Ö‡§¨ ‡§Æ‡•Å‡§´‡•ç‡§§ ‡§π‡•à‡§Ç! ‡§ö‡§æ‡§∞‡•ç‡§ü, ‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏ ‡§î‡§∞ ‡§¨‡§π‡•Å‡§§ ‡§ï‡•Å‡§õ ‡§ï‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡•á‡§Ç!",
        payment_methods_msg: "üí≥ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•á ‡§§‡§∞‡•Ä‡§ï‡•á: UPI, ‡§ï‡§æ‡§∞‡•ç‡§°, ‡§¨‡•à‡§Ç‡§ï ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§∏‡§´‡§∞ ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡•á ‡§π‡•à‡§Ç!",
        dark_mode_on: "üåô ‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§° ‡§ö‡§æ‡§≤‡•Ç",
        light_mode_on: "‚òÄÔ∏è ‡§≤‡§æ‡§á‡§ü ‡§Æ‡•ã‡§° ‡§ö‡§æ‡§≤‡•Ç",
        export_success: "üìÅ ‡§°‡•á‡§ü‡§æ JSON ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        export_csv_success: "üìÑ ‡§ñ‡§∞‡•ç‡§ö‡•á CSV ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§è ‡§ó‡§è!",
        import_success: "üì• ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ü‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        import_fail: "‚ùå ‡§Ü‡§Ø‡§æ‡§§ ‡§µ‡§ø‡§´‡§≤: {error}",
        invalid_file: "‚ùå ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø JSON ‡§´‡§º‡§æ‡§á‡§≤",
        enter_email_pass: "‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        enter_phone: "‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        offline_mode: "üì¥ ‡§ë‡§´‡§≤‡§æ‡§á‡§® ‡§Æ‡•ã‡§°‡•§ ‡§°‡•á‡§ü‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§á‡§∏ ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§™‡§∞ ‡§∞‡§π‡•á‡§ó‡§æ‡•§",
        language_changed: "‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡•Ä",
        currency_changed: "‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ ‡§¨‡§¶‡§≤‡•Ä"
      },
      zh: {
        app_name: 'monEZ',
        tagline: 'ÂàÜÊëäË¥πÁî®Ôºå‰∏çÂàÜÂèãË∞ä',
        home: 'È¶ñÈ°µ',
        expenses: 'ÊîØÂá∫',
        balances: '‰ΩôÈ¢ù',
        groups: 'Áæ§ÁªÑ',
        settings: 'ËÆæÁΩÆ',
        add_expense: 'Ê∑ªÂä†ÊîØÂá∫',
        you_owe: '‰Ω†Ê¨†',
        you_are_owed: 'Ê¨†‰Ω†',
        your_balance: '‰Ω†ÁöÑ‰ΩôÈ¢ù',
        amount: 'ÈáëÈ¢ù',
        description: 'ÊèèËø∞',
        save_expense: '‰øùÂ≠òÊîØÂá∫',
        cancel: 'ÂèñÊ∂à',
        welcome_modal_title: "Ê¨¢Ëøé‰ΩøÁî® monEZÔºÅ",
        welcome_modal_desc: "ÂÖçË¥πÁöÑË¥πÁî®ÂàÜÊëíÂ∫îÁî®ÔºåÊîØÊåÅ 55 ÁßçË¥ßÂ∏ÅÂíå 25 ÁßçËØ≠Ë®Ä„ÄÇ",
        start_fresh: "Êñ∞ÂºÄÂßã",
        explore_demo: "Êé¢Á¥¢ÊºîÁ§∫",
        started_fresh_msg: "üÜï Êñ∞Ë¥¶Êà∑Â∑≤ÂàõÂª∫ÔºÅÁÇπÂáª + Ê∑ªÂä†ÊÇ®ÁöÑÁ¨¨‰∏ÄÁ¨îÊîØÂá∫„ÄÇ",
        demo_msg: "üìä Êé¢Á¥¢ÊºîÁ§∫Êï∞ÊçÆ - ÈöèÊó∂Ê∑ªÂä†ÊÇ®Ëá™Â∑±ÁöÑÊîØÂá∫ÔºÅ",
        expense_added: "ÊîØÂá∫Ê∑ªÂä†ÊàêÂäüÔºÅüéâ",
        saved: "‚úÖ Â∑≤‰øùÂ≠òÔºÅ",
        premium_unlock_msg: "üéâ ÊâÄÊúâÈ´òÁ∫ßÂäüËÉΩÁé∞Âú®ÂÖçË¥πÔºÅ"
      },
      ar: {
        app_name: 'monEZ',
        tagline: 'ŸÇÿ≥ŸëŸÖ ÿßŸÑŸÜŸÅŸÇÿßÿ™ÿå ŸÑŸäÿ≥ ÿßŸÑÿµÿØÿßŸÇÿßÿ™',
        home: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
        expenses: 'ÿßŸÑŸÜŸÅŸÇÿßÿ™',
        balances: 'ÿßŸÑÿ£ÿ±ÿµÿØÿ©',
        groups: 'ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™',
        settings: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
        add_expense: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÅŸÇÿ©',
        you_owe: 'ÿ£ŸÜÿ™ ŸÖÿØŸäŸÜ',
        you_are_owed: 'ŸÖÿ≥ÿ™ÿ≠ŸÇ ŸÑŸÉ',
        your_balance: 'ÿ±ÿµŸäÿØŸÉ',
        amount: 'ÿßŸÑŸÖÿ®ŸÑÿ∫',
        description: 'ÿßŸÑŸàÿµŸÅ',
        save_expense: 'ÿ≠ŸÅÿ∏ ÿßŸÑŸÜŸÅŸÇÿ©',
        cancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
        welcome_modal_title: "ŸÖÿ±ÿ≠ÿ®Ÿãÿß ÿ®ŸÉ ŸÅŸä monEZ!",
        welcome_modal_desc: "ÿ£ŸÅÿ∂ŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖÿ¨ÿßŸÜŸä ŸÑÿ™ŸÇÿ≥ŸäŸÖ ÿßŸÑŸÜŸÅŸÇÿßÿ™ ŸÖÿπ 55 ÿπŸÖŸÑÿ© Ÿà 25 ŸÑÿ∫ÿ©.",
        start_fresh: "ÿßÿ®ÿØÿ£ ŸÖŸÜ ÿ¨ÿØŸäÿØ",
        explore_demo: "ÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿßŸÑÿπÿ±ÿ∂",
        started_fresh_msg: "üÜï ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ! ÿßÿ∂ÿ∫ÿ∑ + ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸàŸÑ ŸÜŸÅŸÇÿ©.",
        demo_msg: "üìä ÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ - ÿ£ÿ∂ŸÅ ŸÜŸÅŸÇÿßÿ™ŸÉ ŸÅŸä ÿ£Ÿä ŸàŸÇÿ™!",
        expense_added: "ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÅŸÇÿ© ÿ®ŸÜÿ¨ÿßÿ≠! üéâ",
        saved: "‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏!",
        premium_unlock_msg: "üéâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ŸÖÿ¨ÿßŸÜŸäÿ© ÿßŸÑÿ¢ŸÜ!"
      },
      ja: {
        app_name: 'monEZ',
        tagline: 'Ë≤ªÁî®„ÇíÂàÜÂâ≤„ÄÅÂèãÊÉÖ„ÅØ„Åù„ÅÆ„Åæ„Åæ',
        home: '„Éõ„Éº„É†',
        expenses: 'ÊîØÂá∫',
        balances: 'ÊÆãÈ´ò',
        groups: '„Ç∞„É´„Éº„Éó',
        settings: 'Ë®≠ÂÆö',
        add_expense: 'ÊîØÂá∫„ÇíËøΩÂä†',
        you_owe: '„ÅÇ„Å™„Åü„ÅåÊâï„ÅÜ',
        you_are_owed: '„ÇÇ„Çâ„Åà„ÇãÈáëÈ°ç',
        amount: 'ÈáëÈ°ç',
        description: 'Ë™¨Êòé',
        save_expense: 'ÊîØÂá∫„Çí‰øùÂ≠ò',
        cancel: '„Ç≠„É£„É≥„Çª„É´',
        welcome_modal_title: "monEZ„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ",
        welcome_modal_desc: "55„ÅÆÈÄöË≤®„Å®25„ÅÆË®ÄË™û„Çí„Çµ„Éù„Éº„Éà„Åô„ÇãÁÑ°Êñô„ÅÆË≤ªÁî®ÂàÜÂâ≤„Ç¢„Éó„É™„ÄÇ",
        start_fresh: "Êñ∞Ë¶è‰ΩúÊàê",
        explore_demo: "„Éá„É¢„ÇíÊé¢Á¥¢",
        started_fresh_msg: "üÜï Êñ∞„Åó„ÅÑ„Ç¢„Ç´„Ç¶„É≥„Éà„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºÅ+ „Çí„Çø„ÉÉ„Éó„Åó„Å¶ÊúÄÂàù„ÅÆÊîØÂá∫„ÇíËøΩÂä†„ÄÇ",
        demo_msg: "üìä „Éá„É¢„Éá„Éº„Çø„ÇíÊé¢Á¥¢ - „ÅÑ„Å§„Åß„ÇÇËá™ÂàÜ„ÅÆÊîØÂá∫„ÇíËøΩÂä†ÔºÅ",
        expense_added: "ÊîØÂá∫„ÅåËøΩÂä†„Åï„Çå„Åæ„Åó„ÅüÔºÅüéâ",
        saved: "‚úÖ ‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ",
        premium_unlock_msg: "üéâ „Åô„Åπ„Å¶„ÅÆ„Éó„É¨„Éü„Ç¢„É†Ê©üËÉΩ„ÅåÁÑ°Êñô„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ"
      },
      fr: {
        app_name: 'monEZ',
        tagline: 'Partagez les d√©penses, pas les amiti√©s',
        home: 'Accueil',
        expenses: 'D√©penses',
        balances: 'Soldes',
        groups: 'Groupes',
        settings: 'Param√®tres',
        add_expense: 'Ajouter une d√©pense',
        you_owe: 'Vous devez',
        you_are_owed: 'On vous doit',
        amount: 'Montant',
        description: 'Description',
        save_expense: 'Enregistrer',
        cancel: 'Annuler',
        welcome_modal_title: "Bienvenue sur monEZ !",
        welcome_modal_desc: "La meilleure app gratuite de partage de d√©penses avec 55 devises et 25 langues.",
        start_fresh: "Nouveau d√©part",
        explore_demo: "Explorer la d√©mo",
        started_fresh_msg: "üÜï Nouveau compte cr√©√© ! Appuyez sur + pour ajouter votre premi√®re d√©pense.",
        demo_msg: "üìä Explorez les donn√©es de d√©mo - ajoutez vos propres d√©penses quand vous voulez !",
        expense_added: "D√©pense ajout√©e avec succ√®s ! üéâ",
        saved: "‚úÖ Enregistr√© !",
        premium_unlock_msg: "üéâ Toutes les fonctions premium sont maintenant GRATUITES !"
      },
      de: {
        app_name: 'monEZ',
        tagline: 'Teile Ausgaben, nicht Freundschaften',
        home: 'Startseite',
        expenses: 'Ausgaben',
        balances: 'Salden',
        groups: 'Gruppen',
        settings: 'Einstellungen',
        add_expense: 'Ausgabe hinzuf√ºgen',
        you_owe: 'Du schuldest',
        you_are_owed: 'Dir wird geschuldet',
        amount: 'Betrag',
        description: 'Beschreibung',
        save_expense: 'Speichern',
        cancel: 'Abbrechen',
        welcome_modal_title: "Willkommen bei monEZ!",
        welcome_modal_desc: "Die beste kostenlose App zum Teilen von Ausgaben mit 55 W√§hrungen und 25 Sprachen.",
        start_fresh: "Neu beginnen",
        explore_demo: "Demo erkunden",
        started_fresh_msg: "üÜï Neues Konto erstellt! Tippen Sie auf +, um Ihre erste Ausgabe hinzuzuf√ºgen.",
        demo_msg: "üìä Erkunden Sie die Demo-Daten - f√ºgen Sie jederzeit Ihre eigenen Ausgaben hinzu!",
        expense_added: "Ausgabe erfolgreich hinzugef√ºgt! üéâ",
        saved: "‚úÖ Gespeichert!",
        premium_unlock_msg: "üéâ Alle Premium-Funktionen sind jetzt KOSTENLOS!"
      },
      pt: {
        app_name: 'monEZ',
        tagline: 'Divida despesas, n√£o amizades',
        home: 'In√≠cio',
        expenses: 'Despesas',
        balances: 'Saldos',
        groups: 'Grupos',
        settings: 'Configura√ß√µes',
        premium: 'Funcionalidades',
        add_expense: 'Adicionar Despesa',
        split_bill: 'Dividir Conta',
        settle_up: 'Acertar',
        ai_insights: 'IA Insights',
        recent_activity: 'Atividade Recente',
        view_all: 'Ver tudo',
        your_groups: 'Seus Grupos',
        you_owe: 'Voc√™ deve',
        you_are_owed: 'Devem a voc√™',
        your_balance: 'Seu saldo',
        amount: 'Valor',
        description: 'Descri√ß√£o',
        save_expense: 'Salvar',
        cancel: 'Cancelar',
        no_expenses: 'Nenhuma despesa ainda',
        add_first_expense: 'Toque em + para adicionar sua primeira despesa',
        total_spent: 'Total Gasto',
        this_month: 'Este M√™s',
        filter_expenses: 'Filtrar despesas',
        add_new_expense: 'Nova Despesa',
        what_for: 'Para qu√™?',
        install_app: 'Instalar monEZ',
        install_desc: 'Acesse rapidamente da tela inicial',
        maybe_later: 'Talvez depois',
        install: 'Instalar',
        signin_to_sync: 'Entre para sincronizar',
        access_data: 'Acesse seus dados de qualquer lugar',
        synced: 'Sincronizado',
        sync_now: 'Sincronizar',
        sign_out: 'Sair',
        localization: 'Localiza√ß√£o',
        data_management: 'Gerenciamento de Dados',
        export_json: 'Exportar JSON',
        export_csv: 'Exportar CSV',
        import_data: 'Importar Dados',
        about: 'Sobre',
        version_info: 'v2.0 ‚Ä¢ 55 moedas ‚Ä¢ 25 idiomas',
        global_edition: 'monEZ Edi√ß√£o Global',
        you: 'Voc√™',
        unknown_location: 'Local desconhecido',
        no_matches: 'Sem correspond√™ncias',
        showing_filtered: 'Mostrando {count} despesa(s)',
        filters_cleared: 'Filtros limpos',
        all_settled: 'Tudo acertado!',
        no_outstanding: 'Sem saldos pendentes',
        owes_you: 'te deve',
        pay_now: 'Pagar',
        remind: 'Lembrar',
        last_activity: '√öltima atividade: {time}',
        add_friends_first: 'Adicione amigos primeiro',
        tap_to_add_friends: 'Toque para adicionar pessoas',
        create_first_group: 'Crie seu primeiro grupo',
        tap_to_create_group: 'Toque para criar grupo',
        members: '{count} membros',
        premium_features: 'Recursos Premium',
        unlock_potential: 'Desbloqueie todo o potencial',
        free_trial: 'Teste Gr√°tis',
        ai_receipt: 'Digitaliza√ß√£o de Recibos IA',
        ai_receipt_desc: 'Digitalize com 98.5% de precis√£o',
        ai_voice: 'Comandos de Voz',
        ai_voice_desc: 'Adicione despesas em 22 idiomas',
        ai_analytics: 'Analytics Avan√ßado',
        ai_analytics_desc: 'Insights de IA',
        multi_currency: 'M√∫ltiplas Moedas',
        multi_currency_desc: '150+ moedas em tempo real',
        try: 'TESTAR',
        free: 'GR√ÅTIS',
        settle_all: 'Acertar Tudo',
        category: 'Categoria',
        split_with: 'Dividir com',
        equal_split: 'Igual',
        by_percentage: 'Por Porcentagem',
        custom_split: 'Personalizado',
        language: 'Idioma',
        currency: 'Moeda',
        notifications: 'Notifica√ß√µes',
        dark_mode: 'Modo Escuro',
        export_data: 'Exportar Dados',
        welcome_modal_title: "Bem-vindo ao monEZ!",
        welcome_modal_desc: "O melhor app gratuito de divis√£o de despesas com 55 moedas e 25 idiomas.",
        start_fresh: "Come√ßar do Zero",
        explore_demo: "Explorar Demo",
        started_fresh_msg: "üÜï Nova conta criada! Toque em + para adicionar sua primeira despesa.",
        demo_msg: "üìä Explore os dados de demo - adicione suas pr√≥prias despesas a qualquer momento!",
        expense_added: "Despesa adicionada com sucesso! üéâ",
        saved: "‚úÖ Salvo!",
        premium_unlock_msg: "üéâ Todas as fun√ß√µes premium agora s√£o GR√ÅTIS!",
        enter_amount: "Por favor insira um valor v√°lido",
        enter_desc: "Por favor insira uma descri√ß√£o",
        select_friend: "Por favor selecione pelo menos um amigo",
        language_changed: "Idioma alterado para",
        currency_changed: "Moeda alterada para",
        payment_methods: "M√©todos de Pagamento",
        payment_methods_desc: "UPI, Cart√µes, Contas banc√°rias",
        app_section: "Aplicativo",
        notifications_desc: "Notifica√ß√µes push, lembretes",
        dark_mode_desc: "Mudar para tema escuro",
        export_data_desc: "Baixe todos os seus dados",
        export_csv: "Exportar como CSV",
        export_csv_desc: "Formato para planilhas",
        import_data_desc: "Restaurar de backup",
        profile: "Perfil",
        profile_desc: "Gerencie os detalhes da sua conta",
        account_section: "Conta",
        free_tier: "GR√ÅTIS",
        unlock_premium: "Desbloquear Premium",
        unlock_premium_desc: "Obtenha insights de IA, grupos ilimitados e analytics avan√ßado",
        send_otp: "Enviar OTP",
        back_to_email: "‚Üê Voltar ao login por email",
        enter_otp: "Digite o OTP de 6 d√≠gitos",
        sign_in: "Entrar",
        or_continue_with: "ou continue com",
        continue_offline: "Continuar sem conta (apenas offline)",
        create_group: "Criar Grupo",
        group_name_placeholder: "Nome do grupo (ex: Viagem a Goa)",
        group_icon_placeholder: "Emoji √≠cone (ex: ‚úàÔ∏è üè† üéì)",
        add_members_later: "Voc√™ pode adicionar membros depois de criar o grupo.",
        cat_food: "Comida",
        cat_transport: "Transporte",
        cat_entertainment: "Lazer",
        cat_shopping: "Compras",
        cat_bills: "Contas",
        filter_expenses: "Filtrar Despesas",
        all_categories: "Todas as Categorias",
        category: "Categoria",
        cat_travel: "Viagem",
        pay_via: "Pagar via:",
        mark_as_paid: "‚úÖ Marcar como Pago",
        close: "Fechar",
        saving: "‚è≥ Salvando...",
        search_expenses: "Buscar despesas...",
        payment_to: "Pagamento para",
        upi_payment_title: "üí≥ Pagamento UPI",
        enter_upi_id: "Digite o ID UPI de {name} para pagar <strong>{amount}</strong>",
        save_for_future: "Salvar para pagamentos futuros",
        cancel: "Cancelar",
        pay_now_btn: "Pagar Agora üí≥",
        enter_valid_upi: "‚ùå Digite um ID UPI v√°lido (ex: nome@upi)",
        pro_tip_voice: "üí° Dica: Use entrada de voz para agilizar!",
        confirm_delete_expense: "Excluir esta despesa?",
        confirm_settle_all: "Quitar todos os {count} saldo(s) totalizando {amount}?",
        email_placeholder: "Endere√ßo de email",
        password_placeholder: "Senha",
        phone_placeholder: "+55 N√∫mero de telefone",
        otp_placeholder: "Digite o OTP de 6 d√≠gitos",
        friend_name_placeholder: "Nome do amigo",
        upi_placeholder: "exemplo@upi ou telefone@pix",
        select_balance_settle: "üí≥ Selecione um saldo para acertar"
      },
      ko: {
        app_name: 'monEZ',
        tagline: 'ÎπÑÏö©ÏùÄ ÎÇòÎàÑÍ≥†, Ïö∞Ï†ïÏùÄ ÏßÄÌÇ§ÏÑ∏Ïöî',
        home: 'Ìôà',
        expenses: 'ÏßÄÏ∂ú',
        balances: 'ÏûîÏï°',
        groups: 'Í∑∏Î£π',
        settings: 'ÏÑ§Ï†ï',
        add_expense: 'ÏßÄÏ∂ú Ï∂îÍ∞Ä',
        you_owe: 'ÎÇ¥Í∞Ä Í∞öÏùÑ Í∏àÏï°',
        you_are_owed: 'Î∞õÏùÑ Í∏àÏï°',
        amount: 'Í∏àÏï°',
        description: 'ÏÑ§Î™Ö',
        save_expense: 'Ï†ÄÏû•',
        cancel: 'Ï∑®ÏÜå',
        welcome_modal_title: "monEZÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!",
        welcome_modal_desc: "55Í∞ú ÌÜµÌôîÏôÄ 25Í∞ú Ïñ∏Ïñ¥Î•º ÏßÄÏõêÌïòÎäî ÏµúÍ≥†Ïùò Î¨¥Î£å ÎπÑÏö© Î∂ÑÌï† Ïï±.",
        start_fresh: "ÏÉàÎ°ú ÏãúÏûë",
        explore_demo: "Îç∞Î™® ÌÉêÏÉâ",
        started_fresh_msg: "üÜï ÏÉà Í≥ÑÏ†ïÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! + Î•º ÌÉ≠ÌïòÏó¨ Ï≤´ ÏßÄÏ∂úÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî.",
        demo_msg: "üìä Îç∞Î™® Îç∞Ïù¥ÌÑ∞ ÌÉêÏÉâ - Ïñ∏Ï†úÎì†ÏßÄ ÎÇòÏùò ÏßÄÏ∂úÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî!",
        expense_added: "ÏßÄÏ∂úÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üéâ",
        saved: "‚úÖ Ï†ÄÏû•Îê®!",
        premium_unlock_msg: "üéâ Î™®Îì† ÌîÑÎ¶¨ÎØ∏ÏóÑ Í∏∞Îä•Ïù¥ Ïù¥Ï†ú Î¨¥Î£åÏûÖÎãàÎã§!"
      },
      ru: {
        app_name: 'monEZ',
        tagline: '–î–µ–ª–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã, –∞ –Ω–µ –¥—Ä—É–∂–±—É',
        home: '–ì–ª–∞–≤–Ω–∞—è',
        expenses: '–†–∞—Å—Ö–æ–¥—ã',
        balances: '–ë–∞–ª–∞–Ω—Å—ã',
        groups: '–ì—Ä—É–ø–ø—ã',
        settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
        add_expense: '–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥',
        you_owe: '–í—ã –¥–æ–ª–∂–Ω—ã',
        you_are_owed: '–í–∞–º –¥–æ–ª–∂–Ω—ã',
        amount: '–°—É–º–º–∞',
        description: '–û–ø–∏—Å–∞–Ω–∏–µ',
        save_expense: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        cancel: '–û—Ç–º–µ–Ω–∞',
      },
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // INTERNATIONALIZATION (i18n) ENGINE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    class I18n {
      constructor() {
        this.currentLang = 'en';
        this.currentCurrency = 'USD'; // Default to USD for global
        this.loadSettings();
      }

      loadSettings() {
        const settings = storage.load('settings', {});
        this.currentLang = settings.language || this.detectLanguage();
        this.currentCurrency = settings.currency || this.detectCurrency();
      }

      detectLanguage() {
        const browserLang = navigator.language.split('-')[0];
        return LANGUAGES[browserLang] ? browserLang : 'en';
      }

      detectCurrency() {
        // Detect based on timezone or locale
        const locale = navigator.language;
        const currencyMap = {
          'en-US': 'USD', 'en-GB': 'GBP', 'en-AU': 'AUD', 'en-CA': 'CAD',
          'en-IN': 'INR', 'hi-IN': 'INR', 'de-DE': 'EUR', 'fr-FR': 'EUR',
          'es-ES': 'EUR', 'it-IT': 'EUR', 'ja-JP': 'JPY', 'ko-KR': 'KRW',
          'zh-CN': 'CNY', 'ar-AE': 'AED', 'ar-SA': 'SAR', 'pt-BR': 'BRL',
        };
        return currencyMap[locale] || 'USD';
      }

      setLanguage(langCode) {
        if (LANGUAGES[langCode]) {
          this.currentLang = langCode;
          document.documentElement.dir = LANGUAGES[langCode].dir;
          document.documentElement.lang = langCode;
          this.saveSettings();
          this.updateUI();
          return true;
        }
        return false;
      }

      setCurrency(currencyCode) {
        if (CURRENCIES[currencyCode]) {
          this.currentCurrency = currencyCode;
          this.saveSettings();
          return true;
        }
        return false;
      }

      saveSettings() {
        const settings = storage.load('settings', {});
        settings.language = this.currentLang;
        settings.currency = this.currentCurrency;
        storage.save('settings', settings);
      }

      t(key, params = {}) {
        const translations = TRANSLATIONS[this.currentLang] || TRANSLATIONS.en;
        let text = translations[key] || TRANSLATIONS.en[key] || key;

        // Replace parameters like {name} with actual values
        Object.keys(params).forEach(param => {
          text = text.replace(new RegExp(`{${param}}`, 'g'), params[param]);
        });

        return text;
      }

      formatCurrency(amount) {
        const currency = CURRENCIES[this.currentCurrency];
        if (!currency) return `${amount}`;

        try {
          // Robust formatting using Intl.NumberFormat
          const number = parseFloat(amount);
          if (isNaN(number)) return `${currency.symbol}0.00`;

          if (this.currentCurrency === 'INR') {
            return '‚Çπ' + number.toLocaleString('en-IN', { minimumFractionDigits: currency.decimals, maximumFractionDigits: currency.decimals });
          } else if (this.currentCurrency === 'USD') {
            return '$' + number.toLocaleString('en-US', { minimumFractionDigits: currency.decimals, maximumFractionDigits: currency.decimals });
          } else {
            return new Intl.NumberFormat(currency.locale, {
              style: 'currency',
              currency: this.currentCurrency,
              minimumFractionDigits: currency.decimals,
              maximumFractionDigits: currency.decimals,
            }).format(number);
          }
        } catch (e) {
          console.error("Error formatting currency:", e);
          return `${currency.symbol}${parseFloat(amount).toLocaleString()}`;
        }
      }

      formatDate(date) {
        const lang = LANGUAGES[this.currentLang];
        try {
          return new Intl.DateTimeFormat(this.currentLang, {
            dateStyle: 'medium',
            timeStyle: 'short'
          }).format(new Date(date));
        } catch (e) {
          return date;
        }
      }

      updateUI() {
        // Update all elements with data-i18n attribute
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          el.textContent = this.t(key);
        });

        // Update all elements with data-i18n-placeholder
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
          const key = el.getAttribute('data-i18n-placeholder');
          el.placeholder = this.t(key);
        });
      }

      isRTL() {
        return LANGUAGES[this.currentLang]?.dir === 'rtl';
      }
    }

    // Global i18n instance
    const i18n = new I18n();

    // Shorthand translation function
    const t = (key, params) => i18n.t(key, params);


    // Application Constants
    const DELAYS = {
      PWA_PROMPT: 3000,
      PWA_PROMPT_LATER: 5000,
      NOTIFICATION: 5000,
      ANIMATION: 300,
      BUTTON_RESET: 2000,
      FOCUS_DELAY: 100,
      AUTO_CLOSE: 10000,
      RELOAD: 1000,
      RELOAD_PREMIUM: 1500
    };

    const SIZES = {
      MODAL_MAX_WIDTH: 400,
      PADDING_LG: 24,
      PADDING_MD: 16,
      PADDING_SM: 8
    };

    const AppState = {
      expenses: [],
      friends: [],
      groups: [],
      selectedFriends: new Set(), // CRITICAL: Initialize to prevent TypeError
      selectedCategory: null,
      currentView: 'home',
      currentExpenseType: 'personal',
      isAuthenticated: false,
      user: null,
      animations: true,
      theme: 'light',
      pwaPromptShown: false,
      deferredPrompt: null,
      syncStatus: 'offline', // 'offline', 'syncing', 'synced', 'error'
    };

    // Demo data for first-time users
    const demoFriends = [
      { name: 'Raj Kumar', avatar: 'R', color: '#10B981' },
      { name: 'Priya Singh', avatar: 'P', color: '#F59E0B' },
      { name: 'Amit Sharma', avatar: 'A', color: '#8B5CF6' },
      { name: 'Sarah Johnson', avatar: 'S', color: '#EF4444' },
      { name: 'Mike Chen', avatar: 'M', color: '#06B6D4' }
    ];

    // Global function for expense type toggling
    function setExpenseType(type) {
      AppState.currentExpenseType = type;

      // Update UI
      const personalBtn = document.querySelector('[onclick*="setExpenseType(\'personal\')"]');
      const splitBtn = document.querySelector('[onclick*="setExpenseType(\'split\')"]');

      if (personalBtn && splitBtn) {
        personalBtn.classList.toggle('active', type === 'personal');
        splitBtn.classList.toggle('active', type === 'split');
      }

      // Show/hide split section
      const splitSection = document.getElementById('split-section');
      if (splitSection) {
        splitSection.style.display = type === 'split' ? 'block' : 'none';
      }
    }

    // Make it globally accessible
    window.setExpenseType = setExpenseType;

    const demoGroups = [
      { id: 1, name: 'College Friends', icon: 'üéì', members: 4, balance: -420, color: '#10B981' },
      { id: 2, name: 'Family Trip', icon: '‚úàÔ∏è', members: 5, balance: 150, color: '#F59E0B' }
    ];

    // ‚îÄ‚îÄ‚îÄ SUPABASE MANAGER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const SupabaseManager = {
      client: null,

      // Initialize Supabase client
      init() {
        if (typeof window.supabase !== 'undefined' && SUPABASE_URL && SUPABASE_ANON_KEY) {
          const { createClient } = window.supabase;
          this.client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
          return true;
        }
        return false;
      },

      // Check current session
      async getSession() {
        if (!this.client) return null;
        const { data: { session } } = await this.client.auth.getSession();
        return session;
      },

      // Sign up with email
      async signUp(email, password, name) {
        if (!this.client) return { error: { message: 'Not connected to cloud' } };
        const { data, error } = await this.client.auth.signUp({
          email,
          password,
          options: { data: { full_name: name } }
        });
        return { data, error };
      },

      // Sign in with email
      async signIn(email, password) {
        if (!this.client) return { error: { message: 'Not connected to cloud' } };
        const { data, error } = await this.client.auth.signInWithPassword({ email, password });
        return { data, error };
      },

      // Sign in with Google
      async signInWithGoogle() {
        if (!this.client) return { error: { message: 'Not connected to cloud' } };
        const { data, error } = await this.client.auth.signInWithOAuth({
          provider: 'google',
          options: { redirectTo: window.location.origin }
        });
        return { data, error };
      },

      // Sign in with OTP (phone)
      async signInWithOTP(phone) {
        if (!this.client) return { error: { message: 'Not connected to cloud' } };
        const { data, error } = await this.client.auth.signInWithOtp({ phone });
        return { data, error };
      },

      // Verify OTP
      async verifyOTP(phone, token) {
        if (!this.client) return { error: { message: 'Not connected to cloud' } };
        const { data, error } = await this.client.auth.verifyOtp({ phone, token, type: 'sms' });
        return { data, error };
      },

      // Sign out
      async signOut() {
        if (!this.client) return;
        await this.client.auth.signOut();
        AppState.user = null;
        AppState.isAuthenticated = false;
      },

      // ‚îÄ‚îÄ‚îÄ DATA SYNC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      // Sync expenses to cloud
      async syncExpenses() {
        if (!this.client || !AppState.user) return;
        AppState.syncStatus = 'syncing';

        try {
          const { error } = await this.client
            .from('expenses')
            .upsert(AppState.expenses.map(e => ({
              ...e,
              user_id: AppState.user.id
            })));

          if (error) throw error;
          AppState.syncStatus = 'synced';
        } catch (e) {
          console.error('Sync error:', e);
          AppState.syncStatus = 'error';
        }
      },

      // Delete expense from cloud
      async deleteExpense(expenseId) {
        if (!this.client || !AppState.user) return;

        const { error } = await this.client
          .from('expenses')
          .delete()
          .eq('id', expenseId)
          .eq('user_id', AppState.user.id);

        if (error) console.error('Delete error:', error);
      },

      // Load expenses from cloud
      async loadExpenses() {
        if (!this.client || !AppState.user) return [];

        const { data, error } = await this.client
          .from('expenses')
          .select('*')
          .eq('user_id', AppState.user.id)
          .order('created_at', { ascending: false });

        return error ? [] : data;
      },

      // Sync friends to cloud
      async syncFriends() {
        if (!this.client || !AppState.user) return;

        const { error } = await this.client
          .from('friends')
          .upsert(AppState.friends.map(f => ({
            ...f,
            user_id: AppState.user.id
          })));

        if (error) console.error('Friends sync error:', error);
      },

      // Load friends from cloud
      async loadFriends() {
        if (!this.client || !AppState.user) return [];

        const { data, error } = await this.client
          .from('friends')
          .select('*')
          .eq('user_id', AppState.user.id);

        return error ? [] : data;
      },

      // Sync groups to cloud
      async syncGroups() {
        if (!this.client || !AppState.user) return;

        const { error } = await this.client
          .from('groups')
          .upsert(AppState.groups.map(g => ({
            ...g,
            user_id: AppState.user.id
          })));

        if (error) console.error('Groups sync error:', error);
      },

      // Load groups from cloud
      async loadGroups() {
        if (!this.client || !AppState.user) return [];

        const { data, error } = await this.client
          .from('groups')
          .select('*')
          .eq('user_id', AppState.user.id);

        return error ? [] : data;
      },

      // Full sync - load all data from cloud
      async fullSync() {
        if (!this.client || !AppState.user) return;

        AppState.syncStatus = 'syncing';

        try {
          const [expenses, friends, groups] = await Promise.all([
            this.loadExpenses(),
            this.loadFriends(),
            this.loadGroups()
          ]);

          AppState.expenses = expenses;
          AppState.friends = friends;
          AppState.groups = groups;
          AppState.syncStatus = 'synced';

          // Save to localStorage for offline access
          saveToLocalStorage();

          return true;
        } catch (e) {
          console.error('Full sync error:', e);
          AppState.syncStatus = 'error';
          return false;
        }
      },

      // Setup real-time subscriptions
      setupRealtimeSync() {
        if (!this.client || !AppState.user) return;

        this.client
          .channel('expenses-changes')
          .on('postgres_changes', { event: '*', schema: 'public', table: 'expenses' }, () => {
            this.loadExpenses().then(data => {
              AppState.expenses = data;
              renderRecentExpenses();
            });
          })
          .subscribe();
      }
    };


    // Premium Sample Data
    const premiumExpenses = [
      {
        id: 1,
        description: 'Gourmet Dinner at Olive Garden',
        amount: 2850,
        date: 'Today, 8:30 PM',
        paidBy: 'You',
        splitWith: ['Raj Kumar', 'Priya Singh'],
        category: 'üçΩÔ∏è',
        location: 'Connaught Place, Delhi',
        status: 'pending'
      },
      {
        id: 2,
        description: 'Premium Uber Ride',
        amount: 680,
        date: 'Today, 6:15 PM',
        paidBy: 'Raj Kumar',
        splitWith: ['You'],
        category: 'üöó',
        location: 'Airport ‚Üí Hotel',
        status: 'settled'
      },
      {
        id: 3,
        description: 'IMAX Movie Experience',
        amount: 1200,
        date: 'Yesterday, 9:30 PM',
        paidBy: 'Priya Singh',
        splitWith: ['You', 'Amit Sharma'],
        category: 'üé¨',
        location: 'PVR Director\'s Cut',
        status: 'settled'
      }
    ];
    // Enhanced Helper Functions
    function $(id) {
      return document.getElementById(id);
    }

    /**
     * Safe DOM element getter with null checking
     * @param {string} id - Element ID  
     * @param {Object} options - Configuration options
     * @returns {HTMLElement|null}
     */
    function safeGet(id, options = {}) {
      const element = document.getElementById(id);

      if (!element && options.required) {
        console.error(`Required element not found: ${id}`);
        if (options.fallback) options.fallback();
      }

      return element;
    }

    /**
     * Sanitize HTML to prevent XSS attacks
     * @param {string} str - String to sanitize
     * @returns {string} - Sanitized HTML-safe string
     */
    function sanitizeHTML(str) {
      if (typeof str !== 'string') return '';

      // Remove script tags and event handlers
      str = str.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
      str = str.replace(/on\w+\s*=\s*["'][^"']*["']/gi, '');

      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    /**
     * Safely parse JSON with error handling
     * @param {string} str - JSON string to parse
     * @param {*} fallback - Fallback value if parse fails
     * @returns {*} - Parsed object or fallback
     */
    function safeJSONParse(str, fallback = null) {
      try {
        return str ? JSON.parse(str) : fallback;
      } catch (e) {
        console.error('JSON parse error:', e.message);
        return fallback;
      }
    }

    /**
     * Validate monetary amount input
     * @param {*} value - Value to validate
     * @returns {Object} - {valid: boolean, value?: number, error?: string}
     */
    function validateAmount(value) {
      const num = parseFloat(value);
      if (isNaN(num)) {
        return { valid: false, error: 'Please enter a valid number' };
      }
      if (num <= 0) {
        return { valid: false, error: 'Amount must be positive' };
      }
      if (!isFinite(num)) {
        return { valid: false, error: 'Amount is too large' };
      }
      if (num > 1000000) {
        return { valid: false, error: 'Amount exceeds maximum (1,000,000)' };
      }
      return { valid: true, value: Math.round(num * 100) / 100 }; // Round to 2 decimals
    }


    /**
     * State Manager - Centralized state validation and mutation control
     * Prevents invalid data from entering AppState
     */
    /**
     * State management module with validation
     * Provides safe methods to mutate application state
     */
    const StateManager = {
      /**
       * Validates an expense object
       * @param {Object} expense - Expense to validate
       * @param {number} expense.amount - Amount (must be > 0)
       * @param {string} expense.description - Description (required)
       * @param {string} expense.paidBy - Who paid (required)
       * @param {boolean} expense.isPersonal - Personal or split
       * @param {Array<string>} expense.splitWith - Participants (required if !isPersonal)
       * @returns {{valid: boolean, error?: string}}
       */
      validateExpense(expense) {
        if (!expense) return { valid: false, error: 'Expense is required' };
        if (!expense.amount || expense.amount <= 0) {
          return { valid: false, error: 'Invalid amount' };
        }
        if (!expense.description || !expense.description.trim()) {
          return { valid: false, error: 'Description is required' };
        }
        if (!expense.paidBy) {
          return { valid: false, error: 'Paid by is required' };
        }
        if (!expense.isPersonal && (!expense.splitWith || expense.splitWith.length === 0)) {
          return { valid: false, error: 'Split participants required' };
        }
        return { valid: true };
      },

      validateFriend(friend) {
        if (!friend) return { valid: false, error: 'Friend is required' };
        if (!friend.name || !friend.name.trim()) {
          return { valid: false, error: 'Friend name is required' };
        }
        if (!friend.id) {
          return { valid: false, error: 'Friend ID is required' };
        }
        return { valid: true };
      },

      /**
       * Adds an expense to the application state
       * @param {Object} expense - Expense object to add
       * @returns {boolean} True if added successfully, false otherwise
       */
      addExpense(expense) {
        const validation = this.validateExpense(expense);
        if (!validation.valid) {
          console.error('Invalid expense:', validation.error);
          showNotification(validation.error, 'error');
          return false;
        }

        // Add timestamp if not present
        if (!expense.timestamp) {
          expense.timestamp = Date.now();
        }

        AppState.expenses.unshift(expense);
        saveToLocalStorage();
        return true;
      },

      /**
       * Adds a friend to the application state
       * @param {Object} friend - Friend object to add
       * @returns {boolean} True if added successfully, false otherwise
       */
      addFriend(friend) {
        const validation = this.validateFriend(friend);
        if (!validation.valid) {
          console.error('Invalid friend:', validation.error);
          showNotification(validation.error, 'error');
          return false;
        }

        // Check for duplicates
        const exists = AppState.friends.some(f => f.id === friend.id);
        if (exists) {
          showNotification('Friend already exists', 'error');
          return false;
        }

        AppState.friends.push(friend);
        saveToLocalStorage();
        return true;
      },

      removeExpense(expenseId) {
        const index = AppState.expenses.findIndex(e => e.id === expenseId);
        if (index === -1) {
          console.warn('Expense not found:', expenseId);
          return false;
        }

        AppState.expenses.splice(index, 1);
        saveToLocalStorage();
        updateBalance(); // Recalculate balances
        return true;
      }
    };


    /**
     * Data Migration System
     * Handles schema version upgrades for localStorage data
     */
    const SCHEMA_VERSION = 2;

    const DataMigration = {
      migrate(data) {
        const version = data.version || 1;

        if (version < 2) {
          data = this.migrateV1toV2(data);
        }

        data.version = SCHEMA_VERSION;
        return data;
      },

      migrateV1toV2(data) {
        // Add timestamps to expenses if missing
        if (data.expenses) {
          data.expenses = data.expenses.map(expense => {
            if (!expense.timestamp) {
              // Convert date string to timestamp if available
              if (expense.date) {
                expense.timestamp = new Date(expense.date).getTime();
              } else {
                expense.timestamp = Date.now();
              }
            }
            return expense;
          });
        }

        // Add IDs to friends if missing
        if (data.friends) {
          data.friends = data.friends.map(friend => {
            if (!friend.id) {
              friend.id = 'friend_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            return friend;
          });
        }

        return data;
      },

      loadWithMigration() {
        try {
          // Try loading new atomic format first
          const atomicData = localStorage.getItem('monez_data');
          if (atomicData) {
            let data = safeJSONParse(atomicData, null);
            if (data) {
              data = this.migrate(data);
              return data;
            }
          }

          // Fallback to legacy format
          const expenses = localStorage.getItem('monez_expenses');
          const friends = localStorage.getItem('monez_friends');
          const groups = localStorage.getItem('monez_groups');

          const legacyData = {
            expenses: safeJSONParse(expenses, []),
            friends: safeJSONParse(friends, []),
            groups: safeJSONParse(groups, []),
            version: 1
          };

          return this.migrate(legacyData);
        } catch (e) {
          console.error('Migration error:', e);
          return {
            expenses: [],
            friends: [],
            groups: [],
            version: SCHEMA_VERSION
          };
        }
      }
    };

    /**
     * Format a number as currency with the current currency symbol
     * @param {number} amount - Amount to format
     * @returns {string} Formatted currency string (e.g., "$100.00")
     */
    function formatCurrency(amount) {
      return i18n.formatCurrency(amount);
    }

    function createRippleEffect(element, event) {
      const ripple = document.createElement('div');
      const rect = element.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = event.clientX - rect.left - size / 2;
      const y = event.clientY - rect.top - size / 2;

      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      ripple.style.position = 'absolute';
      ripple.style.borderRadius = '50%';
      ripple.style.background = 'rgba(255,255,255,0.3)';
      ripple.style.transform = 'scale(0)';
      ripple.style.animation = 'ripple 0.6s ease-out';
      ripple.style.pointerEvents = 'none';

      element.style.position = 'relative';
      element.style.overflow = 'hidden';
      element.appendChild(ripple);

      setTimeout(() => {
        ripple.remove();
      }, 600);
    }

    function animateNumber(element, start, end, duration = 1000) {
      const startTime = performance.now();
      const range = end - start;

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const current = Math.round(start + range * easeOutQuart);

        element.textContent = formatCurrency(current);

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }

      requestAnimationFrame(update);
    }

    /**
     * Display a notification to the user
     * @param {string} message - Message to display
     * @param {string} type - Notification type: 'success', 'error', or 'info'
     * @param {number} duration - Duration in milliseconds (default: 3000)
     */
    function showNotification(message, type = 'success', duration = 3000) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#3B82F6'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 10000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        font-size: 14px;
        font-weight: 500;
        max-width: 300px;
      `;
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
          <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; margin-left: 8px; font-size: 16px;">√ó</button>
        </div>
      `;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);

      setTimeout(() => {
        notification.style.transform = 'translateX(400px)';
        setTimeout(() => notification.remove(), 300);
      }, duration);
    }

    /**
     * Show loading overlay
     */
    function showLoading() {
      const overlay = safeGet('loading-overlay');
      if (overlay) {
        overlay.style.display = 'flex';
      }
    }

    /**
     * Hide loading overlay
     */
    function hideLoading() {
      const overlay = safeGet('loading-overlay');
      if (overlay) {
        overlay.style.display = 'none';
      }
    }
    // Enhanced Navigation Functions
    function showHome() {
      showView('home');
      renderRecentExpenses();
      renderGroupsPreview();
      updateNavigation('home');
    }

    function showAddExpense() {
      showView('add-expense');
      populatePeopleSelector();
      AppState.selectedFriends.clear();
      AppState.selectedCategory = '';
      resetForm();
    }

    function showExpenses() {
      showView('expenses');
      renderAllExpenses();
      updateNavigation('expenses');
    }

    function showBalances() {
      showView('balances');
      renderBalances();
      updateNavigation('balances');
    }

    function showGroups() {
      showView('groups');
      renderGroups();
      updateNavigation('groups');
    }

    /**
     * Show a specific view and hide all others
     * @param {string} viewName - Name of the view to show ('home', 'expenses', 'balances', 'groups')
     */
    function showView(viewName) {
      showView('premium');
      renderPremiumFeatures();
      updateNavigation('premium');
    }

    function showPremiumFeatures() {
      showView('premium');
      renderPremiumFeatures();
      updateNavigation('premium');
    }

    function showSettings() {
      showView('settings');
      updateNavigation('settings');
    }

    function showCountry() {
      showView('country');
      updateNavigation('country');
      renderCountries();
    }

    // Global state for country/language selection
    let selectedCountry = null;
    let selectedLanguage = null;
    let selectedCurrency = null;

    // Render countries grid
    function renderCountries(searchTerm = '') {
      const container = $('countries-grid');
      if (!container) return;
      container.innerHTML = '';

      const filtered = Object.entries(COUNTRIES).filter(([code, country]) => {
        if (!searchTerm) return true;
        const search = searchTerm.toLowerCase();
        return country.name.toLowerCase().includes(search) ||
          code.toLowerCase().includes(search);
      });

      if (filtered.length === 0) {
        container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #64748B;"><div style="font-size: 48px; margin-bottom: 16px;">üîç</div><div style="font-size: 16px;">No countries found</div></div>';
        return;
      }

      filtered.forEach(([code, country]) => {
        const card = document.createElement('div');
        card.className = 'country-card';
        const isActive = selectedCountry === code;

        card.style.cssText = 'background: ' + (isActive ? 'linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%)' : '#FFFFFF') + '; border: 2px solid ' + (isActive ? '#10B981' : '#E2E8F0') + '; border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.2s ease; position: relative; min-height: 140px; display: flex; flex-direction: column; justify-content: center;';

        card.onclick = function () {
          showLanguageSelector(code);
        };

        const checkmark = isActive ? '<div style="position: absolute; top: 8px; right: 8px; font-size: 20px;">‚úì</div>' : '';
        const currencyBadge = country.currencies.length === 1 ?
          '<div style="display: inline-block; background: #F1F5F9; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; color: #475569;">' + country.currencies[0] + '</div>' :
          '<div style="display: inline-block; background: #FEF3C7; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; color: #92400E;">' + country.currencies.length + ' currencies</div>';

        card.innerHTML = checkmark +
          '<div style="font-size: 48px; margin-bottom: 12px;">' + country.flag + '</div>' +
          '<div style="font-weight: 600; font-size: 16px; color: #1E293B; margin-bottom: 4px;">' + country.name + '</div>' +
          '<div style="font-size: 13px; color: #64748B; margin-bottom: 8px;">' + country.languages.length + ' language' + (country.languages.length > 1 ? 's' : '') + '</div>' +
          currencyBadge;

        card.onmouseenter = function () {
          if (!isActive) {
            card.style.transform = 'translateY(-4px)';
            card.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
          }
        };
        card.onmouseleave = function () {
          card.style.transform = 'translateY(0)';
          card.style.boxShadow = 'none';
        };

        container.appendChild(card);
      });
    }

    // Show language selector modal
    function showLanguageSelector(countryCode) {
      const country = COUNTRIES[countryCode];
      if (!country) return;

      selectedCountry = countryCode;

      const modal = document.createElement('div');
      modal.id = 'language-selector-modal';
      modal.className = 'modal';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';

      const modalContent = document.createElement('div');
      modalContent.style.cssText = 'background: white; border-radius: 16px; padding: 24px; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto;';

      let html = '<div style="text-align: center; margin-bottom: 20px;"><div style="font-size: 48px; margin-bottom: 8px;">' + country.flag + '</div><h3 style="margin: 0 0 8px 0; font-size: 20px; color: #1E293B;">' + country.name + '</h3><p style="margin: 0; font-size: 14px; color: #64748B;">Select your language</p></div>';

      html += '<div style="display: flex; flex-direction: column; gap: 8px;">';

      country.languages.forEach(function (langCode) {
        const lang = LANGUAGES[langCode];
        if (!lang) return;

        const isActive = i18n.currentLang === langCode;
        html += '<button onclick="selectLanguageAndCurrency(\'' + countryCode + '\', \'' + langCode + '\')" style="padding: 16px; border: 2px solid ' + (isActive ? '#10B981' : '#E2E8F0') + '; background: ' + (isActive ? '#ECFDF5' : 'white') + '; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center;">' +
          '<div><div style="font-weight: 600; font-size: 16px; color: #1E293B;">' + lang.name + '</div><div style="font-size: 14px; color: #64748B;">' + lang.nativeName + '</div></div>' +
          (isActive ? '<div style="font-size: 20px; color: #10B981;">‚úì</div>' : '') +
          '</button>';
      });

      html += '</div>';
      html += '<button onclick="closeLanguageSelector()" style="margin-top: 16px; width: 100%; padding: 12px; background: #F1F5F9; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; color: #475569;">Cancel</button>';

      modalContent.innerHTML = html;
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
    }

    // Select language and handle currency
    function selectLanguageAndCurrency(countryCode, langCode) {
      const country = COUNTRIES[countryCode];

      // If single currency, auto-select it
      if (country.currencies.length === 1) {
        selectedCurrency = country.currencies[0];
        applySelection(countryCode, langCode, selectedCurrency);
      } else {
        // Show currency selector
        showCurrencySelector(countryCode, langCode);
      }
    }

    // Show currency selector for countries with multiple currencies
    function showCurrencySelector(countryCode, langCode) {
      const country = COUNTRIES[countryCode];

      const modal = $('language-selector-modal');
      if (!modal) return;

      const modalContent = modal.querySelector('div');

      let html = '<div style="text-align: center; margin-bottom: 20px;"><div style="font-size: 48px; margin-bottom: 8px;">' + country.flag + '</div><h3 style="margin: 0 0 8px 0; font-size: 20px; color: #1E293B;">' + country.name + '</h3><p style="margin: 0; font-size: 14px; color: #64748B;">Select your currency</p></div>';

      html += '<div style="display: flex; flex-direction: column; gap: 8px;">';

      country.currencies.forEach(function (currCode) {
        const curr = CURRENCIES[currCode];
        if (!curr) return;

        html += '<button onclick="applySelection(\'' + countryCode + '\', \'' + langCode + '\', \'' + currCode + '\')" style="padding: 16px; border: 2px solid #E2E8F0; background: white; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.2s;">' +
          '<div style="font-weight: 600; font-size: 16px; color: #1E293B;">' + curr.name + '</div>' +
          '<div style="font-size: 14px; color: #64748B;">' + curr.symbol + ' (' + currCode + ')</div>' +
          '</button>';
      });

      html += '</div>';
      html += '<button onclick="closeLanguageSelector()" style="margin-top: 16px; width: 100%; padding: 12px; background: #F1F5F9; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; color: #475569;">Cancel</button>';

      modalContent.innerHTML = html;
    }

    // Apply the final selection
    function applySelection(countryCode, langCode, currCode) {
      selectedCountry = countryCode;
      selectedLanguage = langCode;
      selectedCurrency = currCode;

      // Save to localStorage
      localStorage.setItem('selectedCountry', countryCode);
      localStorage.setItem('selectedLanguage', langCode);
      localStorage.setItem('selectedCurrency', currCode);

      // Change language
      changeLanguage(langCode);

      // Change currency
      if (window.changeCurrency) {
        changeCurrency(currCode);
      }

      // Close modal
      closeLanguageSelector();

      // Re-render countries to show selection
      renderCountries();

      // Show notification
      const country = COUNTRIES[countryCode];
      const lang = LANGUAGES[langCode];
      showNotification('Set to ' + country.name + ' - ' + lang.nativeName + ' (' + currCode + ')', 'success');
    }

    // Close language selector modal
    function closeLanguageSelector() {
      const modal = $('language-selector-modal');
      if (modal) modal.remove();
    }

    // Filter countries
    function filterCountries(searchTerm) {
      renderCountries(searchTerm);
    }

    // Initialize from localStorage
    function initializeCountrySelection() {
      const savedCountry = localStorage.getItem('selectedCountry');
      const savedLanguage = localStorage.getItem('selectedLanguage');
      const savedCurrency = localStorage.getItem('selectedCurrency');

      if (savedCountry && savedLanguage && savedCurrency) {
        selectedCountry = savedCountry;
        selectedLanguage = savedLanguage;
        selectedCurrency = savedCurrency;
      }
    }
    // Additional functions


    function showSettle() {
      // Calculate current balances first
      const balances = calculateUserBalances();
      const debts = balances.filter(b => b.amount < 0); // Negative means I owe them

      const modal = document.createElement('div');
      modal.id = 'settle-modal';
      modal.className = 'modal';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';

      let debtsHtml = '';
      if (debts.length === 0) {
        debtsHtml = `
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 48px; margin-bottom: 12px;">üéâ</div>
            <div style="font-weight: 600; margin-bottom: 4px;">You are debt free!</div>
            <div style="font-size: 14px; color: var(--secondary-text);">You don't owe anyone anything right now.</div>
          </div>
        `;
      } else {
        debtsHtml = `<div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">`;
        debts.forEach(debt => {
          const amount = Math.abs(debt.amount);
          debtsHtml += `
            <div style="display: flex; justify-content: space-between; align-items: center; background: var(--surface-elevated); padding: 12px 16px; border-radius: 12px; border: 1px solid var(--borders);">
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; background: #EF4444; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                  ${debt.name.charAt(0)}
                </div>
                <div>
                  <div style="font-weight: 600;">${debt.name}</div>
                  <div style="font-size: 12px; color: var(--secondary-text);">You owe</div>
                </div>
              </div>
              <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
                <div style="font-weight: 700; color: #EF4444;">${formatCurrency(amount)}</div>
                <button onclick="processSettlement('${debt.name}', ${amount})" style="background: #10B981; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Pay Now</button>
              </div>
            </div>
          `;
        });
        debtsHtml += `</div>`;
      }

      modal.innerHTML = `
        <div class="animate-enter" style="background: var(--surface); border-radius: 16px; padding: 24px; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; display: flex; align-items: center; gap: 8px;">üí≥ Settle Up</h3>
            <button onclick="const m = document.getElementById('settle-modal'); if (m) m.remove();" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text);">√ó</button>
          </div>
          ${debtsHtml}
        </div>
      `;

      document.body.appendChild(modal);
    }

    function processSettlement(friendName, amount) {
      if (!confirm(`Mark ${formatCurrency(amount)} paid to ${friendName}? This will clear your debt.`)) return;

      // Create settlement expense
      const expense = {
        id: Date.now(),
        description: `Settlement to ${friendName}`,
        amount: amount,
        date: new Date().toISOString(),
        isPersonal: false,
        isSettlement: true, // Key flag
        paidBy: 'You',
        splitWith: [friendName], // Direct 1-to-1
        category: 'üí∏'
      };

      // Add to state
      if (!StateManager.addExpense(expense)) return;

      // Save
      saveToLocalStorage();

      // Update UI
      renderRecentExpenses();
      updateBalance();
      updateExpenseStats();

      // Close modal
      const modal = document.getElementById('settle-modal');
      if (modal) modal.remove();

      showNotification(`‚úÖ Paid ${formatCurrency(amount)} to ${friendName}`, 'success');
    }

    function showNotifications() {
      showNotification('üîî 3 new reminders: Raj owes ‚Çπ185, Movie night expense added, Premium features available!', 'info', 5000);
    }

    function showProfile() {
      showView('profile-view');
      updateNavigation('profile');
      renderProfileData();
    }

    function renderProfileData() {
      const settings = storage.load('settings', {});
      const name = settings.name || 'User';
      const nameEl = document.getElementById('profile-display-name');
      if (nameEl) nameEl.textContent = name;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SHARE & CONNECT SYSTEM - 12+ Ways to Connect
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    function showShareConnectModal() {
      const modal = document.createElement('div');
      modal.id = 'share-connect-modal';
      modal.className = 'modal';
      modal.innerHTML = `
            < div class= "modal-content" style = "max-width: 420px; max-height: 90vh; overflow-y: auto;" >
          <div class="modal-header">
            <h3>üîó Share & Connect</h3>
            <button class="modal-close" onclick="closeShareModal()">√ó</button>
          </div>
          <div class="modal-body" style="padding: var(--space-lg);">
            
            <!-- Add Friend Section -->
            <div style="margin-bottom: var(--space-lg);">
              <h4 style="margin-bottom: var(--space-sm); color: var(--primary-accent);">üë§ Add Friend</h4>
              <div style="display: flex; gap: 8px;">
                <input type="text" id="new-friend-name" class="search-input" placeholder="Friend's name" data-i18n-placeholder="friend_name_placeholder" style="flex: 1;">
                <button class="btn-primary" onclick="addNewFriend()" style="padding: 8px 12px; white-space: nowrap;">+ Add</button>
              </div>
            </div>
            
            <!-- Invite via Apps -->
            <div style="margin-bottom: var(--space-lg);">
              <h4 style="margin-bottom: var(--space-sm); color: var(--primary-accent);">üì± Invite via Apps</h4>
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-sm);">
                <button onclick="shareViaWhatsApp()" class="share-btn" title="WhatsApp">
                  <span style="font-size: 24px;">üì≤</span>
                  <span style="font-size: 10px;">WhatsApp</span>
                </button>
                <button onclick="shareViaTelegram()" class="share-btn" title="Telegram">
                  <span style="font-size: 24px;">‚úàÔ∏è</span>
                  <span style="font-size: 10px;">Telegram</span>
                </button>
                <button onclick="shareViaSMS()" class="share-btn" title="SMS">
                  <span style="font-size: 24px;">üí¨</span>
                  <span style="font-size: 10px;">SMS</span>
                </button>
                <button onclick="shareViaEmail()" class="share-btn" title="Email">
                  <span style="font-size: 24px;">üìß</span>
                  <span style="font-size: 10px;">Email</span>
                </button>
                <button onclick="shareViaTwitter()" class="share-btn" title="Twitter/X">
                  <span style="font-size: 24px;">üê¶</span>
                  <span style="font-size: 10px;">Twitter</span>
                </button>
                <button onclick="shareViaFacebook()" class="share-btn" title="Facebook">
                  <span style="font-size: 24px;">üìò</span>
                  <span style="font-size: 10px;">Facebook</span>
                </button>
                <button onclick="shareViaLinkedIn()" class="share-btn" title="LinkedIn">
                  <span style="font-size: 24px;">üíº</span>
                  <span style="font-size: 10px;">LinkedIn</span>
                </button>
                <button onclick="shareViaNative()" class="share-btn" title="More...">
                  <span style="font-size: 24px;">üì§</span>
                  <span style="font-size: 10px;">More...</span>
                </button>
              </div>
            </div>
            
            <!-- QR Code Section -->
            <div style="margin-bottom: var(--space-lg);">
              <h4 style="margin-bottom: var(--space-sm); color: var(--primary-accent);">üì∑ Scan QR Code</h4>
              <div id="qr-code-container" style="background: white; padding: 20px; border-radius: var(--radius-md); text-align: center;">
                <div id="qr-code" style="display: inline-block;"></div>
                <p style="margin-top: var(--space-sm); font-size: var(--text-sm); color: var(--secondary-text);">
                  Scan to join monEZ
                </p>
              </div>
            </div>
            
            <!-- Copy Link -->
            <div style="margin-bottom: var(--space-lg);">
              <h4 style="margin-bottom: var(--space-sm); color: var(--primary-accent);">üîó Share Link</h4>
              <div style="display: flex; gap: var(--space-sm);">
                <input type="text" id="share-link" class="search-input" value="${getShareLink()}" readonly style="flex: 1; font-size: 12px;">
                <button class="btn btn-secondary" onclick="copyShareLink()" style="padding: 8px 16px;">üìã Copy</button>
              </div>
            </div>
            
            <!-- Group Invite -->
            <div>
              <h4 style="margin-bottom: var(--space-sm); color: var(--primary-accent);">üë• Invite to Group</h4>
              <select id="group-select" class="setting-select" style="width: 100%; margin-bottom: var(--space-sm);">
                ${AppState.groups.map(g => `<option value="${g.id}">${g.icon} ${g.name}</option>`).join('')}
              </select>
              <button class="btn btn-primary" onclick="shareGroupInvite()" style="width: 100%;">
                üì® Send Group Invite
              </button>
            </div>
            
          </div>
        </div >
            `;
      document.body.appendChild(modal);

      // Generate QR Code
      generateQRCode();

      // Add CSS for share buttons
      addShareButtonStyles();
    }

    function closeShareModal() {
      const modal = $('share-connect-modal');
      if (modal) modal.remove();
    }

    function addShareButtonStyles() {
      if ($('share-btn-styles')) return;
      const style = document.createElement('style');

      // Profile View Functions
      function showProfile() {
        hideAllViews();
        $('profile-view').style.display = 'block';
        updateNav('profile');
      }

      function showLanguageSettings() {
        // Show country selector (moved from main nav)
        showCountry();
      }

      function showNotificationSettings() {
        const settings = storage.load('settings', { notifications: false });

        const enabled = !settings.notifications; // Toggle
        settings.notifications = enabled;
        storage.save('settings', settings);

        if (enabled) {
          showNotification('üîî Notifications Enabled', 'success');
          if (Notification.permission !== 'granted') Notification.requestPermission();
        } else {
          showNotification('üîï Notifications Disabled', 'info');
        }
      }

      function showAppearanceSettings() {
        toggleDarkMode();
        const isDark = document.body.classList.contains('dark-mode');
        showNotification(isDark ? 'üåô Dark Mode Active' : '‚òÄÔ∏è Light Mode Active', 'success');

        const settings = storage.load('settings', {});
        settings.darkMode = isDark;
        storage.save('settings', settings);
      }

      function showDataSettings() {
        showSettings();
      }

      function editProfile() {
        // Get current profile
        const settings = storage.load('settings', {});
        const name = settings.name || 'User';
        const currency = settings.currency || 'USD';

        const modal = document.createElement('div');
        modal.id = 'edit-profile-modal';
        modal.className = 'modal';
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';

        const currencyOptions = Object.keys(CURRENCIES).map(c =>
          `<option value="${c}" ${c === currency ? 'selected' : ''}>${CURRENCIES[c].symbol} ${c} - ${CURRENCIES[c].name}</option>`
        ).join('');

        modal.innerHTML = `
        <div class="animate-enter" style="background: var(--surface); border-radius: 16px; padding: 24px; max-width: 400px; width: 90%;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">üë§ Edit Profile</h3>
            <button onclick="const m = document.getElementById('edit-profile-modal'); if (m) m.remove();" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
          </div>
          
    // Global expense type state
          
          <div class="form-group" style="margin-top: 16px;">
            <label class="form-label" style="display:block; margin-bottom:8px; font-weight:600;">Currency</label>
            <select id="profile-currency" class="form-input" style="width: 100%; padding: 12px; border: 1px solid var(--borders); border-radius: 8px;">
               ${currencyOptions}
            </select>
          </div>

          <button onclick="saveProfileDetails()" style="width: 100%; margin-top: 24px; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Save Changes</button>
        </div>
      `;
        document.body.appendChild(modal);
      }

      function saveProfileDetails() {
        const nameInput = safeGet('profile-name');
        const currencyInput = safeGet('profile-currency');

        if (!nameInput || !currencyInput) {
          showNotification('Form error', 'error');
          return;
        }

        const name = nameInput.value;
        const currency = currencyInput.value;

        if (!name) return showNotification('Name cannot be empty', 'error');

        const settings = storage.load('settings', {});
        settings.name = name;
        settings.currency = currency;
        storage.save('settings', settings);

        showNotification('‚úÖ Profile updated! Reloading...', 'success');
        setTimeout(() => location.reload(), DELAYS.RELOAD);
      }

      function showPremium() {
        if (localStorage.getItem('isPremium') === 'true') {
          showNotification('‚ú® You are already a Premium Member!', 'success');
          return;
        }

        const modal = document.createElement('div');
        modal.id = 'premium-modal';
        modal.className = 'modal';
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';

        modal.innerHTML = `
        <div class="animate-enter" style="background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%); border-radius: 20px; padding: 30px; max-width: 350px; width: 90%; text-align: center; border: 2px solid #D4AF37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);">
          <div style="font-size: 48px; margin-bottom: 20px;">üëë</div>
          <h2 style="color: #D4AF37; margin-bottom: 15px; font-family:serif;">monEZ Gold</h2>
          <p style="color: #e0e0e0; margin-bottom: 25px; line-height: 1.6;">Unlock the exclusive Gold Theme, remove ads, and support development.</p>
          <button onclick="activatePremium()" style="width: 100%; padding: 15px; background: linear-gradient(to right, #D4AF37, #F2D06B); color: black; border: none; border-radius: 50px; font-weight: bold; font-size: 16px; cursor: pointer; transition: transform 0.2s;">
            UNLOCK FOR FREE (Beta)
          </button>
          <button onclick="const m = document.getElementById('premium-modal'); if (m) m.remove();" style="background: none; border: none; color: #888; margin-top: 15px; cursor: pointer;">No thanks</button>
        </div>
      `;
        document.body.appendChild(modal);
      }

      function activatePremium() {
        localStorage.setItem('isPremium', 'true');
        const modal = safeGet('premium-modal');
        if (modal) modal.remove();

        // Apply gold theme immediately
        const style = document.createElement('style');
        style.innerHTML = `
        :root { --primary: #D4AF37 !important; --primary-accent: #C5A028 !important; }
        body { background: #121212 !important; color: #f5f5f5 !important; }
        .view-header { background: #1a1a1a !important; }
      `;
        document.head.appendChild(style);

        showNotification('üéâ Welcome to Gold Club!', 'success');
        setTimeout(() => location.reload(), DELAYS.RELOAD_PREMIUM);
      }

      function showHelp() {
        const modal = document.createElement('div');
        modal.id = 'help-modal';
        modal.className = 'modal';
        modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';

        modal.innerHTML = `
        <div class="animate-enter" style="background: var(--surface); border-radius: 16px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">‚ùì Help Center</h3>
            <button onclick="const m = document.getElementById('help-modal'); if (m) m.remove();" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text);">√ó</button>
          </div>
          <details style="margin-bottom: 10px; border-bottom: 1px solid var(--borders); padding-bottom: 10px;">
            <summary style="font-weight: 600; cursor: pointer;">How do I split a bill?</summary>
            <p style="margin-top: 8px; color: var(--secondary-text); font-size: 14px;">Go to Add Expense, select "Split" mode, choose friends, and enter the amount. It will be divided equally.</p>
          </details>
          <details style="margin-bottom: 10px; border-bottom: 1px solid var(--borders); padding-bottom: 10px;">
             <summary style="font-weight: 600; cursor: pointer;">How does "Settle Up" work?</summary>
             <p style="margin-top: 8px; color: var(--secondary-text); font-size: 14px;">Click the Settle button on Balance screen. It creates a payment transaction that clears your debt.</p>
          </details>
        </div>
      `;
        document.body.appendChild(modal);
      }

      function showPrivacy() {
        const splitSection = document.getElementById('split-section');

        // Styles for active/inactive states
        const activeStyle = "flex: 1; padding: 12px; border: none; background: white; color: var(--primary); font-weight: 600; font-size: 14px; cursor: pointer; z-index: 1; transition: all 0.3s; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);";
        const inactiveStyle = "flex: 1; padding: 12px; border: none; background: transparent; color: var(--secondary-text); font-weight: 500; font-size: 14px; cursor: pointer; z-index: 1; transition: all 0.3s; border-radius: 8px;";

        if (type === 'personal') {
          if (personalBtn) personalBtn.style.cssText = activeStyle;
          if (splitBtn) splitBtn.style.cssText = inactiveStyle;
          if (splitSection) splitSection.style.display = 'none';
        } else {
          if (splitBtn) splitBtn.style.cssText = activeStyle;
          if (personalBtn) personalBtn.style.cssText = inactiveStyle;
          if (splitSection) {
            splitSection.style.display = 'block';
            populatePeopleSelector();
          }
        }
      }

      function renderCategoryAnalytics() {
        // Group expenses by category
        const categories = {};
        const totalSpent = AppState.expenses
          .filter(e => !e.isSettlement) // Exclude settlements from stats
          .reduce((sum, e) => {
            categories[e.category] = (categories[e.category] || 0) + e.amount;
            return sum + e.amount;
          }, 0);

        // Sort by amount desc
        const sortedCats = Object.entries(categories)
          .sort(([, a], [, b]) => b - a)
          .slice(0, 4); // Top 4 only

        const container = document.getElementById('category-chart');
        if (!container) return;

        if (sortedCats.length === 0) {
          container.innerHTML = '<div style="text-align: center; color: var(--secondary-text); font-size: 13px; padding: 20px;">No expenses yet to analyze.</div>';
          return;
        }

        const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444'];

        container.innerHTML = sortedCats.map(([cat, amount], index) => {
          const percent = ((amount / totalSpent) * 100).toFixed(1);
          return `
          <div class="chart-row">
            <div class="chart-label">${cat} ${cat.length < 3 ? 'Category' : ''}</div> 
            <div class="chart-bar-bg">
              <div class="chart-bar-fill" style="width: ${percent}%; background: ${colors[index] || '#6366F1'};"></div>
            </div>
            <div class="chart-value">${percent}%</div>
          </div>
        `;
        }).join('');
      }

      function signOut() {

        // Friends Management
        function showManageFriends() {
          const modal = document.createElement('div');
          modal.id = 'friends-modal';
          modal.className = 'modal';
          modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';

          modal.innerHTML = '<div style="background: var(--surface); border-radius: 16px; padding: 24px; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto;"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;"><h3 style="margin: 0;">üë• Manage Friends</h3><button onclick="closeFriendsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button></div><div style="margin-bottom: 20px;"><input type="text" id="friend-name" placeholder="Friend\'s name" style="width: 100%; padding: 12px; border: 1px solid var(--borders); border-radius: 8px; margin-bottom: 8px;"><input type="text" id="friend-contact" placeholder="Email or phone (optional)" style="width: 100%; padding: 12px; border: 1px solid var(--borders); border-radius: 8px; margin-bottom: 12px;"><button onclick="addFriend()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">‚ûï Add Friend</button></div><div id="friends-list" style="display: flex; flex-direction: column; gap: 8px;"></div></div>';

          document.body.appendChild(modal);
          renderFriendsList();
        }

        function closeFriendsModal() {
          const modal = document.getElementById('friends-modal');
          if (modal) modal.remove();
        }

        function addFriend() {
          const nameInput = document.getElementById('friend-name');
          const contactInput = document.getElementById('friend-contact');
          const name = nameInput.value.trim();
          const contact = contactInput.value.trim();

          if (!name) {
            showNotification('‚ùå Please enter a name', 'error');
            return;
          }

          const newFriend = {
            id: Date.now(),
            name: name,
            contact: contact || '',
            avatar: name.charAt(0).toUpperCase()
          };

          if (!StateManager.addFriend(newFriend)) return;
          storage.save('friends', AppState.friends);

          nameInput.value = '';
          contactInput.value = '';

          renderFriendsList();
          showNotification('‚úÖ ' + name + ' added!', 'success');
        }

        function removeFriend(friendId) {
          if (confirm('Remove this friend?')) {
            AppState.friends = AppState.friends.filter(f => f.id !== friendId);
            storage.save('friends', AppState.friends);
            renderFriendsList();
            showNotification('üóëÔ∏è Friend removed', 'info');
          }
        }

        function renderFriendsList() {
          const container = document.getElementById('friends-list');
          if (!container) return;

          if (AppState.friends.length === 0) {
            container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--secondary-text);">No friends added yet</div>';
            return;
          }

          container.innerHTML = AppState.friends.map(friend =>
            '<div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--surface-elevated); border-radius: 8px;"><div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">' + sanitizeHTML(friend.avatar) + '</div><div style="flex: 1;"><div style="font-weight: 600;">' + sanitizeHTML(friend.name) + '</div>' + (friend.contact ? '<div style="font-size: 12px; color: var(--secondary-text);">' + sanitizeHTML(friend.contact) + '</div>' : '') + '</div><button onclick="removeFriend(' + friend.id + ')" style="background: none; border: none; color: var(--error); cursor: pointer; font-size: 18px;">üóëÔ∏è</button></div>'
          ).join('');
        }

        if (confirm('Are you sure you want to sign out?')) {
          localStorage.clear();
          location.reload();
        }
      }
      style.id = 'share-btn-styles';
      style.textContent = `
              .share - btn {
                display: flex;
                flex- direction: column;
          align - items: center;
          justify - content: center;
          padding: 12px 8px;
          background: var(--surface);
          border: 1px solid var(--borders);
          border - radius: var(--radius - md);
          cursor: pointer;
          transition: all 0.2s ease;
        }
        .share - btn:hover {
          transform: translateY(-2px);
          box - shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          border - color: var(--gold - accent);
        }
        .share - btn:active {
          transform: scale(0.95);
        }
        `;
      document.head.appendChild(style);
    }

    function getShareLink() {
      // Generate a shareable link with app info
      const baseUrl = window.location.origin || 'https://monez.app';
      return `${baseUrl}?ref = share & from=${encodeURIComponent('monEZ User')} `;
    }

    function getInviteMessage() {
      return `üí∞ Join me on monEZ - the best expense splitting app!\n\n` +
        `‚úÖ Split bills instantly\n` +
        `‚úÖ 55 currencies supported\n` +
        `‚úÖ UPI payments built -in\n` +
        `‚úÖ 100 % FREE, no ads!\n\n` +
        `Download: ${getShareLink()} `;
    }

    // ‚îÄ‚îÄ‚îÄ SHARE VIA APPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function shareViaWhatsApp() {
      const message = encodeURIComponent(getInviteMessage());
      window.open(`https://wa.me/?text=${message}`, '_blank');
      showNotification('üì≤ Opening WhatsApp...', 'info');
    }

    function shareViaTelegram() {
      const message = encodeURIComponent(getInviteMessage());
      window.open(`https://t.me/share/url?url=${encodeURIComponent(getShareLink())}&text=${message}`, '_blank');
      showNotification('‚úàÔ∏è Opening Telegram...', 'info');
    }

    function shareViaSMS() {
      const message = encodeURIComponent(getInviteMessage());
      window.location.href = `sms:?body=${message}`;
      showNotification('üí¨ Opening SMS...', 'info');
    }

    function shareViaEmail() {
      const subject = encodeURIComponent('Join me on monEZ - Split Expenses Easily!');
      const body = encodeURIComponent(getInviteMessage());
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
      showNotification('üìß Opening Email...', 'info');
    }

    function shareViaTwitter() {
      const text = encodeURIComponent('Check out monEZ - the best free expense splitting app! üí∞ Split bills, 55 currencies, UPI payments. ' + getShareLink());
      window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
      showNotification('üê¶ Opening Twitter...', 'info');
    }

    function shareViaFacebook() {
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(getShareLink())}`, '_blank');
      showNotification('üìò Opening Facebook...', 'info');
    }

    function shareViaLinkedIn() {
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(getShareLink())}`, '_blank');
      showNotification('üíº Opening LinkedIn...', 'info');
    }

    function shareViaNative() {
      if (navigator.share) {
        navigator.share({
          title: 'monEZ - Split Expenses',
          text: getInviteMessage(),
          url: getShareLink()
        }).then(() => {
          showNotification('üì§ Shared successfully!', 'success');
        }).catch(error => {
          console.error('Share failed:', error);
          if (error.name !== 'AbortError') {
            showNotification('Share failed. Link copied instead.', 'info');
            copyShareLink();
          }
        });
      } else {
        copyShareLink();
      }
    }

    function copyShareLink() {
      const link = getShareLink();
      navigator.clipboard.writeText(link).then(() => {
        showNotification('üìã Link copied to clipboard!', 'success');
        const btn = document.querySelector('#share-connect-modal .btn-secondary');
        if (btn) {
          btn.textContent = '‚úÖ Copied!';
          setTimeout(() => btn.textContent = 'üìã Copy', DELAYS.BUTTON_RESET);
        }
      }).catch(() => {
        showNotification('‚ùå Could not copy link', 'error');
      });
    }

    // ‚îÄ‚îÄ‚îÄ QR CODE GENERATOR (Pure JS, No Library) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function generateQRCode() {
      const container = $('qr-code');
      if (!container) return;

      // Simple QR code using free API
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(getShareLink())}`;
      container.innerHTML = `<img src="${qrUrl}" alt="QR Code" style="border-radius: 8px;">`;
    }

    // ‚îÄ‚îÄ‚îÄ ADD FRIEND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function addNewFriend() {
      const nameInput = $('new-friend-name');
      const name = nameInput?.value.trim();

      if (!name) {
        showNotification('‚ùå Please enter a name', 'error');
        return;
      }

      // Check if friend already exists
      if (AppState.friends.some(f => f.name.toLowerCase() === name.toLowerCase())) {
        showNotification('‚ö†Ô∏è Friend already exists', 'error');
        return;
      }

      // Generate random color
      const colors = ['#10B981', '#F59E0B', '#8B5CF6', '#EF4444', '#06B6D4', '#EC4899', '#6366F1'];
      const color = colors[Math.floor(Math.random() * colors.length)];

      const newFriend = {
        name: name,
        avatar: name.charAt(0).toUpperCase(),
        color: color
      };

      if (!StateManager.addFriend(newFriend)) return;

      try {
        storage.save('friends', AppState.friends);
      } catch (e) {
        saveToLocalStorage();
      }

      // Sync to cloud if authenticated
      if (AppState.isAuthenticated) {
        SupabaseManager.syncFriends().then(() => {
        });
      }

      nameInput.value = '';
      showNotification(`‚úÖ ${name} added as friend!`, 'success');

      // Refresh people selector if on add expense view
      populatePeopleSelector();
    }

    // ‚îÄ‚îÄ‚îÄ GROUP INVITE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function shareGroupInvite() {
      const groupSelect = $('group-select');
      const groupId = groupSelect?.value;
      const group = AppState.groups.find(g => g.id == groupId);

      if (!group) {
        showNotification('‚ùå Please select a group', 'error');
        return;
      }

      const inviteMessage = `üéâ You're invited to join "${group.name}" on monEZ!\n\n` +
        `${group.icon} ${group.name}\n` +
        `üë• ${group.members} member(s)\n\n` +
        `Join now: ${getShareLink()}&group=${group.id}`;

      if (navigator.share) {
        navigator.share({
          title: `Join ${group.name} on monEZ`,
          text: inviteMessage,
          url: getShareLink()
        }).then(() => {
          showNotification('üì® Group invite sent!', 'success');
        }).catch(error => {
          console.error('Group invite share failed:', error);
          showNotification('Share failed', 'error');
        });
      } else {
        navigator.clipboard.writeText(inviteMessage).then(() => {
          showNotification('üìã Group invite copied!', 'success');
        });
      }
    }

    // Global function exports
    window.closeShareModal = closeShareModal;
    window.addNewFriend = addNewFriend;
    window.shareViaWhatsApp = shareViaWhatsApp;
    window.shareViaTelegram = shareViaTelegram;
    window.shareViaSMS = shareViaSMS;
    window.shareViaEmail = shareViaEmail;
    window.shareViaTwitter = shareViaTwitter;
    window.shareViaFacebook = shareViaFacebook;
    window.shareViaLinkedIn = shareViaLinkedIn;
    window.shareViaNative = shareViaNative;
    window.copyShareLink = copyShareLink;
    window.shareGroupInvite = shareGroupInvite;

    function showFilters() {
      const modal = document.createElement('div');
      modal.id = 'filters-modal';
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 380px;">
          <div class="modal-header">
            <h3>${t('filter_expenses')}</h3>
            <button class="modal-close" onclick="closeFiltersModal()">√ó</button>
          </div>
          <div class="modal-body" style="padding: var(--space-lg);">
            <div style="margin-bottom: var(--space-md);">
              <label style="font-weight: 600; display: block; margin-bottom: 8px;">${t('category')}</label>
              <select id="filter-category" class="setting-select" style="width: 100%;">
                <option value="">${t('all_categories')}</option>
                <option value="üçΩÔ∏è">üçΩÔ∏è ${t('cat_food')}</option>
                <option value="üöó">üöó ${t('cat_transport')}</option>
                <option value="üé¨">üé¨ ${t('cat_entertainment')}</option>
                <option value="üõí">üõí ${t('cat_shopping')}</option>
                <option value="üè†">üè† ${t('cat_bills')}</option>
                <option value="‚úàÔ∏è">‚úàÔ∏è ${t('cat_travel')}</option>
              </select>
            </div>
            <div style="margin-bottom: var(--space-md);">
              <label style="font-weight: 600; display: block; margin-bottom: 8px;">Date Range</label>
              <select id="filter-date" class="setting-select" style="width: 100%;">
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month" selected>This Month</option>
                <option value="year">This Year</option>
              </select>
            </div>
            <div style="margin-bottom: var(--space-md);">
              <label style="font-weight: 600; display: block; margin-bottom: 8px;">Friend</label>
              <select id="filter-friend" class="setting-select" style="width: 100%;">
                <option value="">All Friends</option>
                ${AppState.friends.map(f => `<option value="${f.name}">${f.name}</option>`).join('')}
              </select>
            </div>
            <div style="margin-bottom: var(--space-md);">
              <label style="font-weight: 600; display: block; margin-bottom: 8px;">Status</label>
              <select id="filter-status" class="setting-select" style="width: 100%;">
                <option value="">All</option>
                <option value="pending">Pending</option>
                <option value="settled">Settled</option>
              </select>
            </div>
          </div>
          <div class="modal-footer" style="display: flex; gap: var(--space-sm); padding: var(--space-md);">
            <button class="btn btn-secondary" onclick="clearFilters()" style="flex: 1;">Clear</button>
            <button class="btn btn-primary" onclick="applyFilters()" style="flex: 1;">Apply Filters</button>
          </div>
        </div>
        `;
      document.body.appendChild(modal);
    }

    function closeFiltersModal() {
      const modal = $('filters-modal');
      if (modal) modal.remove();
    }

    function applyFilters() {
      const category = $('filter-category')?.value;
      const dateRange = $('filter-date')?.value;
      const friend = $('filter-friend')?.value;
      const status = $('filter-status')?.value;

      let filtered = [...AppState.expenses];

      if (category) {
        filtered = filtered.filter(e => e.category === category);
      }

      if (friend) {
        filtered = filtered.filter(e =>
          e.splitWith?.includes(friend) || e.paidBy === friend
        );
      }

      if (status) {
        filtered = filtered.filter(e => e.status === status);
      }

      // Date filtering (simplified)
      if (dateRange === 'today') {
        filtered = filtered.filter(e => e.date?.includes('Today'));
      } else if (dateRange === 'week') {
        filtered = filtered.filter(e =>
          e.date?.includes('Today') || e.date?.includes('Yesterday')
        );
      }

      closeFiltersModal();

      // Render filtered results
      const container = $('all-expenses-list');
      if (container) {
        container.innerHTML = '';
        if (filtered.length === 0) {
          container.innerHTML = `<div style="text-align:center;padding:40px;color:#888;">${t('no_matches')}</div>`;
        } else {
          filtered.forEach(expense => {
            const item = document.createElement('div');
            item.className = 'expense-item activity-item';
            item.innerHTML = `
        <div class="activity-icon" style="background: #10B981;">${expense.category || 'üí∞'}</div>
              <div class="activity-content" style="flex: 1;">
                <div class="activity-title">${sanitizeHTML(expense.description)}</div>
                <div class="activity-meta">${expense.date} ‚Ä¢ ${expense.paidBy === 'You' ? t('you') : sanitizeHTML(expense.paidBy)}</div>
              </div>
              <div class="activity-amount">${formatCurrency(expense.amount)}</div>
      `;
            container.appendChild(item);
          });
        }
      }

      showNotification(`üîç ${t('showing_filtered', { count: filtered.length })} `, 'info');
    }

    function clearFilters() {
      closeFiltersModal();
      renderAllExpenses();
      showNotification(`üîÑ ${t('filters_cleared')} `, 'info');
    }

    window.closeFiltersModal = closeFiltersModal;
    window.applyFilters = applyFilters;
    window.clearFilters = clearFilters;

    function settleAll() {
      const balances = calculateUserBalances();
      const owe = balances.filter(b => b.amount < 0);

      if (owe.length === 0) {
        showNotification('‚úÖ You don\'t owe anyone!', 'success');
        return;
      }

      const total = owe.reduce((sum, b) => sum + Math.abs(b.amount), 0);

      if (confirm(t('confirm_settle_all', { count: owe.length, amount: formatCurrency(total) }))) {
        showNotification(`üí≥ Opening payments for ${owe.length} balance(s)...`, 'info');

        // Open first payment, others need manual action
        const first = owe[0];
        settleBalance(first.name, Math.abs(first.amount));
      }
    }

    function showCreateGroup() {
      showGroupModal();
    }

    function showGroupModal() {
      const modal = document.createElement('div');
      modal.id = 'group-modal';
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 380px;">
          <div class="modal-header">
            <h3>üë• ${t('create_group')}</h3>
            <button class="modal-close" onclick="closeGroupModal()">√ó</button>
          </div>
          <div class="modal-body" style="padding: var(--space-lg);">
            <input type="text" id="group-name" class="search-input" placeholder="${t('group_name_placeholder')}" style="margin-bottom: var(--space-md);">
            <input type="text" id="group-icon" class="search-input" placeholder="${t('group_icon_placeholder')}" style="margin-bottom: var(--space-md);" maxlength="2">
            <p style="font-size: var(--text-sm); color: var(--secondary-text);">${t('add_members_later')}</p>
          </div>
          <div class="modal-footer" style="display: flex; gap: var(--space-sm); padding: var(--space-md);">
            <button class="btn btn-secondary" onclick="closeGroupModal()" style="flex: 1;">${t('cancel')}</button>
            <button class="btn btn-primary" onclick="createGroup()" style="flex: 1;">${t('create_group')}</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      setTimeout(() => $('group-name').focus(), 100);
    }

    function closeGroupModal() {
      const modal = $('group-modal');
      if (modal) modal.remove();
    }

    function createGroup() {
      const name = $('group-name').value.trim();
      const icon = $('group-icon').value.trim() || 'üë•';

      if (!name) {
        showNotification('‚ùå Please enter a group name', 'error');
        return;
      }

      const newGroup = {
        id: Date.now(),
        name: name,
        icon: icon,
        members: 1,
        balance: 0,
        color: '#' + Math.floor(Math.random() * 16777215).toString(16)
      };

      AppState.groups.push(newGroup);

      try {
        storage.save('groups', AppState.groups);
      } catch (e) {
        saveToLocalStorage();
      }

      // Sync to cloud if authenticated
      if (AppState.isAuthenticated) {
        SupabaseManager.syncGroups().then(() => {
        });
      }

      closeGroupModal();
      renderGroupsPreview();
      renderGroups();
      showNotification(`‚úÖ Group "${name}" created!`, 'success');
    }

    window.closeGroupModal = closeGroupModal;
    window.createGroup = createGroup;
    function showView(viewId) {
      // Hide all views with fade out
      document.querySelectorAll('.view').forEach(view => {
        view.classList.remove('active');
      });

      // Show target view with premium animation
      const targetView = $(viewId + '-view');
      if (targetView) {
        setTimeout(() => {
          targetView.classList.add('active');
          AppState.currentView = viewId;
        }, AppState.animations.enabled ? 50 : 0);
      }
    }

    /**
     * Update navigation bar to highlight active view
     * @param {string} activeView - Name of the currently active view
     */
    function updateNavigation(activeView) {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Map views to navigation items
      const navMap = {
        'home': 0,
        'expenses': 1,
        'balances': 2,
        'groups': 3,
        'expenses': 1,
        'balances': 2,
        'groups': 3,
        'premium': 4,
        'country': -1 // Prevent highlighting or separate handling if needed, or add new index logic
      };

      const navItems = document.querySelectorAll('.nav-item');
      if (navItems[navMap[activeView]]) {
        navItems[navMap[activeView]].classList.add('active');
      }
    }
    // Enhanced Render Functions
    function renderRecentExpenses() {
      const container = $('recent-expenses');
      if (!container) return;

      container.innerHTML = '';

      if (AppState.expenses.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: #64748B;">
            <div style="font-size: 48px; margin-bottom: 16px;">üíé</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #10B981;">${t('no_expenses')}</div>
            <div style="font-size: 14px;">${t('add_first_expense')}</div>
          </div>
        `;
        return;
      }

      AppState.expenses.slice(0, 3).forEach((expense, index) => {
        const item = document.createElement('div');
        item.className = 'activity-item';
        item.style.animationDelay = `${index * 100} ms`;

        const statusColor = expense.status === 'settled' ? '#10B981' : '#F59E0B';
        const statusIcon = expense.status === 'settled' ? '‚úÖ' : '‚è≥';

        item.innerHTML = `
          <div class="activity-icon" style="background: ${statusColor};">
            ${expense.category || 'üí∞'}
          </div>
          <div class="activity-content">
            <div class="activity-title">${sanitizeHTML(expense.description)}</div>
            <div class="activity-meta">
              ${i18n.formatDate(expense.date)} ‚Ä¢ ${expense.location ? sanitizeHTML(expense.location) : t('unknown_location')} ${statusIcon}
            </div>
          </div>
          <div class="activity-amount">${formatCurrency(expense.amount)}</div>
      `;

        // Add hover effects
        item.addEventListener('mouseenter', (e) => {
          if (AppState.animations.enabled) {
            item.style.transform = 'translateX(4px)';
          }
        });

        item.addEventListener('mouseleave', (e) => {
          item.style.transform = '';
        });

        item.addEventListener('click', (e) => {
          createRippleEffect(item, e);
          showNotification(`üí∞ ${expense.description} - ${formatCurrency(expense.amount)} `, 'info');
        });

        container.appendChild(item);
      });
    }
    function renderAllExpenses() {
      const container = $('all-expenses-list');
      if (!container) return;

      container.innerHTML = '';

      if (AppState.expenses.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #64748B;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #10B981;">${t('no_expenses')}</div>
            <div style="font-size: 14px;">${t('add_first_expense')}</div>
          </div>
        `;
        return;
      }

      AppState.expenses.forEach((expense, index) => {
        const item = document.createElement('div');
        item.className = 'expense-item activity-item';
        item.style.position = 'relative';

        item.innerHTML = `
          <div class="activity-icon" style="background: #10B981;">
            ${expense.category || 'üí∞'}
          </div>
          <div class="activity-content" style="flex: 1;">
            <div class="activity-title">${expense.description}</div>
            <div class="activity-meta">${i18n.formatDate(expense.date)} ‚Ä¢ ${expense.paidBy === 'You' ? t('you') : expense.paidBy}</div>
          </div>
          <div class="activity-amount">${formatCurrency(expense.amount)}</div>
          <button class="edit-btn" onclick="editExpense(${expense.id})" title="Edit expense"
                  style="margin-left: 8px; background: none; border: none; color: #3B82F6; cursor: pointer; padding: 4px 8px; font-size: 16px; opacity: 0.6; transition: opacity 0.2s;">
            ‚úèÔ∏è
          </button>
          <button class="delete-btn" onclick="deleteExpense(${expense.id})" title="Delete expense"
                  style="margin-left: 4px; background: none; border: none; color: #EF4444; cursor: pointer; padding: 4px 8px; font-size: 16px; opacity: 0.6; transition: opacity 0.2s;">
            üóëÔ∏è
          </button>
      `;

        // Show delete on hover
        item.addEventListener('mouseenter', () => {
          item.querySelector('.delete-btn').style.opacity = '1';
        });
        item.addEventListener('mouseleave', () => {
          item.querySelector('.delete-btn').style.opacity = '0.6';
        });

        container.appendChild(item);
      });

      // Update stats
      updateExpenseStats();
    }

    function editExpense(expenseId) {
      const expense = AppState.expenses.find(e => e.id === expenseId);
      if (!expense) return;

      // Populate form
      const amountInput = $('amount');
      const descInput = $('description');

      if (amountInput) amountInput.value = expense.amount;
      if (descInput) descInput.value = expense.description;

      AppState.selectedCategory = expense.category;

      // Select category button
      document.querySelectorAll('.category-btn').forEach(btn => {
        if (btn.dataset.category === expense.category) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      // Remove old expense directly (skip confirmation)
      AppState.expenses = AppState.expenses.filter(e => e.id !== expenseId);

      // Save & Sync deletion
      try { storage.save('expenses', AppState.expenses); } catch (e) { saveToLocalStorage(); }
      if (AppState.isAuthenticated) SupabaseManager.deleteExpense(expenseId);

      // Go to Add Expense view
      showAddExpense();
      showNotification('‚úèÔ∏è Editing expense...', 'info');
    }
    window.editExpense = editExpense;

    /**
     * Delete an expense from the application
     * @param {string|number} id - ID of the expense to delete
     */
    function deleteExpense(id) {
      if (!confirm(t('confirm_delete_expense'))) return;

      AppState.expenses = AppState.expenses.filter(e => e.id !== id);

      // Save with ACID storage
      try {
        storage.save('expenses', AppState.expenses);
      } catch (e) {
        // Fallback to legacy save
        saveToLocalStorage();
      }

      // Sync delete to cloud if authenticated
      if (AppState.isAuthenticated) {
        SupabaseManager.deleteExpense(id).then(() => {
        });
      }

      renderAllExpenses();
      renderRecentExpenses();
      updateBalance();
      showNotification('üóëÔ∏è Expense deleted', 'info');
    }

    window.deleteExpense = deleteExpense;
    function renderBalances() {
      const container = $('balances-list');
      if (!container) return;

      container.innerHTML = '';

      // Calculate balances from expenses
      const balances = calculateUserBalances();

      if (balances.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #64748B;">
            <div style="font-size: 48px; margin-bottom: 16px;">‚öñÔ∏è</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #10B981;">${t('all_settled')}</div>
            <div style="font-size: 14px;">${t('no_outstanding')}</div>
          </div>
        `;
        return;
      }

      balances.forEach((balance, index) => {
        const item = document.createElement('div');
        item.className = 'balance-item';
        item.style.animationDelay = `${index * 100} ms`;

        const isPositive = balance.amount > 0;
        const statusText = isPositive ? t('owes_you') : t('you_owe');
        const statusClass = isPositive ? 'positive' : 'negative';
        const avatar = balance.name.charAt(0).toUpperCase();

        item.innerHTML = `
          <div class="balance-avatar">
            ${avatar}
          </div>
          <div class="balance-content">
            <div class="balance-name">${sanitizeHTML(balance.name)}</div>
            <div class="balance-status">${statusText} ‚Ä¢ ${t('last_activity', { time: balance.lastActivity || '2 days ago' })}</div>
          </div>
          <div class="balance-amount-container">
            <div class="balance-amount ${statusClass}">
              ${formatCurrency(Math.abs(balance.amount))}
            </div>
            ${!isPositive ?
            `<button class="settle-btn-small" onclick="settleBalance('${sanitizeHTML(balance.name)}', ${Math.abs(balance.amount)})">${t('pay_now')}</button>` :
            `<button class="settle-btn-small" onclick="remindUser('${sanitizeHTML(balance.name)}')">${t('remind')}</button>`
          }
          </div>
      `;

        // Add hover effects
        item.addEventListener('mouseenter', () => {
          if (AppState.animations.enabled) {
            item.style.transform = 'translateX(4px)';
          }
        });

        item.addEventListener('mouseleave', () => {
          item.style.transform = '';
        });

        container.appendChild(item);
      });
    }

    function calculateUserBalances() {
      const balanceMap = new Map();

      AppState.expenses.forEach(expense => {
        if (!expense.splitWith) return;

        // Handle direct settlements (100% value transfer)
        if (expense.isSettlement) {
          // SECURITY: Validate settlement has participant
          if (!expense.splitWith || expense.splitWith.length === 0) {
            console.warn('Invalid settlement: no participant', expense);
            return;
          }
          const friendName = expense.splitWith[0]; // Settlement is always 1-on-1
          if (!friendName) {
            console.warn('Invalid settlement: empty friend name', expense);
            return;
          }

          if (expense.paidBy === 'You') {
            // You paid friend -> You reduce what you owe them (or they owe you more)
            const currentBalance = balanceMap.get(friendName) || 0;
            balanceMap.set(friendName, currentBalance + expense.amount);
          } else if (expense.paidBy === friendName) {
            // Friend paid you -> They reduce what they owe you
            const currentBalance = balanceMap.get(friendName) || 0;
            balanceMap.set(friendName, currentBalance - expense.amount);
          }
          return;
        }

        // Skip personal expenses (they don't affect balances)
        if (expense.isPersonal) return;

        // SECURITY: Prevent division by zero
        if (!expense.splitWith || expense.splitWith.length === 0) {
          console.warn('Invalid expense: no split participants', expense);
          // GAP FIX #6: Notify user of silent error
          showNotification('Cannot calculate split: no participants found', 'error');
          return;
        }

        // Handle standard split expenses
        const totalPeople = expense.splitWith.length + 1;

        // GAP FIX #5: Use cents for precision
        const amountCents = Math.round(expense.amount * 100);
        const shareCents = Math.round(amountCents / totalPeople);
        const sharePerPerson = shareCents / 100;

        expense.splitWith.forEach(friendName => {
          if (expense.paidBy === 'You') {
            // You paid, friend owes you
            const currentBalance = balanceMap.get(friendName) || 0;
            balanceMap.set(friendName, currentBalance + sharePerPerson);
          } else if (expense.paidBy === friendName) {
            // Friend paid, you owe them
            const currentBalance = balanceMap.get(friendName) || 0;
            balanceMap.set(friendName, currentBalance - sharePerPerson);
          }
        });
      });

      return Array.from(balanceMap.entries())
        .map(([name, amount]) => ({ name, amount }))
        .filter(balance => Math.abs(balance.amount) > 0.01); // Filter out tiny amounts
    }

    function settleBalance(friendName, amount) {
      // Get stored UPI ID or prompt for it
      const upiData = storage.load('upiIds', {});
      let upiId = upiData[friendName];

      if (!upiId) {
        // Show UPI input modal
        showUPIModal(friendName, amount);
        return;
      }

      // Generate UPI payment link
      initiateUPIPayment(friendName, upiId, amount);
    }

    function showUPIModal(friendName, amount) {
      const modal = document.createElement('div');
      modal.id = 'upi-modal';
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 350px;">
          <div class="modal-header">
            <h3>${t('upi_payment_title')}</h3>
            <button class="modal-close" onclick="closeUPIModal()">√ó</button>
          </div>
          <div class="modal-body" style="padding: var(--space-lg);">
            <p style="margin-bottom: var(--space-md); color: var(--secondary-text);">
              ${t('enter_upi_id', { name: friendName, amount: formatCurrency(amount) })}
            </p>
            <input type="text" id="upi-input" class="search-input" 
                   placeholder="${t('upi_placeholder')}"
                   style="margin-bottom: var(--space-md);">
            <div style="display: flex; gap: var(--space-sm);">
              <label style="font-size: var(--text-sm); display: flex; align-items: center; gap: 6px;">
                <input type="checkbox" id="save-upi" checked>
                ${t('save_for_future')}
              </label>
            </div>
          </div>
          <div class="modal-footer" style="display: flex; gap: var(--space-sm); padding: var(--space-md);">
            <button class="btn btn-secondary" onclick="closeUPIModal()" style="flex: 1;">${t('cancel')}</button>
            <button class="btn btn-primary" onclick="processUPIPayment('${friendName}', ${amount})" style="flex: 1;">
              ${t('pay_now_btn')}
            </button>
          </div>
        </div>
        `;
      document.body.appendChild(modal);

      // Focus input
      setTimeout(() => $('upi-input').focus(), 100);
    }

    function closeUPIModal() {
      const modal = $('upi-modal');
      if (modal) modal.remove();
    }

    function processUPIPayment(friendName, amount) {
      const upiId = $('upi-input').value.trim();
      const saveUPI = $('save-upi').checked;

      // Validate UPI ID
      if (!upiId || !validateUPIId(upiId)) {
        showNotification(t('enter_valid_upi'), 'error');
        return;
      }

      // Save UPI ID if requested
      if (saveUPI) {
        const upiData = storage.load('upiIds', {});
        upiData[friendName] = upiId;
        storage.save('upiIds', upiData);
      }

      closeUPIModal();
      initiateUPIPayment(friendName, upiId, amount);
    }

    function validateUPIId(upiId) {
      // UPI ID format: user@provider (e.g. name@upi, 9876543210@paytm)
      const upiRegex = /^[a-zA-Z0-9.\-_]+@[a-zA-Z0-9]+$/;
      return upiRegex.test(upiId);
    }

    function initiateUPIPayment(friendName, upiId, amount) {
      // Generate UPI deep link
      const params = new URLSearchParams({
        pa: upiId,                          // Payee VPA
        pn: friendName,                     // Payee Name
        am: amount.toFixed(2),              // Amount
        cu: 'INR',                          // Currency
        tn: `monEZ Settlement - ${friendName} `, // Transaction Note
        tr: `MONEZ${Date.now()} `            // Transaction Reference
      });

      const upiLink = `upi://pay?${params.toString()}`;

      showNotification(`üì± Opening UPI app to pay ${formatCurrency(amount)} to ${friendName}...`, 'info');

      // Try to open UPI app
      const startTime = Date.now();
      window.location.href = upiLink;

      // Fallback message if UPI app not installed
      setTimeout(() => {
        if (Date.now() - startTime < 2500) {
          // User likely has no UPI app or desktop
          showNotification('üí° Tap "Pay Now" on your phone, or scan the QR code in your banking app', 'info', 5000);

          // Show alternative options
          showPaymentAlternatives(upiId, amount, friendName);
        }
      }, 2000);
    }

    function showPaymentAlternatives(upiId, amount, friendName) {
      const alternatives = document.createElement('div');
      alternatives.id = 'payment-alternatives';
      alternatives.style.cssText = `
        position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
        background: var(--surface); padding: var(--space-md); border-radius: var(--radius-lg);
        box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 1000; text-align: center;
      `;
      alternatives.innerHTML = `
        <p style="margin-bottom: var(--space-sm); font-weight: 600;">${t('pay_via')}</p>
        <div style="display: flex; gap: var(--space-sm); justify-content: center;">
          <a href="gpay://upi/pay?pa=${upiId}&pn=${friendName}&am=${amount}&cu=INR" class="btn btn-secondary" style="padding: 8px 12px;">GPay</a>
          <a href="phonepe://pay?pa=${upiId}&pn=${friendName}&am=${amount}&cu=INR" class="btn btn-secondary" style="padding: 8px 12px;">PhonePe</a>
          <a href="paytmmp://pay?pa=${upiId}&pn=${friendName}&am=${amount}&cu=INR" class="btn btn-secondary" style="padding: 8px 12px;">Paytm</a>
        </div>
        <button onclick="recordPayment('${friendName}', ${amount}, this)" class="btn btn-primary" style="margin-top: var(--space-sm); width: 100%; background: #10B981;">${t('mark_as_paid')}</button>
        <button onclick="this.parentElement.remove()" style="margin-top: 8px; background: none; border: none; color: var(--secondary-text); cursor: pointer;">${t('close')}</button>
      `;
      document.body.appendChild(alternatives);

      setTimeout(() => alternatives.remove(), 10000);
    }

    async function recordPayment(friendName, amount, btnElement) {
      if (btnElement) {
        btnElement.innerHTML = t('saving');
        btnElement.disabled = true;
      }

      // Create a settlement expense
      // Strategy: You paid 'friend', so it's an expense where YOU paid and THEY owe 0? 
      // No, settlement is special. It balances debt.
      // If YOU owe FRIEND: "Payment to Friend"
      // PaidBy: You, SplitWith: [Friend]

      const settlement = {
        id: Date.now(),
        description: `${t('payment_to')} ${friendName}`,
        amount: amount,
        date: 'Today, ' + new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true }),
        paidBy: 'You',
        splitWith: [friendName], // This means they owe you half... wait.
        // SETTLEMENT LOGIC IS TRICKY IN SPLITWISE CLONES
        // To clear "You owe Friend 100":
        // You pay 100. expense: "Settlement", paidBy: You, cost: 100.
        // Who acts? Friend receives 100?
        // Let's model it as: You Paid 100, split with Friend (full amount).
        // Friend owes you 100. This +100 cancels the -100 debt.
        category: 'üí∏',
        status: 'settled',
        isSettlement: true
      };

      // If we are recording a payment FROM friend TO us
      // We can't easily record that unless we impersonate them. 
      // For now, let's assume this is "I Paid Friend".

      if (!StateManager.addExpense(settlement)) return;

      try {
        storage.save('expenses', AppState.expenses);
      } catch (e) {
        saveToLocalStorage();
      }

      // Sync to cloud
      if (AppState.isAuthenticated) {
        await SupabaseManager.syncExpenses();
      }

      updateBalance();
      showNotification(`‚úÖ Paid ${formatCurrency(amount)} to ${friendName}`, 'success');

      // Close modal
      const modal = document.getElementById('payment-alternatives');
      if (modal) modal.remove();

      // Refresh view
      showSettle();
    }
    window.recordPayment = recordPayment;

    window.closeUPIModal = closeUPIModal;
    window.processUPIPayment = processUPIPayment;

    function remindUser(friendName) {
      // Check if Web Share API is available (for mobile)
      if (navigator.share) {
        navigator.share({
          title: 'Payment Reminder from monEZ',
          text: `Hey ${friendName}! Just a friendly reminder about the payment you owe. - Sent via monEZ üí∞`,
          url: window.location.href
        }).then(() => {
          showNotification(`üì§ Reminder shared to ${friendName}!`, 'success');
        }).catch(() => {
          showNotification(`üîî Reminder sent to ${friendName}`, 'info');
        });
      } else {
        // Desktop fallback - copy message to clipboard  
        const message = `Hey ${friendName}! Just a friendly reminder about the payment you owe. - Sent via monEZ üí∞`;
        navigator.clipboard.writeText(message).then(() => {
          showNotification(`üìã Reminder copied! Paste and send to ${friendName}`, 'success');
        }).catch(() => {
          showNotification(`üîî Reminder sent to ${friendName}`, 'info');
        });
      }
    }

    function populatePeopleSelector() {
      const container = $('people-selector');
      if (!container) return;

      container.innerHTML = '';

      // Show add friend option if no friends
      if (AppState.friends.length === 0) {
        container.innerHTML = `
          <div onclick="showShareConnectModal()" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 12px; cursor: pointer; color: white; min-width: 100%;">
            <div style="font-size: 32px; margin-bottom: 8px;">üë§+</div>
            <div style="font-size: 14px; font-weight: 600;">${t('add_friends_first')}</div>
            <div style="font-size: 12px; opacity: 0.9;">${t('tap_to_add_friends')}</div>
          </div>
        `;
        return;
      }

      AppState.friends.forEach(friend => {
        const card = document.createElement('div');
        card.className = 'person-card';
        card.dataset.friendName = friend.name;

        card.innerHTML = `
          <div class="person-avatar" style="background: ${friend.color}">
            ${sanitizeHTML(friend.avatar)}
          </div>
          <div class="person-name">${sanitizeHTML(friend.name.split(' ')[0])}</div>
        `;

        // Enhanced selection handling
        card.addEventListener('click', (e) => {
          const isSelected = card.classList.contains('selected');

          if (isSelected) {
            card.classList.remove('selected');
            AppState.selectedFriends.delete(friend.name);
          } else {
            card.classList.add('selected');
            AppState.selectedFriends.add(friend.name);
          }

          // Add selection effect
          if (AppState.animations.enabled) {
            card.style.transform = isSelected ? '' : 'scale(0.95)';
            setTimeout(() => {
              card.style.transform = '';
            }, 150);
          }

          // Create ripple effect
          createRippleEffect(card, e);
        });

        // Hover effects
        card.addEventListener('mouseenter', () => {
          if (!card.classList.contains('selected') && AppState.animations.enabled) {
            card.style.transform = 'translateY(-2px) scale(1.02)';
          }
        });

        card.addEventListener('mouseleave', () => {
          if (!card.classList.contains('selected')) {
            card.style.transform = '';
          }
        });

        container.appendChild(card);
      });
    }

    function renderGroupsPreview() {
      const container = $('groups-preview');
      if (!container) return;

      container.innerHTML = '';

      // Empty state
      if (AppState.groups.length === 0) {
        container.innerHTML = `
          <div onclick="showCreateGroup()" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%); border-radius: 12px; cursor: pointer; color: white; min-width: 100%;">
            <div style="font-size: 32px; margin-bottom: 8px;">üë•+</div>
            <div style="font-size: 14px; font-weight: 600;">${t('create_first_group')}</div>
            <div style="font-size: 12px; opacity: 0.9;">${t('tap_to_create_group')}</div>
          </div>
        `;
        return;
      }

      AppState.groups.forEach(group => {
        const card = document.createElement('div');
        card.className = 'group-card';

        card.innerHTML = `
          <div class="group-header">
            <span class="group-icon">${group.icon}</span>
            <span class="group-name">${group.name}</span>
          </div>
          <div class="group-members">${t('members', { count: group.members })}</div>
          <div class="group-balance" style="color: ${group.balance >= 0 ? '#10B981' : '#EF4444'}">
            ${group.balance >= 0 ? '+' : ''}${formatCurrency(Math.abs(group.balance))}
          </div>
        `;

        card.addEventListener('click', (e) => {
          createRippleEffect(card, e);
          showNotification(`üë• ${group.name}: ${group.members} members, Balance: ${formatCurrency(group.balance)}`, 'info');
        });

        container.appendChild(card);
      });
    }

    function renderGroups() {
      const container = $('groups-grid');
      if (!container) return;

      container.innerHTML = '';

      AppState.groups.forEach(group => {
        const card = document.createElement('div');
        card.className = 'group-card-full';

        card.innerHTML = `
          <div class="group-header">
            <span class="group-icon" style="font-size: 32px;">${group.icon}</span>
            <div>
              <div class="group-name" style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">${group.name}</div>
              <div class="group-members" style="font-size: 14px; color: #64748B;">${t('members', { count: group.members })}</div>
            </div>
          </div>
          <div style="margin-top: 16px; text-align: right;">
            <div style="font-size: 12px; color: #64748B; margin-bottom: 4px;">${t('your_balance')}</div>
            <div class="group-balance" style="font-size: 20px; font-weight: 700; color: ${group.balance >= 0 ? '#10B981' : '#EF4444'}">
              ${group.balance >= 0 ? '+' : ''}${formatCurrency(Math.abs(group.balance))}
            </div>
          </div>
        `;

        container.appendChild(card);
      });
    }

    function renderPremiumFeatures() {
      const container = $('premium-features');
      if (!container) return;

      container.innerHTML = `
        <div style="padding: 20px;">
          <div style="text-align: center; margin-bottom: 24px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üöÄ</div>
            <h3 style="margin: 0 0 8px 0; font-size: 24px;">${t('premium_features')}</h3>
            <p style="margin: 0 0 20px 0; opacity: 0.9;">${t('unlock_potential')}</p>
          </div>
          
          <div style="display: grid; gap: 16px;">

            
            <div onclick="showSettings()" style="background: #FEFEFE; border: 1px solid rgba(0,0,0,0.1); border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">
              <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 24px;">üåç</span>
                <div>
                  <div style="font-weight: 600; margin-bottom: 4px;">${t('multi_currency')}</div>
                  <div style="font-size: 14px; color: #64748B;">${t('multi_currency_desc')}</div>
                </div>
                <span style="background: #10B981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">${t('free')}</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    // Enhanced Form Handling
    function setupExpenseForm() {
      const form = $('expense-form');
      if (!form) return;

      // SECURITY: Prevent duplicate submissions
      let isSavingExpense = false;

      // Setup category selection
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          AppState.selectedCategory = btn.dataset.category;
          createRippleEffect(btn, e);
        });
      });

      // Setup split type selection
      document.querySelectorAll('.split-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          if (btn.classList.contains('premium')) {
            showPremiumModal();
            return;
          }
          document.querySelectorAll('.split-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          createRippleEffect(btn, e);
        });
      });

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        // SECURITY: Prevent duplicate submissions
        if (isSavingExpense) {
          console.warn('Save already in progress');
          return;
        }
        isSavingExpense = true;

        // Disable submit button
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'Saving...';
        }

        const validation = validateAmount($('amount').value);
        if (!validation.valid) {
          showNotification(validation.error, 'error');
          isSavingExpense = false;
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Save Expense';
          }
          return;
        }
        const amount = validation.value;
        const description = $('description').value.trim();
        const selectedFriends = Array.from(AppState.selectedFriends);

        // Enhanced validation with animations
        if (!amount || amount <= 0) {
          showNotification(t('enter_amount'), 'error');
          $('amount').focus();
          return;
        }

        if (!description) {
          showNotification(t('enter_desc'), 'error');
          $('description').focus();
          return;
        }

        // Check validation based on expense type
        if (AppState.currentExpenseType === 'split' && selectedFriends.length === 0) {
          showNotification(t('select_friend'), 'error');
          return;
        }

        // Create expense object
        const expense = {
          id: Date.now(),
          description,
          amount,
          date: new Date().toISOString(),
          // Use global currentExpenseType
          isPersonal: AppState.currentExpenseType === 'personal',
          paidBy: 'You',
          // Only add split friends if in split mode
          splitWith: AppState.currentExpenseType === 'personal' ? [] : selectedFriends,
          category: AppState.selectedCategory || getExpenseCategory(description),
          location: 'Current Location',
          status: 'pending'
        };

        // GAP FIX #1: Use StateManager for validation
        if (!StateManager.addExpense(expense)) {
          isSavingExpense = false;
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Save Expense';
          }
          return;
        }

        // Sync to cloud if authenticated
        if (AppState.isAuthenticated) {
          SupabaseManager.syncExpenses().then(() => {
          });
        }

        updateBalance();

        // Success animation
        let submitBtnSuccess = form.querySelector('.btn-primary');
        const originalContent = submitBtnSuccess.innerHTML;
        submitBtnSuccess.innerHTML = '<span class="btn-text">‚úÖ Saved!</span>';
        submitBtnSuccess.style.background = '#10B981';

        setTimeout(() => {
          // Reset form
          resetForm();

          // Reset button
          submitBtnSuccess.innerHTML = originalContent;
          submitBtnSuccess.style.background = '';

          showNotification(t('expense_added'), 'success');
          showHome();
        }, 1000);
      });
    }

    function resetForm() {
      const form = $('expense-form');
      if (form) {
        form.reset();
      }

      AppState.selectedFriends.clear();
      AppState.selectedCategory = '';

      // Reset all person cards
      document.querySelectorAll('.person-card').forEach(card => {
        card.classList.remove('selected');
      });

      // Reset category buttons
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      // Reset split buttons
      document.querySelectorAll('.split-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      // Activate default split type
      const equalSplitBtn = document.querySelector('.split-btn[data-type="equal"]');
      if (equalSplitBtn) {
        equalSplitBtn.classList.add('active');
      }
    }

    const CATEGORY_KEYWORDS = {
      'üçΩÔ∏è': ['food', 'dinner', 'lunch', 'restaurant', 'comida', 'jantar', 'almo√ßo', 'restaurante', 'cena', 'almuerzo', 'repas', 'd√Æner', 'd√©jeuner', 'essen', 'cibo', 'pranzo', 'cena', 'voedsel', 'jedzenie', '–µ–¥–∞', 'ÏùåÏãù', 'È£ü„ÅπÁâ©', 'È£ü‰∫ã'],
      'üöó': ['uber', 'taxi', 'transport', 'ride', 'transporte', 't√°xi', 'carro', '√¥nibus', 'bus', 'trem', 'train', 'metro', 'subway', 'bahn', 'zug', 'auto', 'voiture', 'treno', 'pociƒÖg', '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', 'Ïö¥ÏÜ°', '‰∫§ÈÄö'],
      'üé¨': ['movie', 'cinema', 'entertainment', 'netflix', 'hbo', 'film', 'filme', 'cine', 'kino', 'theater', 'unterhaltung', 'divertimento', 'rozrywka', '–∫–∏–Ω–æ', 'ÏòÅÌôî', 'Êò†Áîª'],
      'üõçÔ∏è': ['shopping', 'store', 'mall', 'compras', 'loja', 'mercado', 'tienda', 'einkaufen', 'magasin', 'negozio', 'zakupy', 'pokupy', 'ÏáºÌïë', 'Ë≤∑„ÅÑÁâ©'],
      '‚úàÔ∏è': ['travel', 'flight', 'hotel', 'viagem', 'voo', 'hospedagem', 'viaje', 'vuelo', 'voyage', 'vol', 'reisen', 'flug', 'viaggio', 'podr√≥≈º', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', 'Ïó¨Ìñâ', 'ÊóÖË°å'],
      'üí°': ['bills', 'electricity', 'water', 'gas', 'internet', 'contas', 'luz', '√°gua', 'g√°s', 'facturas', 'factures', 'rechnungen', 'bollette', 'rachunki', '—Å—á–µ—Ç–∞', 'Ï≤≠Íµ¨ÏÑú', 'Ë´ãÊ±ÇÊõ∏']
    };

    function getExpenseCategory(description) {
      const desc = description.toLowerCase();

      for (const [icon, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
        if (keywords.some(k => desc.includes(k))) return icon;
      }
      return 'üí∞';
    }

    function updateBalance() {
      let balance = 0;
      AppState.expenses.forEach(expense => {
        const splitAmount = expense.amount / (expense.splitWith.length + 1);
        if (expense.paidBy === 'You') {
          balance += expense.amount - splitAmount;
        } else {
          balance -= splitAmount;
        }
      });

      const previousBalance = AppState.balance;
      AppState.balance = balance;

      // Update hero balance with animation
      const balanceElement = $('balance-hero');
      if (balanceElement && AppState.animations.enabled && Math.abs(balance - previousBalance) > 0) {
        animateNumber(balanceElement, previousBalance, balance, 800);
      } else if (balanceElement) {
        balanceElement.textContent = formatCurrency(Math.abs(balance));
      }

      // Update balances view summary cards
      const oweDisplay = $('you-owe-display');
      const owedDisplay = $('you-are-owed-display');

      const balances = calculateUserBalances();
      const youOweTotal = balances.filter(b => b.amount < 0).reduce((sum, b) => sum + Math.abs(b.amount), 0);
      const youAreOwedTotal = balances.filter(b => b.amount > 0).reduce((sum, b) => sum + Math.abs(b.amount), 0);

      if (oweDisplay) oweDisplay.textContent = formatCurrency(youOweTotal);
      if (owedDisplay) owedDisplay.textContent = formatCurrency(youAreOwedTotal);

      // Update Quick Stats on Home
      const quickOwe = $('quick-owe-display');
      const quickOwed = $('quick-owed-display');
      if (quickOwe) quickOwe.textContent = formatCurrency(youAreOwedTotal);
      if (quickOwed) quickOwed.textContent = formatCurrency(youOweTotal);
    }

    // AI and Premium Features



    function startPremiumTrial() {
      showNotification('üöÄ Premium trial started! All features unlocked for 7 days. Welcome to the premium experience!', 'success', 5000);
    }


    // PWA Features
    function showPWAPrompt() {
      if (!AppState.pwaPromptShown) {
        const prompt = $('pwa-prompt');
        if (prompt) {
          prompt.classList.remove('hidden');
          AppState.pwaPromptShown = true;
        }
      }
    }

    function dismissPWAPrompt() {
      const prompt = $('pwa-prompt');
      if (prompt) {
        prompt.classList.add('hidden');
      }
    }

    function installPWA() {
      if (AppState.deferredPrompt) {
        AppState.deferredPrompt.prompt();
        AppState.deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            showNotification('üì± monEZ installed successfully! Launch from your home screen.', 'success', 4000);
          }
          AppState.deferredPrompt = null;
        });
      } else {
        showNotification('üì± monEZ can be installed from your browser menu or home screen!', 'info', 4000);
      }
      dismissPWAPrompt();
    }

    // Premium Modal Functions
    function showPremiumModal() {
      showNotification(t('premium_unlock_msg'), 'success', 4000);
    }

    function closePremiumModal() {
      const modal = $('premium-modal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    // LocalStorage persistence - ATOMIC SAVE to prevent race conditions
    /**
     * Save application state to localStorage
     * Persists expenses, friends, and groups data
     */
    function saveToLocalStorage() {
      try {
        // SECURITY: Save as single atomic operation
        const data = {
          expenses: AppState.expenses,
          friends: AppState.friends,
          groups: AppState.groups,
          version: '1.0',
          timestamp: Date.now()
        };
        localStorage.setItem('monez_data', JSON.stringify(data));

        // Keep legacy keys for backward compatibility
        localStorage.setItem('monez_expenses', JSON.stringify(AppState.expenses));
        localStorage.setItem('monez_friends', JSON.stringify(AppState.friends));
        localStorage.setItem('monez_groups', JSON.stringify(AppState.groups));
      } catch (e) {
        console.error('Error saving to localStorage:', e);
        showNotification('Failed to save data. Storage may be full.', 'error');
      }
    }

    /**
     * Load application state from localStorage
     * Restores expenses, friends, and groups data
     */
    function loadFromLocalStorage() {
      try {
        const expenses = localStorage.getItem('monez_expenses');
        const friends = localStorage.getItem('monez_friends');
        const groups = localStorage.getItem('monez_groups');
        const startedFresh = localStorage.getItem('monez_started_fresh');

        if (expenses) {
          AppState.expenses = safeJSONParse(expenses, []);
        } else if (startedFresh) {
          // User chose to start fresh - don't load sample data
          AppState.expenses = [];
        } else {
          AppState.expenses = [...premiumExpenses]; // Default sample data
        }

        if (friends) {
          AppState.friends = safeJSONParse(friends, []);
        } else if (startedFresh) {
          AppState.friends = [];
        }

        if (groups) {
          AppState.groups = safeJSONParse(groups, []);
        } else if (startedFresh) {
          AppState.groups = [];
        }
      } catch (e) {
        console.error('Error loading from localStorage:', e);
        AppState.expenses = [...premiumExpenses];
      }
    }

    // Enhanced App Initialization
    function initApp() {
      // Check if this is first visit
      const isFirstVisit = !localStorage.getItem('monez_visited');

      if (isFirstVisit) {
        // Show first-visit welcome modal
        showFirstVisitModal();
        return; // Wait for user choice before continuing
      }

      // Continue with normal initialization
      continueAppInit();
    }

    function showFirstVisitModal() {
      const modal = document.createElement('div');
      modal.id = 'first-visit-modal';
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 400px; text-align: center;">
          <div style="font-size: 48px; margin-bottom: 16px;">üëã</div>
          <h2 style="margin-bottom: 8px; color: var(--primary-accent);">${t('welcome_modal_title')}</h2>
          <p style="color: var(--secondary-text); margin-bottom: 24px;">
            ${t('welcome_modal_desc')}
          </p>
          <div style="background: var(--surface); padding: 16px; border-radius: var(--radius-md); margin-bottom: 24px;">
            <p style="font-size: 14px; color: var(--secondary-text);">
              ${t('start_fresh_q')}
            </p>
          </div>
          <div style="display: flex; gap: 12px;">
            <button class="btn btn-secondary" onclick="startFresh()" style="flex: 1; padding: 14px;">
              üÜï ${t('start_fresh')}
            </button>
            <button class="btn btn-primary" onclick="keepSampleData()" style="flex: 1; padding: 14px;">
              üìä ${t('explore_demo')}
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function startFresh() {
      // Clear all data from localStorage
      localStorage.removeItem('monez_expenses');
      localStorage.removeItem('monez_friends');
      localStorage.removeItem('monez_groups');

      // Set AppState to empty
      AppState.expenses = [];
      AppState.friends = [];
      AppState.groups = [];

      // Mark as started fresh and visited
      localStorage.setItem('monez_started_fresh', 'true');
      localStorage.setItem('monez_visited', 'true');

      // Save empty state to localStorage so it persists
      localStorage.setItem('monez_expenses', JSON.stringify([]));
      localStorage.setItem('monez_friends', JSON.stringify([]));
      localStorage.setItem('monez_groups', JSON.stringify([]));

      closeFirstVisitModal();

      // Initialize UI directly (don't call loadFromLocalStorage)
      initializeSettings();
      setupExpenseForm();
      renderRecentExpenses();
      renderGroupsPreview();
      updateBalance();
      updateExpenseStats();

      setTimeout(() => showPWAPrompt(), DELAYS.PWA_PROMPT);
      setupPWAListeners();

      showNotification(t('started_fresh_msg'), 'success', 5000);
    }

    function keepSampleData() {
      // Keep sample data, just mark as visited
      localStorage.setItem('monez_visited', 'true');
      closeFirstVisitModal();
      continueAppInit();
      showNotification(t('demo_msg'), 'success');
    }

    function closeFirstVisitModal() {
      const modal = $('first-visit-modal');
      if (modal) modal.remove();
    }

    function continueAppInit() {
      // Load saved data from localStorage
      loadFromLocalStorage();

      // Initialize settings from i18n
      initializeSettings();

      // Setup components
      setupExpenseForm();
      renderRecentExpenses();
      renderGroupsPreview();
      updateBalance();
      updateExpenseStats();

      // Show PWA prompt after delay
      setTimeout(() => {
        showPWAPrompt();
      }, 3000);

      // Setup PWA event listeners
      setupPWAListeners();

      // Show welcome notification
      setTimeout(() => {
        showNotification(t('welcome') + ' üíé ' + t('tagline'), 'success', 4000);
      }, 1000);
    }

    function initializeSettings() {
      // Initialize language selector
      const langSelector = $('language-selector');
      if (langSelector) {
        langSelector.value = i18n.currentLang;
        const langDisplay = $('current-language-display');
        if (langDisplay && LANGUAGES[i18n.currentLang]) {
          langDisplay.textContent = LANGUAGES[i18n.currentLang].nativeName;
        }
      }

      // Initialize currency selector
      const currSelector = $('currency-selector');
      if (currSelector) {
        currSelector.value = i18n.currentCurrency;
        const currDisplay = $('current-currency-display');
        if (currDisplay && CURRENCIES[i18n.currentCurrency]) {
          const c = CURRENCIES[i18n.currentCurrency];
          currDisplay.textContent = `${c.symbol} ${c.name}`;
        }
      }

      // Initialize currency selector and UI
      updateCurrencyUI();

      // Initialize dark mode
      const settings = storage.load('settings', {});
      if (settings.darkMode) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.body.style.background = '#1a1a2e';
        document.body.style.color = '#eee';
        const darkToggle = $('dark-mode-toggle');
        if (darkToggle) darkToggle.checked = true;
      }

      // Set HTML direction for RTL
      if (i18n.isRTL()) {
        document.documentElement.dir = 'rtl';
      }
    }

    function updateExpenseStats() {
      // Calculate real stats
      const total = AppState.expenses.reduce((sum, e) => sum + (e.amount || 0), 0);

      // This month's expenses
      const now = new Date();
      const thisMonth = AppState.expenses.filter(e => {
        if (!e.date) return false;
        // Simple check - if date contains "Today" or current month
        return e.date.includes('Today') || e.date.includes('Yesterday') ||
          e.date.includes(now.toLocaleString('default', { month: 'short' }));
      }).reduce((sum, e) => sum + (e.amount || 0), 0);

      const totalEl = $('total-expenses');
      const monthEl = $('this-month');

      if (totalEl) totalEl.textContent = formatCurrency(total);
      if (monthEl) monthEl.textContent = formatCurrency(thisMonth || total);
      // renderCategoryAnalytics(); // Function is nested, not globally accessible // Re-enabled - function exists at line 5392
    }

    function setupPWAListeners() {
      // PWA install prompt
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        AppState.deferredPrompt = e;
        showPWAPrompt();
      });

      // PWA installed
      window.addEventListener('appinstalled', () => {
        showNotification('üéâ monEZ installed! Enjoy the native app experience.', 'success');
        AppState.deferredPrompt = null;
        dismissPWAPrompt();
      });
    }
    // Loading Screen Management
    function hideLoadingScreen() {
      const loadingScreen = $('loading-screen');
      const mainApp = $('main-app');

      if (loadingScreen && mainApp) {
        setTimeout(() => {
          loadingScreen.style.opacity = '0';
          setTimeout(() => {
            loadingScreen.style.display = 'none';
            mainApp.style.display = 'flex';
            mainApp.style.flexDirection = 'column';
            mainApp.style.minHeight = '100vh';
          }, 300);
        }, 2000); // 2 second loading experience
      }
    }

    // Enhanced Event Listeners
    document.addEventListener('DOMContentLoaded', async () => {
      // Show loading screen first
      hideLoadingScreen();

      // Initialize Supabase
      SupabaseManager.init();

      // Check for existing session
      const session = await SupabaseManager.getSession();
      if (session?.user) {
        AppState.user = session.user;
        AppState.isAuthenticated = true;
      }

      // Initialize app after loading
      setTimeout(() => {
        initApp();
      }, 2300);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.altKey) {
        switch (e.key) {
          case '1': showHome(); e.preventDefault(); break;
          case '2': showExpenses(); e.preventDefault(); break;
          case '3': showBalances(); e.preventDefault(); break;
          case '4': showGroups(); e.preventDefault(); break;
          case '5': showPremiumFeatures(); e.preventDefault(); break;
          case 'a': case 'A': showAddExpense(); e.preventDefault(); break;
        }
      }
    });

    // Gesture support
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleGesture();
    });

    function handleGesture() {
      const swipeThreshold = 50;
      const swipeDistance = touchEndX - touchStartX;

      if (Math.abs(swipeDistance) > swipeThreshold) {
        if (swipeDistance > 0 && AppState.currentView !== 'home') {
          // Swipe right - go back
          showHome();
          showNotification('‚Üê Swiped back to home', 'info', 1000);
        }
      }
    }

    // Service Worker Registration with cache-busting
    if ('serviceWorker' in navigator) {
      // Add timestamp to force fresh download
      const swUrl = `/service-worker.js?v=${Date.now()}`;
      navigator.serviceWorker.register(swUrl, { updateViaCache: 'none' })
        .then(reg => {
          // Force immediate update check
          reg.update();
          // Auto-reload when new service worker activates
          reg.addEventListener('updatefound', () => {
            const newWorker = reg.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'activated' && navigator.serviceWorker.controller) {
                window.location.reload();
              }
            });
          });
        })
        .catch(err => console.error('Service Worker registration failed:', err));
    }

    // Global functions for HTML onclick handlers
    window.showHome = showHome;
    window.showAddExpense = showAddExpense;
    window.showExpenses = showExpenses;
    window.showBalances = showBalances;
    window.showGroups = showGroups;
    window.showPremiumFeatures = showPremiumFeatures;
    window.showSettings = showSettings;
    window.showSplitBill = showSplitBill;
    window.showSettle = showSettle;
    window.showNotifications = showNotifications;
    window.showProfile = showProfile;
    window.showFilters = showFilters;
    window.settleAll = settleAll;
    window.showCreateGroup = showCreateGroup;
    window.dismissPWAPrompt = dismissPWAPrompt;
    window.installPWA = installPWA;
    window.showPremiumModal = showPremiumModal;
    window.closePremiumModal = closePremiumModal;

    window.startPremiumTrial = startPremiumTrial;
    window.settleBalance = settleBalance;
    window.remindUser = remindUser;

    // Global settings functions
    window.changeLanguage = changeLanguage;
    window.changeCurrency = changeCurrency;
    window.exportDataJSON = exportDataJSON;
    window.exportDataCSV = exportDataCSV;
    window.importData = importData;
    window.toggleDarkMode = toggleDarkMode;
    window.showPaymentMethods = showPaymentMethods;
    window.searchExpenses = searchExpenses;

    // First-visit modal functions
    window.startFresh = startFresh;
    window.keepSampleData = keepSampleData;
    window.closeFirstVisitModal = closeFirstVisitModal;

    // Auth modal functions
    window.showAuthModal = showAuthModal;
    window.closeAuthModal = closeAuthModal;
    window.handleEmailAuth = handleEmailAuth;
    window.handleGoogleAuth = handleGoogleAuth;
    window.handlePhoneAuth = handlePhoneAuth;
    window.showPhoneAuth = showPhoneAuth;
    window.showEmailAuth = showEmailAuth;
    window.skipAuth = skipAuth;
    window.signOut = signOut;

    function showAuthModal() {
      const modal = $('auth-modal');
      if (modal) modal.classList.remove('hidden');
    }

    function closeAuthModal() {
      const modal = $('auth-modal');
      if (modal) modal.classList.add('hidden');
    }

    async function handleEmailAuth() {
      const email = $('auth-email')?.value?.trim();
      const password = $('auth-password')?.value;

      if (!email || !password) {
        showNotification('‚ùå Please enter email and password', 'error');
        return;
      }

      showNotification('üîÑ Signing in...', 'info');

      // Try sign in first
      let result = await SupabaseManager.signIn(email, password);

      if (result.error?.message?.includes('Invalid')) {
        // User doesn't exist, try signing up
        result = await SupabaseManager.signUp(email, password, email.split('@')[0]);
      }

      if (result.error) {
        showNotification(`‚ùå ${result.error.message}`, 'error');
        return;
      }

      if (result.data?.user) {
        AppState.user = result.data.user;
        AppState.isAuthenticated = true;
        closeAuthModal();
        showNotification('‚úÖ Signed in! Syncing your data...', 'success');

        // Sync data from cloud
        await SupabaseManager.fullSync();
        renderRecentExpenses();
        renderGroupsPreview();
        updateBalance();
      }
    }

    async function handleGoogleAuth() {
      showNotification('üîÑ Opening Google login...', 'info');
      const result = await SupabaseManager.signInWithGoogle();
      if (result.error) {
        showNotification(`‚ùå ${result.error.message}`, 'error');
      }
    }

    let pendingPhone = '';
    async function handlePhoneAuth() {
      const phone = $('auth-phone')?.value?.trim();
      const otp = $('auth-otp')?.value?.trim();

      if (otp) {
        // Verify OTP
        const result = await SupabaseManager.verifyOTP(pendingPhone, otp);
        if (result.error) {
          showNotification(`‚ùå ${result.error.message}`, 'error');
          return;
        }
        if (result.data?.user) {
          AppState.user = result.data.user;
          AppState.isAuthenticated = true;
          closeAuthModal();
          showNotification('‚úÖ Phone verified! Syncing...', 'success');
          await SupabaseManager.fullSync();
          renderRecentExpenses();
        }
      } else if (phone) {
        // Send OTP
        pendingPhone = phone;
        const result = await SupabaseManager.signInWithOTP(phone);
        if (result.error) {
          showNotification(`‚ùå ${result.error.message}`, 'error');
          return;
        }
        $('otp-input').style.display = 'block';
        showNotification('üì± OTP sent to your phone!', 'success');
      } else {
        showNotification('‚ùå Please enter phone number', 'error');
      }
    }

    function showPhoneAuth() {
      $('auth-form').style.display = 'none';
      $('phone-auth-form').style.display = 'block';
    }

    function showEmailAuth() {
      $('auth-form').style.display = 'block';
      $('phone-auth-form').style.display = 'none';
    }

    function skipAuth() {
      closeAuthModal();
      AppState.isAuthenticated = false;
      showNotification('üì¥ Running in offline mode. Data stays on this device only.', 'info', 5000);
    }

    async function signOut() {
      await SupabaseManager.signOut();
      updateAccountUI();
      showNotification('üëã Signed out', 'success');
    }

    async function syncNow() {
      if (!AppState.isAuthenticated) {
        showAuthModal();
        return;
      }

      showNotification('üîÑ Syncing...', 'info');
      const syncStatus = $('sync-status');
      if (syncStatus) syncStatus.textContent = 'üîÑ Syncing...';

      await SupabaseManager.syncExpenses();
      await SupabaseManager.syncFriends();
      await SupabaseManager.syncGroups();

      if (syncStatus) syncStatus.textContent = '‚úÖ Synced just now';
      showNotification('‚úÖ All data synced!', 'success');
    }
    window.syncNow = syncNow;

    function updateAccountUI() {
      const loggedOut = $('account-logged-out');
      const loggedIn = $('account-logged-in');
      const emailEl = $('account-email');
      const syncStatus = $('sync-status');

      if (AppState.isAuthenticated && AppState.user) {
        if (loggedOut) loggedOut.style.display = 'none';
        if (loggedIn) loggedIn.style.display = 'block';
        if (emailEl) emailEl.textContent = AppState.user.email || 'Signed In';
        if (syncStatus) syncStatus.textContent = '‚úÖ Synced';
      } else {
        if (loggedOut) loggedOut.style.display = 'flex';
        if (loggedIn) loggedIn.style.display = 'none';
      }
    }
    window.updateAccountUI = updateAccountUI;

    // Settings functions implementation
    function changeLanguage(langCode) {
      if (i18n.setLanguage(langCode)) {
        showNotification(`üåç ${t('language_changed')} ${LANGUAGES[langCode].nativeName}`, 'success');
        const display = $('current-language-display');
        if (display) display.textContent = LANGUAGES[langCode].nativeName;

        // Smart Currency Switch
        const defaultCurrency = LANGUAGES[langCode].defaultCurrency;
        if (defaultCurrency && CURRENCIES[defaultCurrency]) {
          changeCurrency(defaultCurrency);
        }

        // Refresh UI
        renderRecentExpenses();
        renderAllExpenses();
        renderBalances();
        renderGroupsPreview();
        renderGroups();
        renderPremiumFeatures();
        updateBalance();
      }
    }

    function updateCurrencyUI() {
      const currencyCode = i18n.currentCurrency;
      const currency = CURRENCIES[currencyCode] || CURRENCIES['USD'];

      // Update Add Expense Currency Symbol explicitly
      const addExpenseSymbol = $('add-expense-currency-symbol');
      if (addExpenseSymbol) addExpenseSymbol.textContent = currency.symbol;

      // Update Settings Display
      const settingsDisplay = $('current-currency-display');
      if (settingsDisplay) settingsDisplay.textContent = `${currency.symbol} ${currency.name}`;

      // Update Currency Selector
      const selector = $('currency-selector');
      if (selector) selector.value = currencyCode;

      // Trigger re-renders
      updateBalance();
      renderRecentExpenses();
      renderAllExpenses();
      renderBalances();
      renderGroupsPreview();
    }

    function changeCurrency(currencyCode) {
      if (i18n.setCurrency(currencyCode)) {
        const currency = CURRENCIES[currencyCode];
        showNotification(`üí∞ ${t('currency_changed')} ${currency.symbol} ${currency.name}`, 'success');
        updateCurrencyUI();
      }
    }

    function exportDataJSON() {
      try {
        const data = storage.exportData();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `monez-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        showNotification('üìÅ Data exported as JSON successfully!', 'success');
      } catch (e) {
        showNotification('‚ùå Export failed: ' + e.message, 'error');
      }
    }

    function exportDataCSV() {
      try {
        const csv = storage.exportCSV();
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `monez-expenses-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
        showNotification('üìÑ Expenses exported as CSV successfully!', 'success');
      } catch (e) {
        showNotification('‚ùå Export failed: ' + e.message, 'error');
      }
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = safeJSONParse(event.target.result, null);
            if (!data) {
              showNotification('Invalid JSON file', 'error');
              return;
            }

            // Validate and import with ACID transaction
            storage.transaction([
              () => { if (data.expenses) storage.save('expenses', data.expenses); },
              () => { if (data.friends) storage.save('friends', data.friends); },
              () => { if (data.groups) storage.save('groups', data.groups); },
              () => { if (data.settings) storage.save('settings', data.settings); }
            ]).then(() => {
              // Reload data into AppState
              loadFromLocalStorage();
              renderRecentExpenses();
              renderBalances();
              renderGroups();
              updateBalance();
              showNotification('üì• Data imported successfully!', 'success');
            }).catch(err => {
              showNotification('‚ùå Import failed: ' + err.message, 'error');
            });
          } catch (e) {
            showNotification('‚ùå Invalid JSON file', 'error');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function toggleDarkMode(enabled) {
      if (enabled) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.body.style.background = '#1a1a2e';
        document.body.style.color = '#eee';
        showNotification('üåô Dark mode enabled', 'info');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.body.style.background = '';
        document.body.style.color = '';
        showNotification('‚òÄÔ∏è Light mode enabled', 'info');
      }
      // Save preference
      const settings = storage.load('settings', {});
      settings.darkMode = enabled;
      storage.save('settings', settings);
    }

    function showPaymentMethods() {
      const modal = document.createElement('div');
      modal.id = 'payment-modal';
      modal.className = 'modal';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';

      modal.innerHTML = `
        <div class="animate-enter" style="background: var(--surface); border-radius: 16px; padding: 24px; max-width: 400px; width: 90%;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">üí≥ Payment Methods</h3>
            <button onclick="const m = document.getElementById('payment-modal'); if (m) m.remove();" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text);">√ó</button>
          </div>
          
          <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 20px; border-radius: 12px; color: white; margin-bottom: 12px; position: relative; overflow: hidden;">
             <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
             <div style="font-size: 12px; opacity: 0.8; margin-bottom: 4px;">HDFC Bank</div>
             <div style="font-size: 18px; letter-spacing: 2px; margin-bottom: 12px;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</div>
             <div style="display: flex; justify-content: space-between;">
               <div style="font-size: 12px; opacity: 0.8;">Rahul K.</div>
               <div style="font-weight: bold;">VISA</div>
             </div>
          </div>
          
          <div style="text-align: center; padding: 12px; border: 1px dashed var(--borders); border-radius: 12px; color: var(--secondary-text); cursor: pointer;">
            + Add New Method
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function searchExpenses(query) {
      if (!query || query.trim() === '') {
        renderAllExpenses();
        return;
      }

      const q = query.toLowerCase().trim();
      const filtered = AppState.expenses.filter(e =>
        e.description.toLowerCase().includes(q) ||
        (e.category && e.category.includes(q)) ||
        (e.paidBy && e.paidBy.toLowerCase().includes(q))
      );

      // Render filtered results
      const container = $('all-expenses-list');
      if (!container) return;

      container.innerHTML = '';

      if (filtered.length === 0) {
        container.innerHTML = '<div style="text-align:center;padding:40px;color:#888;">No expenses match your search</div>';
        return;
      }

      filtered.forEach(expense => {
        const item = document.createElement('div');
        item.className = 'activity-item';
        item.innerHTML = `
          <div class="activity-icon" style="background: #10B981;">
            ${expense.category || 'üí∞'}
          </div>
          <div class="activity-content">
            <div class="activity-title">${expense.description}</div>
            <div class="activity-meta">${expense.date}</div>
          </div>
          <div class="activity-amount">${formatCurrency(expense.amount)}</div>
        `;
        container.appendChild(item);
      });

      showNotification(`üîç Found ${filtered.length} expense(s)`, 'info');
    }

    // Add ripple effect to buttons
    document.addEventListener('click', (e) => {
      if (e.target.matches('button, .btn, .action-card, .nav-item')) {
        createRippleEffect(e.target, e);
      }
    });

    // Add CSS for ripple animation
    const style = document.createElement('style');
    style.textContent = '@keyframes ripple { to { transform: scale(2); opacity: 0; } }';
    document.head.appendChild(style);

    // Simple notification styles
    const notificationStyle = document.createElement('style');
    notificationStyle.textContent = '.premium-notification { position: fixed; top: 20px; right: 20px; background: white; border-radius: 8px; padding: 12px; z-index: 10000; }';
    document.head.appendChild(notificationStyle);




    function showSplitBill() {
      showAddExpense();
      setTimeout(() => {
        setExpenseType('split');
      }, 100);
    }
    // --- INITIALIZATION ---
    function init() {
      try {

        // Load data
        loadFromLocalStorage();

        // Initialize UI
        renderRecentExpenses();
        renderGroupsPreview();
        updateBalance();
        updateExpenseStats();

        // Set initial states
        setExpenseType('personal');

        // Setup PWA
        setupPWAListeners();
        setTimeout(() => showPWAPrompt(), 5000);

      } catch (e) {
        console.error('‚ùå Initialization failed:', e);
        showNotification('Startup error: ' + e.message, 'error');
      }
    }

    // Start App
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    // Offline/Online Detection
    window.addEventListener('online', () => {
      AppState.syncStatus = 'online';
      showNotification('‚úÖ Back online', 'success');

      // Auto-sync when back online
      if (AppState.isAuthenticated) {
        syncNow();
      }
    });

    window.addEventListener('offline', () => {
      AppState.syncStatus = 'offline';
      showNotification('üì¥ You are offline. Changes saved locally.', 'info');
    });

    // Check initial online status
    if (!navigator.onLine) {
      AppState.syncStatus = 'offline';
    }
  </script>

  <!-- PWA Manifest -->

</body>

</html>